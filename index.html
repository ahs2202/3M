<!DOCTYPE html>
<html lang="en">
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-427H1D2L7D"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-427H1D2L7D');
</script>
<head>	   
    <!-- Required meta tags (add the responsive viewport meta tag) -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="https://www.ebi.ac.uk/pdbe/pdb-component-library/css/pdbe-molstar-light-1.1.0-dev.4.css">
    <!--Bootstrap CSS library-->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <!--Google Icon CSS library-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- JS -->
    <!-- IntervalTree package for searching matched records efficiently (binary-search-bounds and interval-tree-1d packages, browserified and minified) -->
    <script>require=function t(i,r,n){function e(h,o){if(!r[h]){if(!i[h]){var u="function"==typeof require&&require;if(!o&&u)return u(h,!0);if(s)return s(h,!0);var f=new Error("Cannot find module '"+h+"'");throw f.code="MODULE_NOT_FOUND",f}var l=r[h]={exports:{}};i[h][0].call(l.exports,(function(t){return e(i[h][1][t]||t)}),l,l.exports,t,i,r,n)}return r[h].exports}for(var s="function"==typeof require&&require,h=0;h<n.length;h++)e(n[h]);return e}({"binary-search-bounds":[function(t,i,r){"use strict";function n(t,i,r,n,e){var s=["function ",t,"(a,l,h,",n.join(","),"){",e?"":"var i=",r?"l-1":"h+1",";while(l<=h){var m=(l+h)>>>1,x=a[m]"];return e?i.indexOf("c")<0?s.push(";if(x===y){return m}else if(x<=y){"):s.push(";var p=c(x,y);if(p===0){return m}else if(p<=0){"):s.push(";if(",i,"){i=m;"),r?s.push("l=m+1}else{h=m-1}"):s.push("h=m-1}else{l=m+1}"),s.push("}"),e?s.push("return -1};"):s.push("return i};"),s.join("")}function e(t,i,r,e){return new Function([n("A","x"+t+"y",i,["y"],e),n("P","c(x,y)"+t+"0",i,["y","c"],e),"function dispatchBsearch",r,"(a,y,c,l,h){if(typeof(c)==='function'){return P(a,(l===void 0)?0:l|0,(h===void 0)?a.length-1:h|0,y,c)}else{return A(a,(c===void 0)?0:c|0,(l===void 0)?a.length-1:l|0,y)}}return dispatchBsearch",r].join(""))()}i.exports={ge:e(">=",!1,"GE"),gt:e(">",!1,"GT"),lt:e("<",!0,"LT"),le:e("<=",!0,"LE"),eq:e("-",!0,"EQ",!0)}},{}],"interval-tree-1d":[function(t,i,r){"use strict";var n=t("binary-search-bounds");function e(t,i,r,n,e){this.mid=t,this.left=i,this.right=r,this.leftPoints=n,this.rightPoints=e,this.count=(i?i.count:0)+(r?r.count:0)+n.length}i.exports=function(t){if(!t||0===t.length)return new d(null);return new d(p(t))};var s=e.prototype;function h(t,i){t.mid=i.mid,t.left=i.left,t.right=i.right,t.leftPoints=i.leftPoints,t.rightPoints=i.rightPoints,t.count=i.count}function o(t,i){var r=p(i);t.mid=r.mid,t.left=r.left,t.right=r.right,t.leftPoints=r.leftPoints,t.rightPoints=r.rightPoints,t.count=r.count}function u(t,i){var r=t.intervals([]);r.push(i),o(t,r)}function f(t,i){var r=t.intervals([]),n=r.indexOf(i);return n<0?0:(r.splice(n,1),o(t,r),1)}function l(t,i,r){for(var n=0;n<t.length&&t[n][0]<=i;++n){var e=r(t[n]);if(e)return e}}function c(t,i,r){for(var n=t.length-1;n>=0&&t[n][1]>=i;--n){var e=r(t[n]);if(e)return e}}function g(t,i){for(var r=0;r<t.length;++r){var n=i(t[r]);if(n)return n}}function a(t,i){return t-i}function v(t,i){var r=t[0]-i[0];return r||t[1]-i[1]}function P(t,i){var r=t[1]-i[1];return r||t[0]-i[0]}function p(t){if(0===t.length)return null;for(var i=[],r=0;r<t.length;++r)i.push(t[r][0],t[r][1]);i.sort(a);var n=i[i.length>>1],s=[],h=[],o=[];for(r=0;r<t.length;++r){var u=t[r];u[1]<n?s.push(u):n<u[0]?h.push(u):o.push(u)}var f=o,l=o.slice();return f.sort(v),l.sort(P),new e(n,p(s),p(h),f,l)}function d(t){this.root=t}s.intervals=function(t){return t.push.apply(t,this.leftPoints),this.left&&this.left.intervals(t),this.right&&this.right.intervals(t),t},s.insert=function(t){var i=this.count-this.leftPoints.length;if(this.count+=1,t[1]<this.mid)this.left?4*(this.left.count+1)>3*(i+1)?u(this,t):this.left.insert(t):this.left=p([t]);else if(t[0]>this.mid)this.right?4*(this.right.count+1)>3*(i+1)?u(this,t):this.right.insert(t):this.right=p([t]);else{var r=n.ge(this.leftPoints,t,v),e=n.ge(this.rightPoints,t,P);this.leftPoints.splice(r,0,t),this.rightPoints.splice(e,0,t)}},s.remove=function(t){var i=this.count-this.leftPoints;if(t[1]<this.mid)return this.left?4*(this.right?this.right.count:0)>3*(i-1)?f(this,t):2===(o=this.left.remove(t))?(this.left=null,this.count-=1,1):(1===o&&(this.count-=1),o):0;if(t[0]>this.mid)return this.right?4*(this.left?this.left.count:0)>3*(i-1)?f(this,t):2===(o=this.right.remove(t))?(this.right=null,this.count-=1,1):(1===o&&(this.count-=1),o):0;if(1===this.count)return this.leftPoints[0]===t?2:0;if(1===this.leftPoints.length&&this.leftPoints[0]===t){if(this.left&&this.right){for(var r=this,e=this.left;e.right;)r=e,e=e.right;if(r===this)e.right=this.right;else{var s=this.left,o=this.right;r.count-=e.count,r.right=e.left,e.left=s,e.right=o}h(this,e),this.count=(this.left?this.left.count:0)+(this.right?this.right.count:0)+this.leftPoints.length}else this.left?h(this,this.left):h(this,this.right);return 1}for(s=n.ge(this.leftPoints,t,v);s<this.leftPoints.length&&this.leftPoints[s][0]===t[0];++s)if(this.leftPoints[s]===t){this.count-=1,this.leftPoints.splice(s,1);for(o=n.ge(this.rightPoints,t,P);o<this.rightPoints.length&&this.rightPoints[o][1]===t[1];++o)if(this.rightPoints[o]===t)return this.rightPoints.splice(o,1),1}return 0},s.queryPoint=function(t,i){if(t<this.mid){if(this.left)if(r=this.left.queryPoint(t,i))return r;return l(this.leftPoints,t,i)}if(t>this.mid){var r;if(this.right)if(r=this.right.queryPoint(t,i))return r;return c(this.rightPoints,t,i)}return g(this.leftPoints,i)},s.queryInterval=function(t,i,r){var n;if(t<this.mid&&this.left&&(n=this.left.queryInterval(t,i,r)))return n;if(i>this.mid&&this.right&&(n=this.right.queryInterval(t,i,r)))return n;return i<this.mid?l(this.leftPoints,i,r):t>this.mid?c(this.rightPoints,t,r):g(this.leftPoints,r)};var y=d.prototype;y.insert=function(t){this.root?this.root.insert(t):this.root=new e(t[0],null,null,[t],[t])},y.remove=function(t){if(this.root){var i=this.root.remove(t);return 2===i&&(this.root=null),0!==i}return!1},y.queryPoint=function(t,i){if(this.root)return this.root.queryPoint(t,i)},y.queryInterval=function(t,i,r){if(t<=i&&this.root)return this.root.queryInterval(t,i,r)},Object.defineProperty(y,"count",{get:function(){return this.root?this.root.count:0}}),Object.defineProperty(y,"intervals",{get:function(){return this.root?this.root.intervals([]):[]}})},{"binary-search-bounds":"binary-search-bounds"}]},{},[]);</script>
    <!--For Using utility functions-->
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.19/lodash.min.js"></script>
    <script> lodash = _.noConflict(); // load script of lodash </script> 
    <!--Plotly-->
    <script src="https://cdn.plot.ly/plotly-1.54.7.min.js"></script>
    <!--PDB Mol*-->
    <script type="text/javascript" src="https://www.ebi.ac.uk/pdbe/pdb-component-library/js/pdbe-molstar-plugin-1.1.0-dev.4.js"></script>
    <!--For loading large csv files-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.2.0/papaparse.min.js"></script>
    <!--Python's Numpy-like Library, NumJS-->
    <script src="https://cdn.jsdelivr.net/gh/nicolaspanel/numjs@0.15.1/dist/numjs.min.js"></script>
    <!--D3 to draw tables-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
    <!--chroma to draw colormaps-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/2.1.0/chroma.min.js"></script>
    <!--hotkeys to add keyboard shortcuts-->
    <script src="https://cdn.jsdelivr.net/npm/hotkeys-js@3.8.1/dist/hotkeys.min.js" integrity="sha256-4nmnbhmVpr2Rg64+7ysAr93+vQrfc0UvHWwm4W6uXJM=" crossorigin="anonymous"></script>
    
    <!--Datatable for efficient visualization of tabular data-->
    <!--full: jquery.dataTables.js, jquery.dataTables.css-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.min.css">
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js" crossorigin="anonymous"></script>
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
    <!-- dataframe.js for useful dataframe functions -->
    <script src="https://cdn.jsdelivr.net/npm/dataframe-js@1.4.3/dist/dataframe.min.js" integrity="sha256-ncD0rnpkULRQhB+hFzhFCQ4KBu+NKVYEQHyhxsUA29Q=" crossorigin="anonymous"></script>
    <!-- FileSaver.js to save js object as local files -->
    <script src="https://cdn.jsdelivr.net/npm/filesaver.js@1.3.4/FileSaver.min.js" integrity="sha256-5IjlS/EkXaEXRrVOMusSOlmQsyFy3DvCD5QC5mJZubU=" crossorigin="anonymous"></script>
    <!-- Html2Canvas.js to save current view as a PNG file -->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.0.0-rc.7/dist/html2canvas.min.js" integrity="sha256-Ax1aqtvxWBY0xWND+tPZVva/VQZy9t1Ce17ZJO+NTRc=" crossorigin="anonymous"></script>
    <!--To use font-awesome icons -->
<!--     <script src="https://kit.fontawesome.com/b773d81884.js" crossorigin="anonymous"></script> -->
    <!-- Fussy search package for alignment of given peptide sequences to consensus sequence -->
<!--     <script src="https://cdn.jsdelivr.net/npm/fuse-js-latest@3.1.0/dist/fuse.min.js" integrity="sha256-7f3wLI5WWMPufBdf3U8CNW6K7WYPoO83Iqvr+dd6k4Q=" crossorigin="anonymous"></script> -->
    <!--React and React-Bootstrap library-->
<!--     <script src="https://unpkg.com/react/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-bootstrap@next/dist/react-bootstrap.min.js" crossorigin></script>
    <script>var Alert = ReactBootstrap.Alert;</script> -->
    <style>
      * { box-sizing: border-box; }
        /* Create two equal columns that floats next to each other */
        .column {
          float: left;
          width: 50%;
          padding: 10px;
          height: 450px; /* Should be removed. Only for demonstration */
          position:relative;
        }
        /* Clear floats after the columns */
        .responsive_row_with_two_columns:after {
          float:left;
          content: "";
          display: table;
          clear: both;
        }
        /* Responsive layout - makes the two columns stack on top of each other instead of next to each other */
        @media screen and (max-width: 700px) {
          .column {
            width: 100%;
          }
        }
        .deconstructed_pancake_box { /* example in https://web.dev/one-line-layouts/ */
            flex: 1 1 450px;
            margin: 5px;
        }
        .deconstructed_pancake_parent {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }
        .container_molstar {
          height: 600px; /* Should be modified */
          position:relative;
        }
        #container_d3_table_metrics{
          display: grid;
          grid-template-rows: auto 1fr auto;
          position:relative;
        }
        #plotly_graph_molecular_mimicry_map{
            float:left;
            width:100%;
            padding: 5px;
            height:575px;
            position:relative;
            overflow:hidden;
        }
        .graph_for_selection{
            float:left;
            width:100%;
            height:350px;
            position:relative;
        }
/*    custom bootstrap button color   */
        .bg-custom-navbar{  /* custom navbar color and gradient (color representing lupus awareness color) */
            background-image: linear-gradient( 15deg, #46137a 0%, #f08dee 100%);
        }
        .bg-custom-navbar-hidden{  /* custom navbar color and gradient (color representing lupus awareness color) */
            border-left: 6px solid #ccc;
            border-bottom: 3px solid #ccc;
            color: #000;
            border-color: #6b0596;
            background-color: #f8f7fa;
/*             '#fce6ff; #dfdae6; #f3f0f7; */
        }
        .bg-custom-navbar-top{  /* custom navbar color and gradient (color representing lupus awareness color) */
            background-image: linear-gradient( 0deg, #ababab 0%, #f7f7f7 100%);
        }
        /* CSS for D3 Table */
        table { border-collapse: collapse; color: #333; background-color: #F7F6F3; margin: auto; } /* place the table in the middle of div */
        table thead { font-weight: bold; background-color: #CCC; cursor: default; text-align: center; }
        table tbody tr:hover { background-color: #FFC; }
        td { border: solid 1px #CCC; padding: 0 1ex; }
        .table_even { color: #284775; background-color: White; }
        .table_left { text-align: left; }
        .table_center { text-align: center; }
        .table_right { text-align: right; }
        .table_add { color: green; }
        .table_minus { color: red; }
        
        #button_scroll_to_the_top { /* CSS for Scroll Back To Top Button */
          display: none; /* Hidden by default */
          position: fixed; /* Fixed/sticky position */
          bottom: 20px; /* Place the button at the bottom of the page */
          right: 30px; /* Place the button 30px from the right */
          z-index: 99; /* Make sure it does not overlap */
          border: none; /* Remove borders */
          outline: none; /* Remove outline */
          background-color: DarkViolet; /* Set a background color */
          color: white; /* Text color */
          cursor: pointer; /* Add a mouse pointer on hover */
          padding: 15px; /* Some padding */
          border-radius: 10px; /* Rounded corners */
          font-size: 18px; /* Increase font size */
        }

        #button_scroll_to_the_top:hover {
          background-color: #555 ; /* Indigo Add a dark-grey background on hover */
        }
        .helpIcon
        {
          cursor: pointer;
          padding-top:12px;
        }
        i.icon-white {
            color: white;
            display:inline-flex;
            vertical-align:middle;
        }
        i.icon-black {
            color: black;
            display:inline-flex;
            vertical-align:middle;
        }
        /* for labeled buttons */
        .btn-label {position: relative;left: -12px;display: inline-block;padding: 6px 12px;background: rgba(0,0,0,0.1);border-radius: 3px 0 0 3px;}
        .btn-labeled {padding-top: 0;padding-bottom: 0;}
        .btn { margin-bottom:10px; }
        /* for  div. displayed during loading (https://stackoverflow.com/questions/54439548/display-loading-symbol-while-waiting-for-a-result-with-plot-ly-dash) */
        @keyframes fadein {
            0% {
                opacity: 0;
            }
            100% {
                opacity: 0.5;
            }
        }
        ._plotly-loading-callback {
          font-family: sans-serif;
          padding-top: 50px;
          color: rgb(90, 90, 90);

          /* The banner */
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          text-align: center;
          cursor: progress;

          opacity: 0;
          background-color: rgb(250, 250, 250);
          /* Delay animation by 1s to prevent flashing 
             and smoothly transition the animation over 0.5s 
           */
          -moz-animation: fadein 0.5s ease-in 1s forwards; /* Firefox */
          -webkit-animation: fadein 0.5s ease-in 1s forwards; /* Safari and Chrome */
          -o-animation: fadein 0.5s ease-in 1s forwards; /* Opera */
            animation: fadein 0.5s ease-in 1s forwards;
        }
        .carousel-caption {
                color: black;
            }
        /* for loading SVG images */
/*         .loader{
          margin: 0 0 2em;
          height: 100px;
          width: 100%;
          text-align: center;
          padding: 1em;
          margin: 0 auto 1em;
          display: inline-block;
          vertical-align: top;
        } */

    /* CSS for full-screen modal */
    </style>
    <!-- icon of the document -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2020%2020'%3E%3Ctext%20x='0'%20y='16'%20style='filter:%20invert(100%);'%3E⚕️%3C/text%3E%3C/svg%3E" type="image/svg+xml" />
</head>

<body>
 <!-- where captured current view is stored as a data URL  -->
<a id="anchor-current-view" href="#" hidden></a>
</div>
<!-- start of the current view container -->
<div id="molecularmimicrymap-current-view">
<nav class="navbar navbar-expand-lg navbar-dark bg-custom-navbar"> <!-- sticky-top -->
    <a class="navbar-brand mb-0 h1">Molecular Mimicry Map of SARS-CoV-2</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav_top" aria-controls="navbarNav_top" aria-expanded="false" aria-label="Toggle top navigation"><span class="navbar-toggler-icon"></span></button>
    <div class="collapse navbar-collapse" id="navbarNav_top">
        <ul class="navbar-nav">
            <li class="nav-item active">
                <a class="nav-link" type="button" data-toggle="collapse" data-target="#introduction" aria-controls="introduction" aria-expanded="false" aria-label="Toggle introduction" onclick="Toggle_Introduction_Modal( )">Introduction</a>
            </li>
<!--             <li class="nav-item active">
                <a class="nav-link" type="button" data-toggle="collapse" data-target="#container_fileLoader" aria-controls="container_fileLoader" aria-expanded="false" aria-label="Toggle container_fileLoader">Files</a>
            </li> -->
            <li class="nav-item">
                <a class="nav-link">Citation</a>
            </li>
            <li class="nav-item">
                <a class="nav-link">Feedback</a>
            </li>
        </ul>
        <button type="button" class="btn btn-light bth-sm ml-auto mr-1 my-0" aria-label="capture current view and download it as a PNG file" data-tooltip="tooltip" data-placement="left" data-html="true" title="Capture <b>current view</b> and download it as a PNG file" onclick="DownloadCurrentView( )"><i class="material-icons icon-black" style="font-size:25px">camera_alt</i></button>
        <button type="button" class="btn btn-light bth-sm ml-1 mr-1 my-0" aria-label="show keyboard shortcuts" data-tooltip="tooltip" data-placement="bottom" data-html="true" title="Press to show <b>keyboard shortcuts</b>" onclick="$( '#modal_keyboard_shortcuts' ).modal( 'show' )"><i class="material-icons icon-black" style="font-size:25px">keyboard</i></button>
        <button type="button" class="btn btn-light bth-sm ml-1 my-0" aria-label="toggle tooltips" data-tooltip-always-active="tooltip" data-placement="bottom" data-html="true" title="Press to <b>on/off</b> help messages on mouse over (hover) of certain buttons" onclick="Toggle_Tooltips( )"><i class="material-icons icon-black" style="font-size:25px">help_outline</i></button>
    </div>
</nav>
<button onclick="Scroll_to_the_Top( )" id="button_scroll_to_the_top" title="Go to top">Top</button>
<div>
    <div class="collapse" id="container_fileLoader"><div><input type="file" id="file-selector" multiple></div></div>
</div>
<div id="molecular_mimicry_map">
    <div id="container_molecular_mimicry_map">
        <div id="controlBox_plotly_graph_molecular_mimicry_map">
            <div class="pos-f-t">
                <nav class="navbar navbar-dark bg-custom-navbar">
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarToggleExternalContent__plotly_graph_molecular_mimicry_map" aria-controls="navbarToggleExternalContent__plotly_graph_molecular_mimicry_map" aria-expanded="false" aria-label="Toggle navigation" data-tooltip="tooltip" data-placement="right" data-html="true" title="Press to change default graph settings and turn on/off tracks"><i class="material-icons icon-white" style="font-size:20px;cursor:pointer">settings</i></button>
                        
<!--                     <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarToggleExternalContent__plotly_graph_molecular_mimicry_map" aria-controls="navbarToggleExternalContent__plotly_graph_molecular_mimicry_map" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button> -->
<!--                     <a class="navbar-brand mb-0 h1">Molecular Mimicry Map</a> -->
                    <form class="form-inline">
                        <button class="btn btn-light btn-sm mx-1 my-0" type="button" data-toggle="button" data-tooltip="tooltip" data-placement="left" data-html="true" title="Press to <b>on/off</b> the <i>legend</i> of the graph" id="button_toggle_legend_MolecularMimicryMap" onclick="Toggle_Legend_MolecularMimicryMap( )"><i class="material-icons icon-black" style="font-size:20px">list</i></button>
                        <button class="btn btn-light btn-sm mx-1 my-0" type="button" data-toggle="button" data-tooltip="tooltip" data-placement="bottom" data-html="true" title="Press to <b>on/off</b> displaying <i>record details</i> on hover (mouse over). It will <b>also disable click events</b>." id="button_toggle_hovermode_MolecularMimicryMap" onclick="Toggle_Hovermode_MolecularMimicryMap( )"><i class="material-icons icon-black" style="font-size:20px">article</i></button>
                        
                        <div class="btn-group-toggle ml-1 mr-1 my-0" data-toggle="buttons" data-tooltip="tooltip" data-placement="bottom" data-html="true" title="Press to <b>toggle</b> B-cell cross-reactivity prediction data" aria-label="Press to toggle B-cell cross-reactivity prediction data"><label class="btn btn-light btn-sm active"><input type="checkbox" id="checkbox_toggle_BCellCrossReactivityPrediction_MolecularMimicryMap" checked onclick="Toggle_BCellCrossReactivityPrediction_MolecularMimicryMap( )" autocomplete="off">B-Cell Cross-Reactivity Prediction</label></div>
                        <div class="btn-group-toggle ml-0 mr-1 my-0" data-toggle="buttons" data-tooltip="tooltip" data-placement="bottom" data-html="true" title="Press to <b>toggle</b> T-cell cross-reactivity prediction data" aria-label="Press to toggle T-cell cross-reactivity prediction data"><label class="btn btn-light btn-sm active"><input type="checkbox" id="checkbox_toggle_TCellCrossReactivityPrediction_MolecularMimicryMap" checked onclick="Toggle_TCellCrossReactivityPrediction_MolecularMimicryMap( )" autocomplete="off">T-Cell Cross-Reactivity Prediction</label></div>
                        <div class="btn-group-toggle mx-1 my-0" data-toggle="buttons" data-tooltip="tooltip" data-placement="bottom" data-html="true" title="Press to <b>toggle</b> SARS-CoV-2 virus protein annotations and InterPro protein domain annotations" aria-label="Press to toggle SARS-CoV-2 virus protein annotations and InterPro protein domain annotations"><label class="btn btn-light btn-sm active"><input type="checkbox" id="checkbox_toggle_VirusProteinAnnotation_MolecularMimicryMap" checked onclick="Toggle_VirusProteinAnnotation_MolecularMimicryMap( )" autocomplete="off">Virus Protein Annotations</label></div>
                        <div class="btn-group-toggle mx-1 my-0" data-toggle="buttons" data-tooltip="tooltip" data-placement="bottom" data-html="true" title="Press to <b>toggle</b> immuno prediction data" aria-label="Press to toggle visibility of B-cell cross-reactivity prediction data and T-cell cross-reactivity prediction data"><label class="btn btn-light btn-sm active"><input type="checkbox" id="checkbox_toggle_vaccine_metrics_MolecularMimicryMap" checked onclick="VaccineMetrics_Apply_Visibility( )" autocomplete="off">Vaccine Metrics</label></div>
                        <div class="btn-group-toggle mx-1 my-0" data-toggle="buttons" data-tooltip="tooltip" data-placement="bottom" data-html="true" title="Press to <b>toggle</b> <i>immunogenicity prediction data</i> (MHC binding prediction) and <i>number of mutated proteins</i> for each mutation" aria-label="Press to toggle immunogenicity prediction data (MHC binding prediction) and number of mutated proteins for each mutation"><label class="btn btn-light btn-sm active"><input type="checkbox" id="checkbox_toggle_iedb_epitope_virus_MolecularMimicryMap" checked onclick="Toggle_IEDB_Epitope_Virus_MolecularMimicryMap( )" autocomplete="off">IEDB Epitopes</label></div>
                        <div class="btn-group-toggle mx-1 my-0" data-toggle="buttons" data-tooltip="tooltip" data-placement="bottom" data-html="true" title="Press to <b>toggle</b> potential (peptide) <b>vaccine candidates</b>." aria-label="Press to toggle potential (peptide) vaccine candidates."><label class="btn btn-light btn-sm active"><input type="checkbox" id="checkbox_toggle_vaccine_design_MolecularMimicryMap" checked onclick="Toggle_VaccineDesign_MolecularMimicryMap( )" autocomplete="off">Vaccine Candidates</label></div>
                        <button class="btn btn-light btn-sm mx-1 my-0" type="button" data-toggle="collapse" data-toggle="button" data-target="#navbar_vaccine_design" aria-expanded="false" aria-controls="navbar_vaccine_design" data-tooltip="tooltip" data-placement="bottom" data-html="true" title="Press to <b>toggle</b> a panel for <i>designing (peptide) vaccine candidates</i> against SARS-CoV-2 virus, considering <b>both</b> <i>immunogenicity</i> <b>and</b> <i>potential molecular mimicry</i> between the virus and human. (could be important for people predisposed to autoimmune diseases)" aria-label="Press to toggle a panel for designing a (peptide) vaccine candidate against SARS-CoV-2 virus, considering both immunogenicity and potential molecular mimicry between the virus and human.">Vaccine Design Panel</button>
                    </form>
                </nav>
                <div class="collapse" id="navbarToggleExternalContent__plotly_graph_molecular_mimicry_map">
                    <div class="bg-custom-navbar-hidden p-4">
                        <h4 class="text-black">Molecular Mimicry Map of SARS-CoV-2 Graph Setting Panel</h4>
                        <p>
                            <h5 class="text-muted">General Setting</h5>
                            <div class="btn-toolbar" role="toolbar">
                                <div class="input-group mx-2 my-2">
                                    <div class="input-group-prepend"><span class="input-group-text">Plot height is</span></div>
                                    <input type="text" class="form-control" aria-label="height of the plot in pixel" id="input_plot_height_MolecularMimicryMap" title="input field for setting the height of Molecular Mimicry Map plot in pixels" value="750">
                                    <div class="input-group-append"><span class="input-group-text">pixels</span></div>
                                </div>
                            </div>
                        </p>
                        <p>
                            <h5 class="text-muted">B Cell Cross-Reactivity Prediction Data</h5>
                            <div class="btn-toolbar" role="toolbar">
                                <div class="input-group mx-2 my-2">
                                    <div class="input-group-prepend"><span class="input-group-text">Plot top</span></div>
                                    <input type="text" class="form-control" aria-label="the number of alignments for plotting" id="input_n_alignments_for_plotting_BCellCrossReactivity" title="input field for setting the number of alignments for plotting B Cell Cross-Reactivity prediciton data" value="5000">
                                    <div class="input-group-append"><span class="input-group-text">most significant</span></div>
                                    <select class="custom-select w-auto" id="select_redundancy_level_BCellCrossReactivity" title="select redundancy level of B cell cross-reactivity prediction data">
                                        <option value="nonredundant_position">select redundancy level</option>
                                        <option value="all" disabled>alignments (100%)</option>
                                        <option value="nonredundant_sequence">non-redundant alignments with unique aligned sequences (~15%)</option>
                                        <option value="nonredundant_position" selected>non-redundant alignments with unique aligned positions (~5%)</option>
                                    </select>
                                    <div class="input-group-prepend"><label class="input-group-text" for="select_windowSize_BCellCrossReactivity">for window size of</label></div>
                                    <select class="custom-select w-auto" id="select_windowSize_BCellCrossReactivity" title="window size for B cell cross-reactivity prediction data">
                                        <option value="30">select window size</option>
                                        <option value="5">5</option>
                                        <option value="8">8</option>
                                        <option value="11">11</option>
                                        <option value="14">14</option>
                                        <option value="17">17</option>
                                        <option value="20" selected>20</option>
                                        <option value="25">25</option>
                                        <option value="30">30</option>
                                        <option value="35">35</option>
                                        <option value="45">45</option>
                                        <option value="55">55</option>
                                        <option value="70">70</option>
                                        <option value="85">85</option>
                                        <option value="100">100</option>
                                        <option value="125">125</option>
                                        <option value="150">150</option>
                                    </select>
                                    <div class="input-group-append"><label class="input-group-text" for="select_windowSize_BCellCrossReactivity">amino acids.</label></div>
                                </div>
                                <div class="input-group mx-2 my-2">
                                    <div class="input-group-prepend"><label class="input-group-text" for="select_representation_of_an_alignment_BCellCrossReactivity">Represent each alignment with a</label></div>
                                    <select class="custom-select w-auto" id="select_representation_of_an_alignment_BCellCrossReactivity" title="select a representation of an alignment in B cell cross-reactivity prediction data">
                                        <option value="1">select a representation</option>
                                        <option value="0" selected>point (faster)</option>
                                        <option value="1">line (slower)</option>
                                    </select>
                                    <div class="input-group-append"><label class="input-group-text" for="select_representation_of_an_alignment_BCellCrossReactivity">on a</label></div>
                                    <select class="custom-select w-auto" id="select_graphic_format_BCellCrossReactivity" title="select a graphic format of representations of B cell cross-reactivity prediction data">
                                        <option value="0">select a graphic format</option>
                                        <option value="0" selected>bitmap (faster)</option>
                                        <option value="1">vector (scalable, but slower)</option>
                                    </select>
                                    <div class="input-group-append"><label class="input-group-text" for="select_graphic_format_BCellCrossReactivity">image.</label></div>
                                </div>
                            </div>
                        </p>
                        <p>
                            <h5 class="text-muted">T Cell Cross-Reactivity Prediction Data</h5>
                            <div class="btn-toolbar" role="toolbar">
                                <div class="input-group mx-2 my-2">
                                    <div class="input-group-prepend"><span class="input-group-text">Plot top</span></div>
                                    <input type="text" class="form-control" aria-label="the number of alignments for plotting" id="input_n_alignments_for_plotting_TCellCrossReactivity" title="input field for setting the number of alignments for plotting T Cell Cross-Reactivity prediciton data" value="5000">
                                    <div class="input-group-append"><span class="input-group-text">most significant</span></div>
                                    <select class="custom-select w-auto" id="select_redundancy_level_TCellCrossReactivity" title="select redundancy level of T cell cross-reactivity prediction data">
                                        <option value="nonredundant_aligned_position">select redundancy level</option>
                                        <option value="all">alignments (100%)</option>
                                        <option value="nonredundant_aligned_sequence">non-redundant alignments with unique aligned sequences (~95%)</option>
                                        <option value="nonredundant_aligned_position" selected>non-redundant alignments with unique aligned positions (~55%)</option>
                                    </select>
                                    <div class="input-group-prepend"><label class="input-group-text" for="select_MHC_class_TCellCrossReactivity">for MHC class I and II molecules.</label></div>
                                </div>
                                <div class="input-group mx-2 my-2">
                                    <div class="input-group-prepend"><label class="input-group-text" for="select_representation_of_an_alignment_TCellCrossReactivity">Represent each pair of predicted binding scores with a</label></div>
                                    <select class="custom-select w-auto" id="select_representation_of_an_alignment_TCellCrossReactivity" title="select a representation for a pair of predicted binding scores in T cell cross-reactivity prediction data">
                                        <option value="1">select a representation</option>
                                        <option value="0" selected>point (Y down/up)</option>
                                        <option value="1">point (star-triangle down/up)</option>
                                        <option value="2">point (bowtie/hourglass)</option>
                                    </select>
                                    <div class="input-group-append"><label class="input-group-text" for="select_representation_of_an_alignment_TCellCrossReactivity">(human/virus) on a</label></div>
                                    <select class="custom-select w-auto" id="select_graphic_format_TCellCrossReactivity" title="select a graphic format of representations of T cell cross-reactivity prediction data">
                                        <option value="0">select a graphic format</option>
                                        <option value="0" selected>bitmap (faster)</option>
                                        <option value="1">vector (scalable, but slower)</option>
                                    </select>
                                    <div class="input-group-append"><label class="input-group-text" for="select_graphic_format_TCellCrossReactivity">image.</label></div>
                                </div>
                            </div>
                        </p>
                        <p><button type="button" class="btn btn-secondary btn-block mx-2 my-2" onclick="DrawMolecularMimicryMap( ); Loading_Screen( false );">Load and Draw</button></p>
                        <p>
                            <h4 class="text-muted">Tracks</h4>
                            <div class="btn-toolbar" role="toolbar">
                                <div class="btn-group-toggle" data-toggle="buttons"><label class="btn btn-outline-secondary ml-2 my-2"><input type="checkbox" id="checkbox_toggle_vaccine_metric_count_non_consensus_residue" checked onclick="VaccineMetrics_Apply_Visibility( )" autocomplete="off">Mutation Counts</label></div>
                                <select class="custom-select w-auto mr-2 my-2" id="select_vaccine_metric_count_non_consensus_residue" title="select country for displaying mutation counts (counts of non-consensus residues)">
                                    <option value="count_non_consensus_residue">select country</option>
                                    <option value="count_non_consensus_residue" selected>global</option>
                                    <option value="count_non_consensus_residue__USA">USA</option>
                                    <option value="count_non_consensus_residue__Australia">Australia</option>
                                    <option value="count_non_consensus_residue__India">India</option>
                                </select>
                                <div class="btn-group-toggle" data-toggle="buttons"><label class="btn btn-outline-secondary mx-2 my-2"><input type="checkbox" id="checkbox_toggle_vaccine_metric_relative_accessible_surface_area" onclick="VaccineMetrics_Apply_Visibility( )" autocomplete="off">Accessible Surface</label></div>
                            </div>
                            <div class="btn-toolbar" role="toolbar">
                                <div class="btn-group-toggle" data-toggle="buttons"><label class="btn btn-outline-secondary mx-2 my-2"><input type="checkbox" id="checkbox_toggle_vaccine_metric_iedb_t_cell_assay" onclick="VaccineMetrics_Apply_Visibility( )" autocomplete="off">IEDB Positive T-Cell Assay Counts</label></div>
                                <div class="btn-group-toggle" data-toggle="buttons"><label class="btn btn-outline-secondary ml-2 my-2"><input type="checkbox" id="checkbox_toggle_vaccine_metric_mhc_i_binding_prediction" checked onclick="VaccineMetrics_Apply_Visibility( )" autocomplete="off">MHC-I Binding Peptide Counts (MHCflurry)</label></div>
                                <select class="custom-select w-auto mr-2 my-2" id="select_vaccine_metric__mhc_i_binding_peptide_count" title="select a minimum allele frequency threshold for defining common MHC-I alleles">
                                    <option value="count_peptide_binding_common_mhc_i_alleles__537_alleles__min_allele_frequency_0.001">allele frequency (# alleles)</option>
                                    <option value="count_peptide_binding_common_mhc_i_alleles__8_alleles__min_allele_frequency_0.5">0.5 (8)</option>
                                    <option value="count_peptide_binding_common_mhc_i_alleles__100_alleles__min_allele_frequency_0.1">0.1 (100)</option>
                                    <option value="count_peptide_binding_common_mhc_i_alleles__308_alleles__min_allele_frequency_0.01">0.01 (308)</option>
                                    <option value="count_peptide_binding_common_mhc_i_alleles__537_alleles__min_allele_frequency_0.001" selected>0.001 (537)</option>
                                </select>
                                <div class="btn-group-toggle" data-toggle="buttons"><label class="btn btn-outline-secondary mx-2 my-2"><input type="checkbox" id="checkbox_toggle_vaccine_metric_mhc_i_processing_score" onclick="VaccineMetrics_Apply_Visibility( )" autocomplete="off">MHC-I Ligand Processing Score Pred. (MHCflurry)</label></div>
                            </div>
                            <div class="btn-toolbar" role="toolbar">
                                <div class="btn-group-toggle" data-toggle="buttons"><label class="btn btn-outline-secondary mx-2 my-2"><input type="checkbox" id="checkbox_toggle_vaccine_metric_iedb_b_cell_assay" onclick="VaccineMetrics_Apply_Visibility( )" autocomplete="off">IEDB Positive B-Cell Assay Counts</label></div>
                                <div class="btn-group-toggle" data-toggle="buttons"><label class="btn btn-outline-secondary ml-2 my-2"><input type="checkbox" id="checkbox_toggle_vaccine_metric_mhc_ii_binding_prediction" checked onclick="VaccineMetrics_Apply_Visibility( )" autocomplete="off">MHC-II Binding Peptide Counts (netMHCIIpan)</label></div>                  
                                <select class="custom-select w-auto mr-2 my-2" id="select_vaccine_metric__mhc_ii_binding_peptide_count" title="select a minimum allele frequency threshold for defining common MHC-II alleles">
                                    <option value="count_peptide_binding_common_mhc_ii_alleles__1668_alleles__min_allele_frequency_0.001">allele frequency (# alleles)</option>
                                    <option value="count_peptide_binding_common_mhc_ii_alleles__19_alleles__min_allele_frequency_0.5">0.5 (19)</option>
                                    <option value="count_peptide_binding_common_mhc_ii_alleles__273_alleles__min_allele_frequency_0.1">0.1 (273)</option>
                                    <option value="count_peptide_binding_common_mhc_ii_alleles__865_alleles__min_allele_frequency_0.01">0.01 (865)</option>
                                    <option value="count_peptide_binding_common_mhc_ii_alleles__1668_alleles__min_allele_frequency_0.001" selected>0.001 (1668)</option>
                                </select>
                                <div class="btn-group-toggle" data-toggle="buttons"><label class="btn btn-outline-secondary mx-2 my-2"><input type="checkbox" id="checkbox_toggle_vaccine_metric_bepipred" onclick="VaccineMetrics_Apply_Visibility( )" autocomplete="off">Linear B-Cell Epitope Pred. Score (BepiPred)</label></div>
                            </div>
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <div id="navbar_vaccine_design" class="collapse">
            <nav class="navbar navbar-dark bg-custom-navbar">
                <div class="btn-toolbar" role="toolbar">
                    <div class="input-group ml-1 mr-1 my-1">
                        <div class="input-group-prepend"><label class="input-group-text" for="select_yaxis_plot_vaccine_design">Y-axis:</label></div>
                        <select class="custom-select w-auto" id="select_yaxis_plot_vaccine_design" title="select yaxis for visualization of vaccine candidates" onchange="Draw_DesignedVaccineTrace( 'update_name_y_axis' )">
                            <option value="random_value">select y-axis value</option>
                            <option value="number_of_overlapped_potential_b_cell_cross_reactive_epitopes">number of overlapped predicted B-cell cross-reactive epitopes</option>
                            <option value="number_of_overlapped_potential_t_cell_cross_reactive_epitopes" selected>number of overlapped predicted T-cell cross-reactive MHC epitopes</option>
                            <option value="count_non_consensus_residue">number of mutated proteins</option>
                            <option value="avg_processing_score_mhc_i">MHC-I processing score (MHCflurry)</option>
                            <option value="score_linear_bcell_epitope_prediction__bepipred">B cell epitope pred. score (BepiPred)</option>
                            <option value="random_value">random</option>
                            <option value="count_peptide_binding_common_mhc_i_alleles__537_alleles__min_allele_frequency_0.001">number of overlapped predicted MHC-I epitopes (min allele freq. 0.001)</option>
                            <option value="count_peptide_binding_common_mhc_ii_alleles__1668_alleles__min_allele_frequency_0.001">number of overlapped predicted MHC-II epitopes (min allele freq. 0.001)</option>
                            <option value="relative_accessible_surface_area">relative accessible surface area</option>
                        </select>
                        <div class="input-group-prepend"><label class="input-group-text" for="input_y_axis_range_max">from 0 to</label></div>
                        <input type="text" class="form-control" aria-label="An input box for the max value of the Y-axis range of potential vaccine candidate track" id="input_y_axis_range_max" data-tooltip="tooltip" data-placement="top" data-html="true" title="An <b>max value of</b> the Y-axis range of potential vaccine candidate track" placeholder="max value" onchange="Draw_DesignedVaccineTrace( 'update_float_y_axis_range_max' )">
                    </div>
                </div>
                <form class="form-inline">
                    <button class="btn btn-labeled btn-warning mx-2 my-1" type="button" onclick="AnalyzeVaccineDesign( );Draw_DesignedVaccineTrace( 'new_analysis' )" aria-expanded="false" aria-controls="container_file_vaccine_design" data-tooltip="tooltip" data-placement="bottom" data-html="true" title="Press to load a FASTA file containing peptide vaccine candidates<br><em>the file is not uploaded to any server, but analyzed locally in this browser</em>"><span class="btn-label"><i class="material-icons icon-black" style="font-size:20px;cursor:pointer">refresh</i></span>Analyze with Current View</button> 
                    <button class="btn btn-labeled btn-light mx-2 my-1" type="button" onclick="$( '#modal_choose_fasta' ).modal( 'show' )" data-tooltip="tooltip" data-placement="bottom" data-html="true" title="Press to load a FASTA file containing peptide vaccine candidates<br><em>the file is not uploaded to any server, but analyzed locally in this browser</em>"><span class="btn-label"><i class="material-icons icon-black" style="font-size:20px;cursor:pointer">publish</i></span>Choose Fasta</button> 
                    <button class="btn btn-labeled btn-light mx-2 my-1" type="button" onclick="$( '#modal_generate_peptides' ).modal( 'show' )" data-tooltip="tooltip" data-placement="bottom" data-html="true" title="Press to <b>retrieve every peptides</b> from the <i>consensus SARS-CoV-2 proteome</i> for vaccine design in addition to using already developed peptide vaccine candidates."><span class="btn-label"><i class="material-icons icon-black" style="font-size:20px;cursor:pointer">line_style</i></span>Generate Peptides</button>
                    <button class="btn btn-labeled btn-light mx-2 my-1" type="button" onclick="$( '#modal_select_peptides' ).modal( 'show' )" data-html="true" data-tooltip="tooltip" data-placement="bottom" title="Press to <b>select</b> peptides"><span class="btn-label"><i class="material-icons icon-black" style="font-size:20px;cursor:pointer">rule</i></span>Select Peptides</button>
                    <button class="btn btn-labeled btn-light mx-2 my-1" type="button" onclick="Download_Analysis_Result__Vaccine_Design( )" data-html="true" data-tooltip="tooltip" data-placement="bottom" title="Press to <b>download</b> analysis result in a <i>CSV</i> file"><span class="btn-label"><i class="material-icons icon-black" style="font-size:20px;cursor:pointer">get_app</i></span>Download Result</button> 
                </form>
                <button type="button" class="close" aria-label="Close navbar_vaccine_design" data-toggle="collapse" data-target="#navbar_vaccine_design"><span aria-hidden="true">&times;</span></button>
            </nav>
        </div>
        <div id="container_graph_molecular_mimicry_map">
            <div id="plotly_graph_molecular_mimicry_map"></div>
            <div id="container_d3_table_metrics">
                </div>
            </div>
        </div>
    </div>
    <div>
        <nav class="navbar navbar-dark bg-custom-navbar">
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarToggleExternalContent_supplementary_graph_setting_panel" aria-controls="navbarToggleExternalContent_supplementary_graph_setting_panel" aria-expanded="false" aria-label="Toggle supplementary plot setting panel" data-tooltip="tooltip" data-placement="right" data-html="true" title="Press to <b>select or remove columns</b> in for <i>parallel coordinate graphs</i> for filtering cross-reactivity prediction data"><i class="material-icons icon-white" style="font-size:20px;cursor:pointer">settings</i></button>
            <form class="form-inline">
                <button class="btn btn-light btn-sm mx-1 my-0" type="button" aria-expanded="false" aria-controls="plotly_graph_b_cell_cross_reactivity" onclick="Toggle_Exclusive_Tabs( '#plotly_graph_b_cell_cross_reactivity' )"data-tooltip="tooltip" data-placement="bottom" data-html="true" title="Press to <b>toggle</b> a parallel coordinate graph for <i>filtering</i> B-cell cross-reactivity prediction data" aria-label="Press to toggle a parallel coordinate graph for filtering B-cell cross-reactivity prediction data">B-Cell Cross-Reactivity Prediction Metrics</button>
                <button class="btn btn-light btn-sm mx-1 my-0" type="button" aria-expanded="false" aria-controls="plotly_graph_t_cell_cross_reactivity" onclick="Toggle_Exclusive_Tabs( '#plotly_graph_t_cell_cross_reactivity' )"data-tooltip="tooltip" data-placement="bottom" data-html="true" title="Press to <b>toggle</b> a parallel coordinate graph for <i>filtering</i> T-cell cross-reactivity prediction data" aria-label="Press to toggle a parallel coordinate graph for filtering T-cell cross-reactivity prediction data">T-Cell Cross-Reactivity Prediction Metrics</button>
                <button class="btn btn-light btn-sm mx-1 my-0" type="button" aria-controls="#container_datatable_panel_MolecularMimicryMap" aria-expanded="false" onclick="Toggle_Exclusive_Tabs( '#container_datatable_panel_MolecularMimicryMap' )" data-tooltip="tooltip" data-placement="bottom" data-html="true" title="Press to <b>toggle</b> a panel for exploring associated data using a <i>data table</i>. Data records associated with <b>a specific human protein can be highlighted</b> by entering the <i>UniProt accession</i> of the protein" aria-label="Press to toggle a panel for exploring associated data using a data table. Data records associated with a specific human protein can be highlighted by entering the UniProt accession of the protein">Data Tables</button>
<!--                 <button class="btn btn-light btn-sm mx-1 my-0" type="button" data-toggle="collapse" data-toggle="button" data-target="#container_d3_table_metrics" aria-expanded="false" aria-controls="container_d3_table_metrics">Record Details</button> -->
                <button class="btn btn-light btn-sm mx-1 my-0" type="button" data-toggle="collapse" data-toggle="button" data-target="#container_plotly_table_sequence" aria-expanded="false" aria-controls="container_plotly_table_sequence"data-tooltip="tooltip" data-placement="bottom" data-html="true" title="Press to <b>toggle</b> <i>a table</i> showing <b>predicted/experimental structural properties</b> of aligned human and SARS-CoV-2 virus proteins" aria-label="">Aligned Sequences</button>
                <button class="btn btn-light btn-sm mx-1 my-0" type="button" data-toggle="collapse" data-toggle="button" data-target="#container_PDB" aria-expanded="false" aria-controls="container_PDB"data-tooltip="tooltip" data-placement="bottom" data-html="true" title="Press to <b>toggle</b> <i>molecule structure viewers</i> displaying aligned human and SARS-CoV-2 virus <i>protein structures</i>. Aligned residues were colored between <i>red to green</i> based on the <b>BLOSUM62 score</b> of the alignment at each position." aria-label="Press to toggle molecule structure viewers displaying aligned human and SARS-CoV-2 virus protein structures">Aligned Structures</button> 
            </form>
        </nav>
        <div class="collapse" id="navbarToggleExternalContent_supplementary_graph_setting_panel">
            <div class="bg-custom-navbar-hidden p-4">
                <h4 class="text-muted" style="display: inline-block;">Molecular Mimicry Map of SARS-CoV-2<h4>
                <h4 class="text-black"> Supplementary Graph Setting Panel</h4>
                <p>
                    <h5 class="text-muted">B Cell Cross-Reactivity Prediction Metrics</h5>
                    <div class="form-group">
                        <label for="selectmultiple_BCellCrossReactivityMetrics">Select columns <i class="material-icons" style="font-size:20px;cursor:pointer" data-toggle="tooltip" data-placement="right" title="Press ⌘ or Control Key to multi-select">help</i></label>
                        <select multiple class="form-control" id="selectmultiple_BCellCrossReactivityMetrics" size="9">
                            <option selected value="-log10( e-value )">-log10( e-value )</option>
                            <option selected value="score_blosum">score_blosum</option>
                            <option selected value="score_blosum_weighted">score_blosum_weighted</option>
                            <option value="avg_score_blosum_weighted">avg_score_blosum_weighted</option>
                            <option selected value="sum_of_weights">sum_of_weights</option>
                            <option selected value="score_similarity_ss8">score_similarity_ss8</option>
                            <option selected value="correl_coeffi_acc">correl_coeffi_acc</option>
                            <option selected value="correl_coeffi_phi">correl_coeffi_phi</option>
                            <option selected value="correl_coeffi_psi">correl_coeffi_psi</option>
                            <option value="correl_p_value_acc">correl_p_value_acc</option>
                            <option value="correl_p_value_phi">correl_p_value_phi</option>
                            <option value="correl_p_value_psi">correl_p_value_psi</option>
                            <option selected value="duplicate_counts">duplicate_counts</option>
                            <option selected value="identity">identity</option>
                            <option value="source_is_blastp">source_is_blastp</option>
                            <option value="structure_id_target_is_a_homology_modeling_result">structure_id_target_is_a_homology_modeling_result</option>
                            <option selected value="window_size">window_size</option>
                        </select>
                    </div>
                </p>
                <p><button type="button" class="btn btn-secondary btn-block mx-2 my-2" onclick="Open_and_Draw_BCellCrossReactivityPredMetricsPlot( )">Load and Draw</button></p>
                <p>
                    <h5 class="text-muted">T Cell Cross-Reactivity Prediction Metrics</h5>
                    <div class="form-group">
                        <label for="selectmultiple_TCellCrossReactivityMetrics">Select columns <i class="material-icons" style="font-size:20px;cursor:pointer" data-toggle="tooltip" data-placement="right" title="Press ⌘ or Control Key to multi-select">help</i></label>
                        <select multiple class="form-control" id="selectmultiple_TCellCrossReactivityMetrics" size="8">
                            <option selected value="mhc_class">mhc_class</option>
                            <option selected value="score_blosum">score_blosum</option>
                            <option selected value="log10( score_geometric_mean_query )">log10( score_geometric_mean_query )</option>
                            <option selected value="log10( score_geometric_mean_target )">log10( score_geometric_mean_target )</option>
                            <option selected value="window_size">window_size</option>
                            <option value="-log10( e-value )">-log10( e-value )</option>
                            <option selected value="duplicate_counts">duplicate_counts</option>
                            <option value="source_is_blastp">source_is_blastp</option>
                        </select>
                    </div>
                </p>
                <p><button type="button" class="btn btn-secondary btn-block mx-2 my-2" onclick="Open_and_Draw_TCellCrossReactivityPredMetricsPlot( )">Load and Draw</button></p>
            </div>
        </div>
        <div id="plotly_graph_b_cell_cross_reactivity" class="collapse graph_for_selection"></div>
        <div id="plotly_graph_t_cell_cross_reactivity" class="collapse graph_for_selection"></div>
        <div id="container_datatable_panel_MolecularMimicryMap" class="collapse">
            <nav class="navbar navbar-dark bg-custom-navbar">
                <a class="navbar-brand mb-0 h5">Data Tables</a>
                <div class="btn-toolbar" role="toolbar">
                    <div class="input-group mr-2 ml-1 my-0">
<!--                         <div class="input-group-prepend"><label class="input-group-text" for="input_n_records_for_datatable">Display top</label></div>
                        <input type="text" class="form-control" aria-label="the number of records in the datatable to display" id="input_n_records_for_datatable" title="input field for setting the number of records for display a datatable" value="1000">
                        <div class="input-group-append"><span class="input-group-text">records for</span></div> -->
                        <select class="custom-select w-auto" id="select_datatable" title="select datatable">
                            <option value="acc_human.tsv">select datatable</option>
                            <option value="acc_human.tsv" selected>aligned human proteins</option>
                            <option value="acc_virus_representative.tsv">representative virus proteins</option>
                            <option value="mhc_allele.tsv">MHC alleles</option>
                            <option value="interpro_virus.tsv">InterPro virus protein annotation</option>
                            <option value="iedb_epitope_virus.tsv">IEDB SARS-CoV-2 epitopes</option>
                        </select>
                        <div class="input-group-append"><span class="input-group-text">datatable</span></div>
                    </div>
                    <button type="button" class="btn btn-light mx-0 my-0" id="button_display_datatable" aria-pressed="false" onclick="Display_DataTable( )" autocomplete="off">Show</button>
                    <button class="btn btn-light ml-1 mr-2 my-0" type="button" onclick="Download_DataTable( )" data-tooltip="tooltip" data-placement="bottom" title="Press to download current datatable as a CSV file"><i class="material-icons icon-black" style="font-size:20px;cursor:pointer">get_app</i></button> 
                </div>
                <form class="form-inline">
                    <input class="form-control" type="search" placeholder="Highlight Value" aria-label="Highlight Value" id="input_highlight_value">
                    <button class="btn btn-light mx-2 my-0" type="button" onclick="Highlight_MolecularMimicryMap( )">Highlight</button>
                    <button class="btn btn-light mx-2 my-0" type="button" onclick="Clear_Highlight_MolecularMimicryMap( )">Clear Highlight</button>
                </form>
                <button type="button" class="close" aria-label="Close container_datatable_panel_MolecularMimicryMap" data-toggle="collapse" data-target="#container_datatable_panel_MolecularMimicryMap"><span aria-hidden="true">&times;</span></button>
            </nav>
            <div id="container_datatable_MolecularMimicryMap"><table id="datatable_MolecularMimicryMap" class="display" width="100%"></table></div>
        </div>
<!--         <div id="container_d3_table_metrics" class="collapse">
            <nav class="navbar navbar-dark bg-custom-navbar">
                <a class="navbar-brand mb-0 h5" id="title_d3_table_metrics">Record Details</a>
                <button type="button" class="close" aria-label="Close container_d3_table_metrics" data-toggle="collapse" data-target="#container_d3_table_metrics"><span aria-hidden="true">&times;</span></button>
            </nav>
            <div id="d3_table_metrics"></div>
            <p id="footnote_d3_table_metrics" class="text-muted"></p>
        </div> -->
        <div id="container_plotly_table_sequence" class="collapse">
            <nav class="navbar navbar-dark bg-custom-navbar" style="padding-top: 5px; padding-bottom: 5px">
                <a class="navbar-brand mb-0 h5">Aligned Sequences</a>
                <form class="form-inline">
                </form>
                <button type="button" class="close" aria-label="Close container_plotly_table_sequence" data-toggle="collapse" data-target="#container_plotly_table_sequence"><span aria-hidden="true">&times;</span></button>
            </nav>
            <div id="plotly_table_sequence" style="height:100px;"></div>
            <div id="description_clicked_position__table_sequence" style="text-align: center; border-top: 2px solid #6b0596; background-color: #f8f7fa; color: #000"></div>
        </div>
        <div id="container_PDB" class="collapse">
            <nav class="navbar navbar-dark bg-custom-navbar" style="padding-top: 5px; padding-bottom: 5px">
                <a class="navbar-brand mb-0 h5">Aligned Structures</a>
                <form class="form-inline">
                    <div class="input-group-prepend mx-2 my-0" style="height:30px"><span class="input-group-text">Virus Protein Structure</span></div>
                    <select class="form-control my-0" id="select_PDB_virus_protein_structure" style="text-align: center; height:30px; line-height: 0px; padding-top: 0px; padding-bottom: 0px;" data-tooltip="tooltip" data-placement="bottom" data-html="true" title="Select how to visualize the alignment result on the SARS-CoV-2 virus protein" onchange="Select_View_of_PDB_Virus_Protein( )">
                        <option value="Clear">Clear</option>
                        <option selected value="BLOSUM62 Score">BLOSUM62 Score</option>
                        <option value="BLOSUM62 Score with Side Chains">BLOSUM62 Score with Side Chains</option>
                    </select>
                    <div class="input-group-prepend mx-2 my-0" style="height:30px"><span class="input-group-text">Human Protein Structure</span></div>
                    <select class="form-control my-0" id="select_PDB_human_protein_structure" style="text-align: center; height:30px; line-height: 0px; padding-top: 0px; padding-bottom: 0px;" data-tooltip="tooltip" data-placement="bottom" data-html="true" title="Select how to visualize the alignment result on the human protein" onchange="Select_View_of_PDB_Human_Protein( )">
                        <option value="Clear">Clear</option>
                        <option selected value="BLOSUM62 Score">BLOSUM62 Score</option>
                        <option value="BLOSUM62 Score with Side Chains">BLOSUM62 Score with Side Chains</option>
                    </select>
                </form>
                <button type="button" class="close" aria-label="Close container_PDB" data-toggle="collapse" data-target="#container_PDB"><span aria-hidden="true">&times;</span></button>
            </nav>
            <div id="PDB_Viewer" class="deconstructed_pancake_parent">
                <div class="container_molstar deconstructed_pancake_box" id="PDB_Viewer_Virus_Protein"></div>
                <div class="container_molstar deconstructed_pancake_box" id="PDB_Viewer_Human_Protein"></div>
            </div>
        </div>
    </div>
</div>
</div> 
<!-- end of current view container -->
<div class="modal fade" id="modal_choose_fasta" tabindex="-1" role="dialog" aria-labelledby="modal_choose_fasta" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="label_modal_choose_fasta">Choose FASTA files for Peptide Vaccine Candidate Inputs</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            </div>
            <div class="modal-body">
                <p>
                    <h5 class="text-muted mb-3">Load Local Fasta Files</h5>
                    <div class="card border-secondary mx-auto mb-2" style="max-width: 35rem;">
                        <div class="card-body text-secondary">
                            <h5 class="card-title">Usage of files</h5>
                            <p class="card-text">Files will be loaded and processed locally in the internet browser and will not be uploaded to any kind of servers.</p>
                            <br>
                            <h5 class="card-title">Loading Multiple FASTA Files</h5>
                            <p class="card-text">When multiple files are be given, duplicated header lines of peptide will be appended by "_dup_{duplicate index}".</p>
                        </div>
                    </div>
                    <div class="custom-file" id="container_file_vaccine_design">
                        <input type="file" class="custom-file-input" id="file_vaccine_design_fasta" multiple>
                        <label class="custom-file-label" for="file_vaccine_design_fasta">Choose FASTA file(s)</label>
                    </div>
                </p>
                <br>
                <p>
                    <h5 class="text-muted mb-3">Load Peptide Vaccine Candidates from <i>OptiVax</i></h5>
                    <p>OptiVax citation:<br><a href="https://doi.org/10.1016/j.cels.2020.06.009">Liu, G., Carter, B., Bricken, T., Jain, S., Viard, M., Carrington, M., & Gifford, D. K. (2020). Computationally Optimized SARS-CoV-2 MHC Class I and II Vaccine Formulations Predicted to Target Human Haplotype Distributions. Cell systems, 11(2), 131–144.e6.</a></p>
                    <button type="button" class="btn btn-success ml-auto mr-0 my-1" onclick="LoadOptiVax( )">Load OptiVax</button>
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Done</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modal_select_peptides" tabindex="-1" role="dialog" aria-labelledby="modal_select_peptides" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="label_modal_select_peptides">Select Peptides for Peptide-Based Vaccine Design</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            </div>
            <div class="modal-body">
                <p>
                    <h5 class="text-muted">Automatic Selection through Thresholding</h5>
                    <div class="form-inline mb-2">
                        <div class="btn-group btn-group-toggle mx-2 my-1" data-toggle="buttons" id="radio__Vaccine_Design__Selection_Thresholding_Mode__Include_or_Exclude">
                            <label class="btn btn-labeled btn-outline-success active"><input type="radio" id="radio__Vaccine_Design__Selection_Thresholding_Mode__Include" value="Include" autocomplete="off" checked><span class="btn-label"><i class="material-icons icon-black" style="font-size:20px;cursor:pointer">done</i></span>Include</label>
                            <label class="btn btn-labeled btn-outline-danger"><input type="radio" id="radio__Vaccine_Design__Selection_Thresholding_Mode__Exclude" value="Exclude" autocomplete="off"><span class="btn-label"><i class="material-icons icon-black" style="font-size:20px;cursor:pointer">clear</i></span>Exclude</label>
                        </div>
                        <div class="btn-group btn-group-toggle mx-2 my-1" data-toggle="buttons" id="radio__Vaccine_Design__Selection_Thresholding_Mode__Above_or_Below">
                            <label class="btn btn-labeled btn-outline-info active"><input type="radio" id="radio__Vaccine_Design__Selection_Thresholding_Mode__Above" value="Above" autocomplete="off" checked><span class="btn-label"><i class="material-icons icon-black" style="font-size:20px;cursor:pointer">arrow_upward</i></span>Above</label>
                            <label class="btn btn-labeled btn-outline-info"><input type="radio" id="radio__Vaccine_Design__Selection_Thresholding_Mode__Below" value="Below" autocomplete="off"><span class="btn-label"><i class="material-icons icon-black" style="font-size:20px;cursor:pointer">arrow_downward</i></span>Below</label>
                        </div>
                        <input type="text" class="form-control" aria-label="length of peptides to generate" id="input_threshold_select_peptides" placeholder="a threshold value">
                        <button type="button" class="btn btn-secondary ml-auto mr-auto" style="margin-bottom:0px;" onclick="Retrieve_Selection_of_Peptides( )">Retrieve Selection</button>
                    </div>
                    <div id="modal_select_peptides_alert_container"></div>
                    <div class="btn-toolbar" role="toolbar">
                        <button type="button" id="button_apply_change_select_peptides" class="btn btn-success ml-auto mr-1 my-1" disabled onclick="Update_Selection_of_Peptides( 'apply' )">Apply</button>
                        <button type="button" id="button_undo_last_change_modal_select_peptides" class="btn btn-danger mr-auto ml-0 my-1" disabled onclick="Update_Selection_of_Peptides( 'undo_last_change' )">Undo Last Change</button>
                    </div>
                </p>
                <br>
                <p>
                    <h5 class="text-muted">Manual Selection Setting</h5>
                    <form class="form-inline">
                        <div class="btn-group btn-group-toggle mx-2 my-1" data-toggle="buttons" id="radio__Vaccine_Design__Select_Mode" data-tooltip="tooltip" data-placement="bottom" data-html="true" title="Press <b>Include/Exclude</b> to include/exclude vaccine candidate through clicking and selecting.">
                            <label class="btn btn-outline-info active">
                            <input type="radio" id="radio__Vaccine_Design__Select_Mode__Show_Info_Peptide" value="Show_Info" autocomplete="off" checked>Show Info.</label>
                            <label class="btn btn-outline-success">
                            <input type="radio" id="radio__Vaccine_Design__Select_Mode__Include_Peptide" value="Include" autocomplete="off">Include</label>
                            <label class="btn btn-outline-danger">
                            <input type="radio" id="radio__Vaccine_Design__Select_Mode__Exclude_Peptide" value="Exclude" autocomplete="off">Exclude</label>
                        </div>
                        <div class="input-group-append"><span class="input-group-text"> when click/select peptides with mousepointer/lasso/box.</span></div>
                    </form>
                </p>
                <div id="div_display_current_number_of_selected_peptides"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Done</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="modal_generate_peptides" tabindex="-1" role="dialog" aria-labelledby="modal_generate_peptides" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="label_modal_generate_peptides">Generate Peptides for Peptide-Based Vaccine Design</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            </div>
            <div class="modal-body">
                
                <h5 class="text-muted">Generate peptides from the consensus SARS-CoV-2 protein sequences</h5>
                <div class="form-inline mb-2">
                    <div class="input-group-prepend"><span class="input-group-text">Peptides are</span></div>
                    <input type="text" class="form-control" aria-label="length of peptides to generate" id="input_window_size_generate_peptides" value="25">
                    <div class="input-group-append"><span class="input-group-text">amino acids in length.</span></div>
                    <button type="button" class="btn btn-secondary ml-1" style="margin-bottom:0px;" onclick="Retrieve_Peptides( )">Generate</button>
                </div>
                <div id="modal_generate_peptides_alert_container"></div>
                <div id="div_display_current_number_of_peptides">Total number of peptides: </div>
                <div class="btn-toolbar" role="toolbar">
                    <button type="button" class="btn btn-success ml-auto mr-1 my-1" onclick="Update_Peptides( 'append' )">Append</button>
                    <button type="button" class="btn btn-danger mr-auto ml-0 my-1" onclick="Update_Peptides( 'replace' )">Replace</button>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Done</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="modal_keyboard_shortcuts" tabindex="-1" role="dialog" aria-labelledby="modal_keyboard_shortcuts" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="label_modal_generate_peptides">Keyboard Shortcuts</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            </div>
            <div class="modal-body">
                <h5 class="text-muted mb-2" style="font-size:20px">General</h5>
                <p>Press <kbd>Ctrl</kbd> or <kbd>Cmd</kbd> + <kbd>s</kbd><b>(screenshot)</b> to capture <b>the current view</b> and download it as a PNG file</p>
                <p>Press <kbd>Ctrl</kbd> or <kbd>Cmd</kbd> + <kbd>i</kbd><b>(introduction)</b> to toggle the introduction and instructions</p>
                <p>Press <kbd>Ctrl</kbd> or <kbd>Cmd</kbd> + <kbd>a</kbd><b>(information on hover)</b> to toggle the click/hover events of the main graph.</p>
                <p>Press <kbd>Ctrl</kbd> or <kbd>Cmd</kbd> + <kbd>h</kbd><b>(help messages)</b> to toggle tooltip messages that are shown when mouse pointers are on buttons.</p>
                <p>Press <kbd>Ctrl</kbd> or <kbd>Cmd</kbd> + <kbd>u</kbd><b>(UP)</b> to move to the top of the page.</p>
                <br>
                <h5 class="text-muted mb-2" style="font-size:20px">Peptide Vaccine Design</h5>
                <p>Press <kbd>a</kbd><b>(add)</b> when clicking/selecting peptides to include peptides in the selection.</p>
                <p>Press <kbd>r</kbd><b>(remove)</b> when clicking/selecting peptides to exclude peptides from the selection.</p>
                <p>Press <kbd>Ctrl</kbd> or <kbd>Cmd</kbd> + <kbd>r</kbd><b>(reset)</b> to reset selection of peptides.</p>
                <br>
                <h5 class="text-muted mb-2" style="font-size:20px">Panel Control</h5>
                <p>Press <kbd>Ctrl</kbd> or <kbd>Cmd</kbd> + <kbd>b</kbd><b>(B-cell Cross Reactivity Pred.)</b> to show/hide the parallel coordinates plot showing B-cell cross reactivity prediction metrics</p>
                <p>Press <kbd>Ctrl</kbd> or <kbd>Cmd</kbd> + <kbd>g</kbd><b>(T-cell Cross Reactivity Pred.)</b> to show/hide the parallel coordinates plot showing T-cell cross reactivity prediction metrics</p>
                <p>Press <kbd>Ctrl</kbd> or <kbd>Cmd</kbd> + <kbd>d</kbd><b>(DataTable)</b> to show/hide the DataTable panel</p>
                <br>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Okay</button>
            </div>
        </div>
    </div>
</div>
<!-- fullscreen introduction modal -->
<div id="modal_introduction" class="modal fade show" tabindex="-1" role="dialog" aria-labelledby="modal_introduction" aria-hidden="true" style="padding-right: 0px!important;"> <!-- disable fading when the web page has been loaded -->
  <div class="modal-dialog" style="width: 100%!important;height: 100%!important;margin: 0!important;padding: 0!important;max-width:none !important;">
    <div class="modal-content" style="height: auto !important; min-height: 100% !important; border-radius: 0 !important;min-width: 100% !important;">
        <nav class="navbar navbar-expand-lg navbar-dark bg-custom-navbar"> <!-- sticky-top -->
            <a class="navbar-brand mb-0 h1">Molecular Mimicry Map of SARS-CoV-2</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav_top" aria-controls="navbarNav_top" aria-expanded="false" aria-label="Toggle top navigation"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navbarNav_top">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link">Citation</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link">Feedback</a>
                    </li>
                </ul>
            </div>
        </nav>
            <div class="modal-header">
                <h1 class="modal-title">Introduction</h1>
                <button class="btn btn-link btn-lg mt-2 mr-auto" onclick="Toggle_Introduction_Modal();">Skip Introduction</button>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            </div>
            <div class="modal-body">
                <h2></h2>
                <img src="https://ahs2202.github.io/3M/images/3M_of_SARS-CoV-2.cover.PNG" alt="introduction images" style="min-width:90%;max-width:90%;display: block;margin-left: auto;margin-right: auto;">
                <br>
                <div class="card mx-auto my-2" style="max-width: 60rem;">
                    <div class="card-body">
                        <h2 class="card-title">Abstract</h2>
                        <p class="card-text">Currently, more than 33 million peoples have been infected by SARS-CoV-2 virus, and more than a million people died from coronavirus disease 2019 (COVID-19), a disease cause by the virus. There have been multiple reports of autoimmune and inflammatory diseases following SARS-CoV-2 infections, including Kawasaki-like multisystem inflammatory syndrome in children (MIS-C) and Guillain–Barré syndrome (GBS). There are several suggested mechanisms involved in the development of autoimmune diseases, including bystander activation, cross-reactivity (molecular mimicry), T-cell receptor degeneracy, and epitope spreading. A typical workflow for discovering of cross-reactive epitopes (mimotopes) starts with sequence similarity search between protein sequences of human and a pathogen using BLAST from NCBI. However, even with a low overall sequence similarity, proteins can share highly similar surface epitopes, which often situated far apart in the linear protein sequences. Therefore, we used a hidden Markov model-based tool to identify distant viral homologs of human proteins. Also, we utilized experimentally determined and modeled proteins structures of SARS-CoV-2 virus and human proteins to find homologous protein structures between SARS-CoV-2 virus and human. Next, we predicted binding affinity (IC50) of potentially cross-reactive T-cell epitopes to 34 MHC allelic variants that has been associated with autoimmune diseases using multiple prediction algorithms. Overall, after reducing redundancy, we identified 31,979 potentially cross-reactive B-cell epitopes using a window size of 30 amino acids and 30,205 potentially cross-reactive T-cell epitopes from 8,138 SARS-CoV-2 genomes. In order to visualize the potential cross-reactive T-cell and B-cell epitopes, we developed a web-based application “Molecular Mimicry Map of SARS-CoV-2” (available at https://ahs2202.github.io/3M/). The web application enables researchers to explore potential cross-reactive SARS-CoV-2 epitopes alongside with custom peptide vaccines, allowing researchers to identify potentially suboptimal peptide vaccine candidates or less ideal part of a whole virus vaccine to design a safer vaccine for people with genetic and environmental predispositions to autoimmune diseases.</p>
                    </div>
                </div>
<!--                 <h5 class="text-muted">This program has been developed by Hyunsu An at Gwangju Institute of Science and Technology under the supervision of Professor JiHwan Park.</h5> -->
<!--                 <div class="card border-primary mx-auto my-2" style="max-width: 50rem;">
                    <div class="card-header">Instruction</div>
                    <div class="card-body text-primary">
                        <h5 class="card-title">basic usage</h5>
                        <p class="card-text">Click points to see details.</p>
                    </div>
                </div> -->
                <h1 class="modal-title">Usages</h1>
                <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
                    <ol class="carousel-indicators">
                        <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                        <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
                        <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
                    </ol>
                    <div class="carousel-inner">
                        <div class="carousel-item active">
                            <img src="https://ahs2202.github.io/3M/images/3M_of_SARS-CoV-2.usage_main_graph.PNG" class="d-block w-100" alt="Explore cross-reactive immune epitopes">
                            <div class="carousel-caption d-none d-md-block">
                                <h2>Explore cross-reactive immune epitopes</h2>
                                <p>Toggle <b>help messages</b> by pressing <kbd>Cmd</kbd> + <kbd>H</kbd><br>Keyboard shorcuts can be found at the upper right corner</p>
                            </div>
                        </div>
                        <div class="carousel-item">
                            <img src="https://ahs2202.github.io/3M/images/3M_of_SARS-CoV-2.usage_filter.PNG" class="d-block w-100" alt="Filter cross-reactive immune epitopes">
                            <div class="carousel-caption d-none d-md-block">
                                <h2>Filter cross-reactive immune epitopes</h2>
                                <p>Multiple filters can be applied.<br>To remove a filter, click the filter again</p>
                            </div>
                        </div>
                        <div class="carousel-item">
                            <img src="https://ahs2202.github.io/3M/images/3M_of_SARS-CoV-2.usage_aligned_structures.PNG" class="d-block w-100" alt="Visualize Aligned Structures">
                            <div class="carousel-caption d-none d-md-block">
                                <h2>Visualize Aligned Structures</h2>
                                <p>Click a row in the [Aligned Sequence] table to highlight a pair of residues in the alignment on both virus and human protein structures<br>Change the representation of protein structure <i>(Control Panel > Components > Polymer > Actions > Add Representation > Molecular Surface)</i><br>When protein structure is not available, a black screen will be shown</p>
                            </div>
                        </div>
                    </div>
                    <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                    </a>
                </div>
                <h4 class="text-muted">This program has been developed by Hyunsu An at Gwangju Institute of Science and Technology under the supervision of Professor JiHwan Park.</h4>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary btn-lg btn-block" data-dismiss="modal">Start!</button>
            </div>
        </div>
    </div>
</div>
<div id="loading_screen"></div>
<script>
    // define shortcuts 
    object_data_keydown = { dict_status: { } };
    function Record_KeyDown( event ) { // Record pressed keyborad keys, and trigger appropriate function when key is pressed.
        object_data_keydown.dict_status[ event.key ] = event.type; // record event.type for each key
    }
    window.addEventListener( "keyup", Record_KeyDown );
    window.addEventListener( "keypress", Record_KeyDown );
    window.addEventListener( "keydown", Record_KeyDown );
    
    hotkeys( 'ctrl+a,ctrl+s,ctrl+r,ctrl+b,ctrl+g,ctrl+d,ctrl+h,ctrl+i,ctrl+u,command+a,command+s,command+r,command+b,command+g,command+d,command+h,command+i,command+u', function ( event, handler ) {
        event.preventDefault( );
        switch ( handler.key ) {
            case 'ctrl+s': 
            case 'command+s': 
                DownloadCurrentView( ); 
                break;
            case 'ctrl+r': 
            case 'command+r': 
                // reset selection of peptides
                object_data_vaccine_design.selection.l_selected_current = ArrayFull( object_data_vaccine_design.dict_data[ "selected" ].length, true );
                object_data_vaccine_design.selection.l_selected_previous = object_data_vaccine_design.dict_data[ "selected" ];
                document.getElementById( "button_apply_change_select_peptides" ).disabled = true;
                document.getElementById( "button_undo_last_change_modal_select_peptides" ).disabled = false;
                object_data_vaccine_design.dict_data[ "selected" ] = object_data_vaccine_design.selection.l_selected_current;
                Draw_DesignedVaccineTrace( "update_selection" ); // update selection
                break;
            case 'ctrl+a': 
            case 'command+a': 
                $( "#button_toggle_hovermode_MolecularMimicryMap" ).click( );
                break;
            case 'ctrl+b': 
            case 'command+b': 
                Toggle_Exclusive_Tabs( '#plotly_graph_b_cell_cross_reactivity' );
                break;
            case 'ctrl+g': 
            case 'command+g': 
                Toggle_Exclusive_Tabs( '#plotly_graph_t_cell_cross_reactivity' );
                break;
            case 'ctrl+d': 
            case 'command+d': 
                Toggle_Exclusive_Tabs( '#container_datatable_panel_MolecularMimicryMap' );
                break;
            case 'ctrl+h': 
            case 'command+h': 
                Toggle_Tooltips( ); 
                break;
            case 'ctrl+i': 
            case 'command+i': 
                Toggle_Introduction_Modal( ); 
                break;
            case 'ctrl+u': 
            case 'command+u': 
                Scroll_to_the_Top( ); 
                break;
            default: alert(event);
        }
    }); 
    function Toggle_Introduction_Modal( ) { 
        $( '#modal_introduction' ).modal( 'toggle' );
        document.getElementById( "modal_introduction" ).style[ "padding-right" ] = "0px";
    } // Toggle Modal for an Introduction 
    
    var l_remote_file = [ "https://raw.githubusercontent.com/ahs2202/3M/master/current/TCellCrossReactivity.nonredundant_aligned_position.top_5000.tsv", 
                          "https://raw.githubusercontent.com/ahs2202/3M/master/current/structural_property_virus__compact__for_web_application.tsv", 
                          "https://raw.githubusercontent.com/ahs2202/3M/master/current/structural_property_human__compact__for_web_application.tsv",  
                          "https://raw.githubusercontent.com/ahs2202/3M/master/current/mhc_allele.tsv", 
                          "https://raw.githubusercontent.com/ahs2202/3M/master/current/interpro_virus.tsv", 
                          "https://raw.githubusercontent.com/ahs2202/3M/master/current/iedb_epitope_virus.tsv", 
                          "https://raw.githubusercontent.com/ahs2202/3M/master/current/blosum62.tsv", 
                          "https://raw.githubusercontent.com/ahs2202/3M/master/current/BCellCrossReactivity.nonredundant_position.windowSize_30.top_5000.tsv", 
                          "https://raw.githubusercontent.com/ahs2202/3M/master/current/alignment_virus_pdb__compact__for_web_application.tsv", 
                          "https://raw.githubusercontent.com/ahs2202/3M/master/current/alignment_human_virus__compact__for_web_application.tsv", 
                          "https://raw.githubusercontent.com/ahs2202/3M/master/current/alignment_human_pdb__compact__for_web_application.tsv", 
                          "https://raw.githubusercontent.com/ahs2202/3M/master/current/algorithms.tsv", 
                          "https://raw.githubusercontent.com/ahs2202/3M/master/current/acc_virus_representative.tsv", 
                          "https://raw.githubusercontent.com/ahs2202/3M/master/current/acc_virus.tsv", 
                          "https://raw.githubusercontent.com/ahs2202/3M/master/current/acc_pdb.tsv", 
                          "https://raw.githubusercontent.com/ahs2202/3M/master/current/acc_human.tsv" ];
    var object_data_remote_file = { }; // define values for downloading files in remote locations
    object_data_remote_file.base_url = "https://raw.githubusercontent.com/ahs2202/3M/master/current/";
    object_data_remote_file.l_n_records_for_each_step = [ 1000, 2000, 5000, 10000, 20000, 40000, 80000, 160000 ];
    object_data_remote_file.dict_bcell_crossreactivity_data_to_n_records = {'nonredundant_position': {'100': 2106, '11': 19871, '125': 1170, '14': 19531, '150': 568, '17': 18843, '20': 17697, '25': 15612, '30': 13858, '35': 12405, '45': 9906, '5': 19136, '55': 7656, '70': 5069, '8': 19931, '85': 3372},
                                                                            'nonredundant_sequence': {'100': 9864, '11': 28607, '125': 6402, '14': 30387, '150': 3241, '17': 31615, '20': 31979, '25': 31344, '30': 30205, '35': 29313, '45': 27691, '5': 22636, '55': 24883, '70': 20278, '8': 26133, '85': 15168}};
    object_data_remote_file.dict_tcell_crossreactivity_data_to_n_records = {'all': 41014, 'nonredundant_aligned_position': 23868, 'nonredundant_aligned_sequence': 38824};
    $(document).ready( function( ) {
        $('[data-toggle="tooltip"]').tooltip( ); // enable tooltips
        $('[data-tooltip="tooltip"]').tooltip( );
        $('[data-tooltip-always-active="tooltip"]').tooltip( );
        document.getElementById( 'button_toggle_hovermode_MolecularMimicryMap' ).click( ); // set initial status
        $( '#modal_introduction' ).modal( 'show' ); // show introduction modal
        Toggle_Tooltips( ); // set tooltips status
        object_plot_MolecularMimicryMap.hovermode = "closest"; // set initial status
        LoadRemoteData( l_remote_file ); // load remote data // uncomment to disable remote file loading
    });
    
    var div_current_view = $("#molecularmimicrymap-current-view"); // global variable
    function DownloadCurrentView( ) {
         html2canvas( div_current_view.get( 0 ) ).then ( function (canvas) {
                var imgageData = canvas.toDataURL("image/png");
                // Now browser starts downloading it instead of just showing it
                var newData = imgageData.replace(/^data:image\/png/, "data:application/octet-stream");
                $("#anchor-current-view").attr("download", "MolecularMimicryMap of SARS-CoV-2.screenshot.png").attr("href", newData);
                $("#anchor-current-view").get( 0 ).click( ) // download image file
         });
    }
    
    // use dataframe-js
    var DataFrame = dfjs.DataFrame;
    // use interval-tree-1d
    var createIntervalTree = require( "interval-tree-1d" )
    // code for approximate string matching (for peptide sequence mapping) from https://gist.github.com/andrei-m/982927
    function Levenstein(a, b) { 
        var m = [], i, j, min = Math.min;
        if (!(a && b)) return (b || a).length;
        for (i = 0; i <= b.length; m[i] = [i++]);
        for (j = 0; j <= a.length; m[0][j] = j++);
        for (i = 1; i <= b.length; i++) {
            for (j = 1; j <= a.length; j++) {
                m[i][j] = b.charAt(i - 1) == a.charAt(j - 1)
                    ? m[i - 1][j - 1]
                    : m[i][j] = min(
                        m[i - 1][j - 1] + 1, 
                        min(m[i][j - 1] + 1, m[i - 1 ][j] + 1))
            }
        }
        return m[b.length][a.length];
    }
    function FuzzyContains(a, b, error) {
        var matchLength = a.length - b.length;
        var distanceToMatch = Levenstein(a, b) - matchLength;
        if(distanceToMatch - error > 0) {
          return false;
        } else {
          return true;
        }
    }
    // code for pseudorandom number generator (PRNG) with random seed from https://stackoverflow.com/questions/521295/seeding-the-random-number-generator-in-javascript
    function xmur3(str) { // random seed generator
        for(var i = 0, h = 1779033703 ^ str.length; i < str.length; i++)
            h = Math.imul(h ^ str.charCodeAt(i), 3432918353),
            h = h << 13 | h >>> 19;
        return function() {
            h = Math.imul(h ^ h >>> 16, 2246822507);
            h = Math.imul(h ^ h >>> 13, 3266489909);
            return (h ^= h >>> 16) >>> 0;
        }
    }
    function mulberry32(a) { // a simple (PRNG) generator with a 32-bit state
        return function() {
          var t = a += 0x6D2B79F5;
          t = Math.imul(t ^ t >>> 15, t | 1);
          t ^= t + Math.imul(t ^ t >>> 7, t | 61);
          return ((t ^ t >>> 14) >>> 0) / 4294967296;
        }
    }
    // function for sorting
    function SortFloat( a, b ) { return a - b; }
    function CheckInt(n) { // return true if 'n' is true
       return n % 1 === 0;
    }
    function CountOccurrence( entry, query ) { // count occurrence of specific string in a string
        return ( entry.match( new RegExp( query, 'g' ) ) || []).length;
    }
    function ArraySum( l ) { // return the sum of values of an array
        return l.reduce( (a, b) => a + b, 0 );
    }
    function ArrayStandardDeviation( array ) {
        let n = array.length
        let mean = array.reduce((a, b) => a + b) / n
        return Math.sqrt(array.map(x => Math.pow(x - mean, 2)).reduce((a, b) => a + b) / n)
    } // from https://stackoverflow.com/questions/7343890/standard-deviation-javascript
    // funrcions for UI
    function Loading_Screen( bool_add_loading_screen ) { // add or remove loading screen
        if ( ( ! bool_add_loading_screen ) && document.getElementById( "svg_during_loading" ) != null ) {
            document.getElementById( "svg_during_loading" ).remove( ); // remove loading screen once plot is drawn
        } else if ( bool_add_loading_screen && document.getElementById( "svg_during_loading" ) == null ) {
            $("#loading_screen").append( [
                '<div class="loader loader--style1 _plotly-loading-callback" title="data is being loaded..." id="svg_during_loading">',
                    '<svg version="1.1" id="loader-1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="40px" height="40px" viewBox="0 0 40 40" enable-background="new 0 0 40 40" xml:space="preserve" rect="fill: #FF6700;" path>',
                        '<path opacity="0.2" fill="#000" d="M20.201,5.169c-8.254,0-14.946,6.692-14.946,14.946c0,8.255,6.692,14.946,14.946,14.946',
                        's14.946-6.691,14.946-14.946C35.146,11.861,28.455,5.169,20.201,5.169z M20.201,31.749c-6.425,0-11.634-5.208-11.634-11.634',
                        'c0-6.425,5.209-11.634,11.634-11.634c6.425,0,11.633,5.209,11.633,11.634C31.834,26.541,26.626,31.749,20.201,31.749z"/>',
                        '<path fill="#000" d="M26.013,10.047l1.654-2.866c-2.198-1.272-4.743-2.012-7.466-2.012h0v3.312h0',
                        'C22.32,8.481,24.301,9.057,26.013,10.047z">',
                        '<animateTransform attributeType="xml"',
                          'attributeName="transform"',
                          'type="rotate"',
                          'from="0 20 20"',
                          'to="360 20 20"',
                          'dur="0.5s"',
                          'repeatCount="indefinite"/>',
                        '</path>',
                    '</svg>',
                '</div>' ].join( "" ) ); // display an SVG file during loading 
        }
    }
    function Dismissible_Alert( container, class_alert, message ) { // display a dismissible alert message of a given class_alert (eg. 'primary') at a given container with a given message 
        $( container ).append( [
            '<div class="alert alert-' + class_alert + ' alert-dismissible fade show" role="alert">',
              message,
              '<button type="button" class="close" data-dismiss="alert" aria-label="Close">',
                 '<span aria-hidden="true">&times;</span>',
              '</button>',
            '</div>' ].join( "" ) ); 
    }
    
    // functions for numpy-like operations
    function ArrayIndexing( l, l_index ) {
        let l_output = [ ];
        for ( let i = 0; i < l_index.length; i++ ) { l_output.push( l[ l_index[ i ] ] ); }
        return l_output
    }
    function ArrayBooleanIndexing( l, l_bool ) {
        let l_output = [ ];
        for ( let i = 0; i < l_bool.length; i++ ) { if ( l_bool[ i ] ) { l_output.push( l[ i ] ); } }
        return l_output
    }
    function ArrayBoolAND( l_l ) {
        let l_output = [ ];
        for ( let j = 0; j < l_l[ 0 ].length; j++ ) {
            let output = true;
            for ( let i = 0; i < l_l.length; i++ ) { output = output && l_l[ i ][ j ]; }
            l_output.push( output );
        }
        return l_output;
    }
    function ArrayBoolOR( l_l ) {
        let l_output = [ ];
        for ( let j = 0; j < l_l[ 0 ].length; j++ ) {
            let output = false;
            for ( let i = 0; i < l_l.length; i++ ) { output = output || l_l[ i ][ j ]; }
            l_output.push( output );
        }
        return l_output;
    }
    function ArrayBoolNOT( l ) {
        let l_output = [ ];
        for ( let i = 0; i < l.length; i++ ) { l_output.push( l[ i ] ? false : true ); }
        return l_output;
    }
    function ArrayGreaterThan( l, thres ) {
        let l_output = [ ];
        for ( let i = 0; i < l.length; i++ ) { l_output.push( l[ i ] > thres ); }
        return l_output;
    }
    function ArrayLessThan( l, thres ) {
        let l_output = [ ];
        for ( let i = 0; i < l.length; i++ ) { l_output.push( l[ i ] < thres ); }
        return l_output;
    }
    function ArrayFull( length, value ) {
        let l_output = [ ];
        for ( let i = 0; i < length; i++ ) { l_output.push( value ); }
        return l_output;
    }
    function ArrayBroadCasting( l, l_bool, value ) {
        let l_output = [ ];
        for ( let i = 0; i < l.length; i++ ) { l_output.push( l_bool[ i ] ? value : l[ i ] ); }
        return l_output;
    }
    function ArrayCap( l, value ) { // cap value of a given list at the given capping value (manually set maximum value)
        l_modified = lodash.cloneDeep( l );
        for ( let i = 0; i < l.length; i ++ ) {
            if ( l[ i ] > value ) { // cap value of a given list at the given capping value (manually set maximum value)
                l_modified[ i ] = value;
            }
        }
        return l_modified
    }
    function ArrayFloor( l, value ) { // floor value of a given list at the given flooring value (manually set minimum value)
        l_modified = lodash.cloneDeep( l );
        for ( let i = 0; i < l.length; i ++ ) {
            if ( l[ i ] < value ) { // cap value of a given list at the given capping value (manually set maximum value)
                l_modified[ i ] = value;
            }
        }
        return l_modified
    }
    function ArrayApply( l, a_function ) { // apply certain function to all of values of a given array
        let l_output = [ ];
        for ( let i = 0; i < l.length; i ++ ) {
            l_output[ i ] = a_function( l[ i ] );
        }
        return l_output
    }
    function ArrayMap( l, dictionary ) { // map values in a given array using a given dictionary
        let l_output = [ ];
        for ( let i = 0; i < l.length; i ++ ) {
            l_output[ i ] = dictionary[ l[ i ] ];
        }
        return l_output
    }
    function ArrayTranspose( l_l ) { // transpose 2d array
        let n_row = l_l.length, n_col = l_l[ 0 ].length, l_l_t = [ ]; // transposed 2d array
        for ( let i = 0; i < n_col; i ++ ) {
            let l_t = [ ]; // transposed column (now a row)
            for ( let j = 0; j < n_row; j ++ ) { l_t.push( l_l[ j ][ i ] ); }
            l_l_t.push( l_t );
        }
        return l_l_t;
    }
    
    function unpack(rows, key) { 
        if ( Array.isArray( key ) ) { // if more than one key is given, return 2D-array of unpacked data
            let l_l_value = [ ];
            for ( let i = 0; i < rows.length; i ++ ) {
                let row = rows[ i ];
                let l_value = [ ];
                for ( let j = 0; j < key.length; j ++ ) { 
                    l_value.push( row[ key[ j ] ] );
                }
                l_l_value.push( l_value );
            }
            return l_l_value;
        } else { return rows.map( function( row ) { return row[ key ]; } ); } // if only a single key is given, return 1D-array of unpacked data
    };
    function Unpack_array_to_dict_data( arr, l_key ) { // unpack array returned by papaparse into dictionary containing unpacked arrays
        let dict_data = { };
        for ( let i = 0; i < l_key.length; i ++ ) {
            let key = l_key[ i ];
            dict_data[ key ] = unpack( arr, key );
        }
        return dict_data;
    }
    function Unpack_String_Numbers( data ) { // unpack a string containing a list of numbers
        let l = data.split( ',' ), l_data = [ ], bool_flag_float_datatype = data.includes( '.' ); // retrieve flag indicating the float datatype
        for ( let i = 0; i < l.length; i ++ ) {
            let value = l[ i ].length == 0? "0" : l[ i ];
            l_data.push( bool_flag_float_datatype? parseFloat( value ) : parseInt( value ) ); // parse float or integer datatype
        }
        return l_data;
    };
    function ColorMap_Rainbow( n_colors ) { // colormap witn the given number of colors
        let l_colormap = [ ]; 
        for ( let i = 0; i < n_colors; i ++ ) { 
            let f = i / n_colors; // convert to [0,1]

            let a = ( 1 - f ) * 5.0; // from a code found at "https://www.particleincell.com/2014/colormap/"
            let X = Math.floor( a );
            let Y = Math.floor( 255 * ( a - X ) );
            let r = 0, g = 0, b = 0;
            switch( X )
            {
                case 0: r = 255; g = Y; b = 0; break;
                case 1: r = 255 - Y; g = 255; b = 0; break;
                case 2: r = 0; g = 255; b = Y; break;
                case 3: r = 0; g = 255 - Y; b = 255; break;
                case 4: r = Y; g = 0; b = 255; break;
                case 5: r = 255; g = 0; b = 255; break;
            }
            l_colormap.push( {r:r,g:g,b:b} )
        }
        return l_colormap; // return a colormap
    }
    function ColorMap_Rainbow_Map( l_scalar ) { // map integer values in 'l_scaler' to rainbow rgb colormap 
        let min_value = Math.min.apply( null, l_scalar );
        let max_value = Math.max.apply( null, l_scalar );
        console.log( min_value, max_value )
        let l_colormap = [ ], l_mapped_color = [ ], n_colors = ( max_value - min_value + 1 ); // min and max values should be intergers
        for ( let i = 0; i < n_colors; i ++ ) { 
            let f = i / n_colors; // convert to [0,1]

            let a = ( 1 - f ) * 5.0; // from a code found at "https://www.particleincell.com/2014/colormap/"
            let X = Math.floor( a );
            let Y = Math.floor( 255 * ( a - X ) );
            let r = 0, g = 0, b = 0;
            switch( X )
            {
                case 0: r = 255; g = Y; b = 0; break;
                case 1: r = 255 - Y; g = 255; b = 0; break;
                case 2: r = 0; g = 255; b = Y; break;
                case 3: r = 0; g = 255 - Y; b = 255; break;
                case 4: r = Y; g = 0; b = 255; break;
                case 5: r = 255; g = 0; b = 255; break;
            }
            l_colormap.push( {r:r,g:g,b:b} )
        }
        for ( let i = 0; i < l_scalar.length; i ++ ) { l_mapped_color.push( l_colormap[ l_scalar[ i ] - min_value ] ); }
        return l_mapped_color; // return mapped colors
    }
    
    function RetrieveDiscardedLength( str_discarded_regions, alignment_start ) { // retrieve length of discarded sequence from 'str_discarded_regions' for the given alignment start position
        let len_discarded_sequence = 0, l_discarded_regions = str_discarded_regions.split( ";" ).map( function( str ) { return str.split( ":" ).map( function( str ) { return parseInt( str ); } ) } );
        for ( let i = 0; i < l_discarded_regions.length; i ++ ) {
            if ( alignment_start < l_discarded_regions[ i ][ 0 ] ) { break; } // if the region is before the start of a discarded region, stop subtracting the length of discarded regions
            len_discarded_sequence += l_discarded_regions[ i ][ 1 ] // increase the length of discarded regions by the length of the current discarded region
        }
        return len_discarded_sequence;
    }
    
    function Unpack_String_rsa( seq ) { // unpack string containing RSA value using ASCII encoding (126 encodes null)
        let l_output = [ ];
        for ( let i = 0; i < seq.length; i ++ ) {
            let int_value = seq.charCodeAt( i ); // retrieve ASCII character as an integer number
            if ( int_value == 126 ) { l_output.push( null ); }
            else { l_output.push( Math.round( ( int_value - 33 ) / 92 * 100 ) / 100 ); } // RSA value range 0 ~ 1 // round up so that step is 1
        }
        return l_output;
    }
    function Unpack_String_rsa_encoded_by_two_char( seq ) { // unpack string containing RSA value using ASCII encoding with two characters (two 126 encodes null)
        let l_output = [ ];
        for ( let i = 0; i < parseInt( seq.length / 2 ); i ++ ) {
            let int_value_first_char = seq.charCodeAt( 2 * i ), int_value_second_char = seq.charCodeAt( 2 * i + 1 ); // retrieve ASCII character as an integer number
            if ( int_value_first_char == 126 && int_value_second_char == 126 ) { l_output.push( null ); }
            else { l_output.push( Math.round( ( int_value_first_char - 33 ) * ( int_value_second_char - 33 ) / 8648 * 1000 ) / 1000 ); } // RSA value range 0 ~ 1 // round up so that step is 1
        }
        return l_output;
    }
    function Unpack_String_torsion_angle( seq ) {
        let l_output = [ ];
        for ( let i = 0; i < seq.length; i ++ ) {
            let int_value = seq.charCodeAt( i ); // retrieve ASCII character as an integer number
            if ( int_value == 126 ) { l_output.push( null ); }
            else { l_output.push( Math.round( ( int_value - 33 ) / 92 * 360 ) - 180 ); } // torsion angle value range -180 ~ 180 // round up so that step is 1
        }
        return l_output;
    }
    function Unpack_String_ss8( seq ) {
        let l_ss8 = [ 'G', 'H', 'I', 'E', 'B', 'T', 'S', 'C' ];
        let l_output = [ ];
        for ( let i = 0; i < seq.length; i ++ ) {
            let int_value = seq.charCodeAt( i ); // retrieve ASCII character as an integer number
            if ( int_value >= 41 ) { l_output.push( null ); }
            else { l_output.push( l_ss8[ int_value - 33 ] ); } // retrieve encoded ss8 classification
        }
        return l_output;
    }
    function Unpack_String_datatype( seq ) {
        let l_datatype = [ 'predicted', 'modeling', 'PDB' ]; // [ 'prediction', 'homology modeling', 'experimental structure' ];
        let l_output = [ ];
        for ( let i = 0; i < seq.length; i ++ ) {
            let int_value = seq.charCodeAt( i ); // retrieve ASCII character as an integer number
            if ( int_value >= 36 ) { l_output.push( null ); }
            else { l_output.push( l_datatype[ int_value - 33 ] ); } // retrieve encoded datatype classification
        }
        return l_output;
    }
    function Unpack_String_structure_id( seq ) {
        let l_value = seq.split( ';' ), entry_previous = null, l_output = [ ], chr_representing_repeated_string = '=';
        for ( let i = 0; i < l_value.length; i ++ ) {
            let entry = l_value[ i ];
            if ( entry.length == 0 )  { l_output.push( null ); }
            else if ( entry == chr_representing_repeated_string ) { l_output.push( entry_previous ); }
            else { l_output.push( entry ); entry_previous = entry; }
        }
        return l_output;
    }
    
    function Align_Structural_Property( object_structure_property, seq ) { // align structural property and colors 
        let l_name_data = Object.keys( object_structure_property ), object_structure_property_aligned = { };
        for ( let i = 0; i < l_name_data.length; i ++ ) { // for each member (structural property data) in 'object_structure_property'
            let l_aligned_data = [ ], l_data = object_structure_property[ l_name_data[ i ] ], int_pos_data = 0; // initial position is 0
            for ( let j = 0; j < seq.length; j ++ ) {
                let residue = seq[ j ]; // for each residue in the alignment
                if ( residue == '-' ) { // add value representing a gap when encounter a gap (for color, the value representing the gap is the color 'black')
                    let value_representing_gap = l_name_data[ i ].includes( "color_" )? "#000000" : '-';
                    l_aligned_data.push( value_representing_gap );
                } else {
                    l_aligned_data.push( l_data[ int_pos_data ] ); // add data value when encounter a non-gap residue
                    int_pos_data += 1;
                }
            }
            object_structure_property_aligned[ l_name_data[ i ] ] = l_aligned_data; // add aligned data
        }
        return object_structure_property_aligned;
    }
    
    var color_representing_null = "#c3c3c3"; // color representing null value is grey color
    function Color_for_rsa( l_rsa ) {
        let l_color = [ ], function_colormap = function_colormap_rsa;
        for ( let i = 0; i < l_rsa.length; i ++ ) { l_color.push( l_rsa[ i ] == null? color_representing_null : function_colormap( l_rsa[ i ] * 2 ).toString( ) ); } // RSA of 0.5 will be represented as 'fully accessible to the surface'
        return l_color;
    }
    function Color_for_score_blosum( l_score_blosum ) {
        let l_color = [ ], function_colormap = function_colormap_score_blosum;
        for ( let i = 0; i < l_score_blosum.length; i ++ ) { l_color.push( l_score_blosum[ i ] == null? color_representing_null : function_colormap( ( l_score_blosum[ i ] + 3 ) / 6 ).toString( ) ); } // display blosum62 score from -5 to 5
        return l_color;
    }
    function Color_for_torsion_angle( l_torsion_angle ) {
        let l_color = [ ], function_colormap = function_colormap_torsion_angle;
        for ( let i = 0; i < l_torsion_angle.length; i ++ ) { l_color.push( l_torsion_angle[ i ] == null? color_representing_null : function_colormap( ( l_torsion_angle[ i ] + 180 ) / 360 ).toString( ) ); }
        return l_color;
    }
    function Color_for_ss8( l_ss8 ) {
        let l_color = [ ], dict_colormap = { G: "#b2d0ed", H: "#b2d0ed", I: "#b2d0ed", E: "#f7b4a3", B: "#f7b4a3", T: "#cbf7c8", S: "#cbf7c8", C: "#edebe4" };
        for ( let i = 0; i < l_ss8.length; i ++ ) { l_color.push( l_ss8[ i ] == null? color_representing_null : dict_colormap[ l_ss8[ i ] ] ); }
        return l_color;
    }
    function Color_for_datatype( l_datatype ) {
        let l_color = [ ], dict_colormap = { predicted: "#fffafe", modeling: "ffc38a", PDB: "#ff8b14" };
        for ( let i = 0; i < l_datatype.length; i ++ ) { l_color.push( l_datatype[ i ] == null? color_representing_null : dict_colormap[ l_datatype[ i ] ] ); }
        return l_color;
    }
    function Color_for_structure_id( l_structure_id ) {
        let l_color = [ ];
        for ( let i = 0; i < l_structure_id.length; i ++ ) { l_color.push( l_structure_id[ i ] == null? color_representing_null : "#ffffff" ); } // color representing value structure_id is 'white' color
        return l_color;
    }
    
    function Index_list_with_dictionary( l ) { // build dictionary containing list for indices for a given list of accessions (key = accession, value = list of indices containing the accession)
        let dictionary_index = { };
        for ( let i = 0; i < l.length; i ++ ) { 
            let acc = l[ i ];
            if ( acc in dictionary_index ) {
                dictionary_index[ acc ].push( i )
            } else {
                dictionary_index[ acc ] = [ i ]; // initialize value of key encountered for the first time
            }
        }
        return dictionary_index;
    }
    function Counter( l ) { // count entries in the list
        let dict_count = { };
        for ( entry of l ) {
            if ( entry in dict_count ) {
                dict_count[ entry ] += 1;
            } else {
                dict_count[ entry ] = 1;
            }
        }
        return dict_count;
    }
    function FindTheMajority( l ) { // count entries in the list and return the majority in the list
        let dict_count = Counter( l ), key_majority = '', count_majority = 0;
        for ( key of Object.keys( dict_count ) ) { // for each key
            let count = dict_count[ key ];
            if ( count > count_majority ) { // if the count of the current key is larger than count of majority key, update the majority key name
                key_majority = key;
                count_majority = count;
            }
        }
        return key_majority;
    }
    
    var rawDataURL = "https://raw.githubusercontent.com/ahs2202/3M/master/example.2.tsv";
    var BCellDataURL = "https://raw.githubusercontent.com/ahs2202/3M/master/example.2.tsv.gz";

    var plotMolecularMimicryMap = document.getElementById( 'plotly_graph_molecular_mimicry_map' );
    var plotBCellCrossReactivityMetrics = document.getElementById( 'plotly_graph_b_cell_cross_reactivity' );
    var plotTCellCrossReactivityMetrics = document.getElementById( 'plotly_graph_t_cell_cross_reactivity' );
    var tableMetrics = document.getElementById( 'd3_table_metrics' );
    var tableSequence = document.getElementById( 'plotly_table_sequence' );
    
    var str_jquery_container = "#container_PDB"; // JQuery string for returning promise for collapse transition of the container targeted by 'str_jquery_container'
    const BootstrapCollapseShownPromise = ( str_jquery ) => { // return promise when content is fully shown to the screen
        return new Promise( ( resolve, reject ) => {
            jQuery( str_jquery ).collapse( 'show' ) // trigger transition
            jQuery( str_jquery ).on( 'shown.bs.collapse', function( ) { // when transition is complete, resolve the promise
                console.log( "shown" );
                resolve( 'shown' );
            });
        });
    }
    const MolStarRenderCompletePromise = ( instance_molstar_viewer ) => { // return promise when content is fully shown to the screen
        return new Promise( ( resolve, reject ) => {
            instance_molstar_viewer.events.loadComplete.subscribe( function( ) { // when transition is complete, resolve the promise
                console.log( "rendering was completed" );
                resolve( "rendering was completed" );
            });
        });
    }
    
    var l_file = [ ];
    const fileSelector = document.getElementById( 'file-selector' );
    fileSelector.addEventListener( 'change', function( event ) {
        Loading_Screen( true ); // add loading screen
        l_file = [ ];
        l_file.push( ... event.target.files ); // retrieve list of given files
        console.log( "Locally loaded files:", l_file );
        if ( l_file.length > 0 ) { LoadLocalData( l_file ); }
        Loading_Screen( false );
    });
//                           "https://raw.githubusercontent.com/ahs2202/3M/master/current/Optivax.Supplementary_Materials.fa",
    var object_data_vaccine_design_empty = { l_file_fasta: [ ], arr_aligned_peptide: [ ], dict_header_to_seq: { }, dict_duplicated_header_count: { }, data: [ ], dict_data: { }, dict_y_axis_max: { }, name_y_axis: null, plotly: { }, selection: { dict_threshold: { } } }; // "dict_y_axis_max" dictionary containing max value of y-axis range for each y-axis name.
    var object_data_vaccine_design = Object.assign( { }, object_data_vaccine_design_empty ); // 'arr_fasta_vaccine_design' will contain fasta records of selected fasta files // 'dict_header_to_seq' dictionary that will contain parsed records from a given list of fasta files.
    const fileSelector_file_fasta_vaccine_design = document.getElementById( 'file_vaccine_design_fasta' );
    fileSelector_file_fasta_vaccine_design.addEventListener( 'change', async function( event ) {
        Loading_Screen( true ); // add loading screen
        object_data_vaccine_design = Object.assign( { }, object_data_vaccine_design_empty ); // initialize the object
        let l_file_fasta = [ ]; // initialized the file list
        l_file_fasta.push( ... event.target.files ); // retrieve list of given files
        console.log( "Fasta file(s) selected:", l_file_fasta );
        for ( let i = 0; i < l_file_fasta.length; i ++ ) { await LoadFasta( l_file_fasta[ i ] ); } // load a fasta file at a time
        object_data_vaccine_design.l_file_fasta = l_file_fasta; // update the file list
        ProcessVaccineCandidate( );
        Loading_Screen( false );
    });
    
    async function LoadFasta( file ) { // async. function for loading a fasta file (return a promise that resolve when parsing of FASTA file is completed)
        return new Promise( ( resolve, reject ) => {
            let reader = new FileReader( ); // initialize FileReader
            reader.onload = function( progressEvent ) {
                var l_line = this.result.split( '\n' ); // By lines
                let index = 0, line = '';
                line = l_line[ index ]; // retrieve the first line as a header
                let str_header = line, l_seq = [ ];
                while ( true ) {
                    str_header = line, l_seq = [ ];
                    while ( true ) {
                        index ++;
                        if ( index >= l_line.length ) { break; }
                        line = l_line[ index ];
                        if ( line[ 0 ] == '>' ) { break; }
                        l_seq.push( line );
                    }
                    let header = str_header.slice( 1 ), seq = l_seq.join( '' );
                    if ( header in object_data_vaccine_design.dict_duplicated_header_count ) { object_data_vaccine_design.dict_duplicated_header_count[ header ] ++; } // handle sequences with duplicated headers
                    else { object_data_vaccine_design.dict_duplicated_header_count[ header ] = 1; }
                    if ( object_data_vaccine_design.dict_duplicated_header_count[ header ] > 1 ) { object_data_vaccine_design.dict_header_to_seq[ header + '_dup_' + String( object_data_vaccine_design.dict_duplicated_header_count[ header ] ) ] = seq; } // if current fastq header in already exists, add '_dup_{index}' to the header to make it unique 
                    else { object_data_vaccine_design.dict_header_to_seq[ header ] = seq; }
                    if ( index >= l_line.length ) { break; }
                }
                console.log( file, "loaded and parsed." );
                resolve( ); // when loading and parsing is complete, resolve the promise
            };
            reader.readAsText( file )
        });
    }
    async function LoadRemoteFasta( file ) { // async. function for loading a remote fasta file through URL (return a promise that resolve when parsing of FASTA file is completed)
        return new Promise( ( resolve, reject ) => {
            jQuery.get( file, function( data ) {
                var l_line = data.split( '\n' ); // process each line
                let index = 0, line = '';
                line = l_line[ index ]; // retrieve the first line as a header
                let str_header = line, l_seq = [ ];
                while ( true ) {
                    str_header = line, l_seq = [ ];
                    while ( true ) {
                        index ++;
                        if ( index >= l_line.length ) { break; }
                        line = l_line[ index ];
                        if ( line[ 0 ] == '>' ) { break; }
                        l_seq.push( line );
                    }
                    let header = str_header.slice( 1 ), seq = l_seq.join( '' );
                    if ( header in object_data_vaccine_design.dict_duplicated_header_count ) { object_data_vaccine_design.dict_duplicated_header_count[ header ] ++; } // handle sequences with duplicated headers
                    else { object_data_vaccine_design.dict_duplicated_header_count[ header ] = 1; }
                    if ( object_data_vaccine_design.dict_duplicated_header_count[ header ] > 1 ) { object_data_vaccine_design.dict_header_to_seq[ header + '_dup_' + String( object_data_vaccine_design.dict_duplicated_header_count[ header ] ) ] = seq; } // if current fastq header in already exists, add '_dup_{index}' to the header to make it unique 
                    else { object_data_vaccine_design.dict_header_to_seq[ header ] = seq; }
                    if ( index >= l_line.length ) { break; }
                }
                console.log( "[LoadRemoteFasta] remote file", file, "loaded and parsed." );
                resolve( ); // when loading and parsing is complete, resolve the promise
            });
        });
    }
    // object containing parsed data
    var object_data_acc_virus_representative = { }, object_data_vaccine_metric = { dict_data: { }, data: [ ] }, object_data_interpro_virus = { }, object_data_iedb_epitope_virus = { }, object_data_consensus_sequence_virus = { };
    function AlignPeptide( ) { // align peptides to concatanated consensus protein sequence for the virus
        object_data_vaccine_design.arr_aligned_peptide = [ ]; // empty array containing records of aligned peptides
        let l_header = Object.keys( object_data_vaccine_design.dict_header_to_seq );
        if ( ! ( 'seq_consensus_concatenated' in object_data_vaccine_metric ) ) { return; } // if 'object_data_acc_virus_representative' has not been loaded, do not align the peptides
        let seq_consensus_concatenated = object_data_vaccine_metric.seq_consensus_concatenated; // retrieve 'seq_consensus_concatenated'
        for ( let i = 0; i < l_header.length; i ++ ) {
            let header = l_header[ i ];
            let seq = object_data_vaccine_design.dict_header_to_seq[ header ], len_seq = seq.length;
            let start_alignment = seq_consensus_concatenated.indexOf( seq ) + 1, end_alignment = start_alignment + len_seq - 1; // 1-based coordinate
            if ( start_alignment != 0 ) { object_data_vaccine_design.arr_aligned_peptide.push( { header: header, seq: seq, start_alignment: start_alignment, end_alignment: end_alignment, n_mismatches: 0 } ); }
            else {
                let n_max_mismatches = parseInt( len_seq / 3 ), bool_flag_match_found = false, pos_aligned = undefined, n_mismatches_alignment = undefined; // retrieve the maximum number of mismatches
                for ( let n_mismatches = 1; n_mismatches < n_max_mismatches; n_mismatches ++ ) {
                    for ( let pos = 0; pos < seq_consensus_concatenated.length - len_seq + 1; pos ++ ) {
                        let seq_consensus_peptide = seq_consensus_concatenated.slice( pos, pos + len_seq );
                        if ( FuzzyContains( seq, seq_consensus_peptide, n_mismatches ) ) { // if match is found
                            pos_aligned = pos, bool_flag_match_found = true, n_mismatches_alignment = n_mismatches;
                            break;
                        }
                    }
                    if ( bool_flag_match_found ) { break; } // if match is found at the current 'n_mismatches', skip search with larger 'n_mismatches'
                }
                if ( bool_flag_match_found ) { console.log( "Alignment considering mismatches succeeded:", header, seq, n_mismatches_alignment ); object_data_vaccine_design.arr_aligned_peptide.push( { header: header, seq: seq, start_alignment: pos_aligned, end_alignment: pos_aligned + len_seq, n_mismatches: n_mismatches_alignment } ); } // infer 'end_alignment' using the length of the peptide // 0-based coordinates
                else { console.log( "Alignment failed for", header, seq ); }
            }
        }
        console.log( "Alignment operations of", l_header.length, "peptides are completed. The number of successfully aligned peptides is", object_data_vaccine_design.arr_aligned_peptide.length );
        AlignPeptide_Post_Processing( );
    }
    function AlignPeptide_Post_Processing( ) { // post-processing step of 'AlignPeptide' function
        object_data_vaccine_design.dict_data = Unpack_array_to_dict_data( object_data_vaccine_design.arr_aligned_peptide, Object.keys( object_data_vaccine_design.arr_aligned_peptide[ 0 ] ) ); // unpack an array into another format
        object_data_vaccine_design.dict_data[ "start" ] = nj.array( ArrayMap( object_data_vaccine_design.dict_data[ "start_alignment" ], object_data_vaccine_metric.dict_accumulated_coord_to_individual_coord ) ).add( 1 ).tolist( ), object_data_vaccine_design.dict_data[ "end" ] = ArrayMap( object_data_vaccine_design.dict_data[ "end_alignment" ], object_data_vaccine_metric.dict_accumulated_coord_to_individual_coord ), object_data_vaccine_design.dict_data[ "protein_name" ] = ArrayApply( object_data_vaccine_design.dict_data[ "start_alignment" ], function( start ) { return arr_data_acc_virus_representative[ object_data_vaccine_metric.dict_accumulated_coord_to_acc_rep[ start ] ].name; } ); // retrieve coordinates of individual proteins // 1-based coordinates
        let seed = xmur3( "molecular_mimicry_map_of_SARS-CoV-2" ), rand = mulberry32( seed( ) ), l_random_value = [ ]; // retrieve seed for a PRNG // retrieve a function for PRNG
        for( let i = 0; i < object_data_vaccine_design.arr_aligned_peptide.length; i ++ ) { l_random_value.push( rand( ) ); } // retrieve random values for aligned peptides for displaying peptides
        object_data_vaccine_design.dict_data[ "random_value" ] = l_random_value;
        object_data_vaccine_design.dict_data[ "selected" ] = ArrayFull( object_data_vaccine_design.arr_aligned_peptide.length, true ); // initially all peptides are selected
        document.getElementById( "div_display_current_number_of_peptides" ).innerHTML = "Total number of peptides is " + String( object_data_vaccine_design.arr_aligned_peptide.length ) + '.'; // update description in modal_generate_peptides
    }
    function Retrieve_Peptides( ) { // retrieve peptides of the given window size
        let window_size = parseInt( document.getElementById( "input_window_size_generate_peptides" ).value ), str_message = "";
        if ( window_size <= 0 ) { // check validity of a given window size
            str_message = "peptide length cannot be smaller than 1";
            Dismissible_Alert( "#modal_generate_peptides_alert_container", "warning", str_message ); // display number of peptides generated via an alert message  
            console.log( "[Retrieve_Peptides] invalid window_size, exiting" ); return;
        }
        object_data_vaccine_design.arr_aligned_peptide_retrieved_from_consensus = [ ];
        for ( let object_protein of arr_data_acc_virus_representative ) {
            let name_protein = object_protein.name.replace( " ", '_' ).replace( "(", "" ).replace( ")", "" ), seq_protein = object_protein.seq_consensus, start_accumulated = object_protein.accumulated_start_skipping_orf1a__for_web_application;
            for ( let pos_start = 0, pos_end = pos_start + window_size; pos_end <= object_protein.length ;  ) { // 0-based coordinates
                let seq_peptide = seq_protein.slice( pos_start, pos_end );
                let n_gaps = CountOccurrence( seq_peptide, '-' )
                if ( window_size == ( seq_peptide.length - n_gaps ) ) { // if number of non-gap residues are the same with window_size, add the peptide to the list
                    object_data_vaccine_design.arr_aligned_peptide_retrieved_from_consensus.push( { start_alignment: start_accumulated + pos_start, end_alignment: start_accumulated + pos_end, seq: seq_peptide, header: "3M_of_SARS_CoV_2_" + name_protein + "_" + String( pos_start + 1 ) + "to" + String( pos_end ), n_mismatches: 0 } ); // 0-based coodinates
                    pos_start += 1;
                    pos_end = pos_start + window_size
                } else {
                    pos_end += n_gaps - ( seq_peptide.length - window_size ); // if number of non-gap residues are not the same with window_size, extend pos_end to include more residues.
                }
            }
        }
        str_message = "<b>" + String( object_data_vaccine_design.arr_aligned_peptide_retrieved_from_consensus.length ) + ' peptides were successfully generated for window size ' + String( window_size ) + '</b>';
        console.log( "[Retrieve_Peptides] ", str_message );
        Dismissible_Alert( "#modal_generate_peptides_alert_container", "success", str_message ) // display number of peptides generated via an alert message  
    }
    function AnalyzeVaccineDesign( ) { // analyze vaccine design with the current view of MolecularMimicryMap
        console.log( "analyzing a given list of vaccine candidates..." )
        let arr_data_BCellCrossReactivity_selected = ArrayBooleanIndexing( arr_data_BCellCrossReactivity, object_plot_BCellCrossReactivity.mask_selected ), arr_data_TCellCrossReactivity_selected = ArrayBooleanIndexing( arr_data_TCellCrossReactivity, object_plot_TCellCrossReactivity.mask_selected );
        let tree_bcellcrossreactivity_data = createIntervalTree( ArrayTranspose( [ nj.array( unpack( arr_data_BCellCrossReactivity_selected, "target_representative_accumulated_start__for_web_application" ) ).subtract( 1 ).tolist( ), nj.array( unpack( arr_data_BCellCrossReactivity_selected, "target_representative_accumulated_end__for_web_application" ) ).subtract( 0.1 ).tolist( ) ] ) ), tree_tcellcrossreactivity_data = createIntervalTree( ArrayTranspose( [ nj.array( unpack( arr_data_TCellCrossReactivity_selected, "target_representative_accumulated_start__for_web_application" ) ).subtract( 1 ).tolist( ), nj.array( unpack( arr_data_TCellCrossReactivity_selected, "target_representative_accumulated_end__for_web_application" ) ).subtract( 0.1 ).tolist( ) ] ) ); // build interval trees with 0-based coordinates
        // analyze vaccine candidate based on the currently available data in this application
        let l_start_vaccine_design = object_data_vaccine_design.dict_data[ "start_alignment" ], l_end_vaccine_design = object_data_vaccine_design.dict_data[ "end_alignment" ];
        object_data_vaccine_design.dict_data[ "number_of_overlapped_potential_b_cell_cross_reactive_epitopes" ] = [ ], object_data_vaccine_design.dict_data[ "number_of_overlapped_potential_t_cell_cross_reactive_epitopes" ] = [ ]; 
        let l_col = Object.keys( object_data_vaccine_metric.dict_data );
        for ( let i = 0; i < l_col.length; i ++ ) { object_data_vaccine_design.dict_data[ l_col[ i ] ] = [ ]; } // initialize data containers
        for ( let i = 0; i < l_start_vaccine_design.length; i ++ ) { 
            let start = l_start_vaccine_design[ i ], end = l_end_vaccine_design[ i ], counter_overlapped_bcellcrossreactivity_data = 0, counter_overlapped_tcellcrossreactivity_data = 0; 
            tree_bcellcrossreactivity_data.queryInterval( start - 1, end - 0.1, function( interval ) { counter_overlapped_bcellcrossreactivity_data ++; } ); // since the "interval-tree-id" consider a point overlap as an overlap, 0-based coordinate requires subtraction of 0.1 from either the start or the end of the interval.
            tree_tcellcrossreactivity_data.queryInterval( start - 1, end - 0.1, function( interval ) { counter_overlapped_tcellcrossreactivity_data ++; } );
            object_data_vaccine_design.dict_data[ "number_of_overlapped_potential_b_cell_cross_reactive_epitopes" ].push( counter_overlapped_bcellcrossreactivity_data );
            object_data_vaccine_design.dict_data[ "number_of_overlapped_potential_t_cell_cross_reactive_epitopes" ].push( counter_overlapped_tcellcrossreactivity_data );
            for ( let j = 0; j < l_col.length; j ++ ) {
                let col = l_col[ j ];
                switch( col ) {
                    case "type_of_structural_data" : 
                    case "secondary_structure_classification__dssp_8_states" : 
                        object_data_vaccine_design.dict_data[ col ].push( FindTheMajority( object_data_vaccine_metric.dict_data[ col ].slice( start, end ) ) ); // retrieve list of vaccine metric data values with 0-based coordinates, and retrieve the majority classification for analysis
                        break;
                    default: object_data_vaccine_design.dict_data[ col ].push( Math.max( ... object_data_vaccine_metric.dict_data[ col ].slice( start, end ) ) ); // retrieve list of vaccine metric data values with 0-based coordinates, and retrieve the maximum value for analysis
                }
            }
        }
        object_data_vaccine_design.string_csv = ''; // initialize a data container for downloading file
    }
    function ProcessVaccineCandidate( ) { // a pipeline to parse and process loaded peptide vaccine candidates
        AlignPeptide( ); // align peptides to concatanated consensus protein sequence for the virus        
        AnalyzeVaccineDesign( );
        object_data_vaccine_design.plotly = { }, object_data_vaccine_design.dict_y_axis_max = { }; // initialize data related to updating the plotly plot after plotly_relayout 
        Draw_DesignedVaccineTrace( "updated_peptides" );
        Loading_Screen( false );
    }
    function Update_Peptides( mode_update ) {
        let name_file = object_data_vaccine_design.l_file_fasta[ 0 ].name;
        if ( mode_update == 'append' ) { 
            object_data_vaccine_design.arr_aligned_peptide.push( ... object_data_vaccine_design.arr_aligned_peptide_retrieved_from_consensus ); 
            object_data_vaccine_design.l_file_fasta[ 0 ].name = name_file.slice( 0, name_file.lastIndexOf( '.' ) ) + ".plus.3M_of_SARS_CoV_2.custom_peptides.fa"; // modify file names for downloading
        } 
        else if ( mode_update == "replace" ) { 
            object_data_vaccine_design.arr_aligned_peptide = object_data_vaccine_design.arr_aligned_peptide_retrieved_from_consensus;
            object_data_vaccine_design.l_file_fasta[ 0 ].name = "3M_of_SARS_CoV_2.custom_peptides.fa"; // modify file names for downloading
        }
        AlignPeptide_Post_Processing( );
        AnalyzeVaccineDesign( );
        object_data_vaccine_design.plotly = { }, object_data_vaccine_design.dict_y_axis_max = { }; // initialize data related to updating the plotly plot after plotly_relayout 
        Draw_DesignedVaccineTrace( "updated_peptides" );
    }
    
    function Retrieve_Selection_of_Peptides( ) {
        if ( ! ( "selection" in object_data_vaccine_design ) ) { object_data_vaccine_design.selection = { }; } // add selection object if not present in the vaccine_design object
        object_data_vaccine_design.selection.selection_mode_include_or_exclude = $('#radio__Vaccine_Design__Selection_Thresholding_Mode__Include_or_Exclude label.active input').attr( "value" ); // retrieve selection mode
        object_data_vaccine_design.selection.selection_mode_above_or_below = $('#radio__Vaccine_Design__Selection_Thresholding_Mode__Above_or_Below label.active input').attr( "value" ); // retrieve selection mode
        
        let float_threshold = parseFloat( document.getElementById( "input_threshold_select_peptides" ).value );
        if ( ! isNaN( float_threshold ) && float_threshold > 0 ) { object_data_vaccine_design.selection.dict_threshold[ object_data_vaccine_design.name_y_axis ] = float_threshold; } // update float_threshold value // valid float_threshold should be a positive value
        
        let l_data = object_data_vaccine_design.dict_data[ object_data_vaccine_design.name_y_axis ];
        let l_mask = object_data_vaccine_design.selection.selection_mode_above_or_below == 'Above' ? ArrayGreaterThan( l_data, float_threshold ) : ArrayLessThan( l_data, float_threshold );
        
        let l_bool_selected = object_data_vaccine_design.dict_data[ "selected" ], l_bool_selected_updated = lodash.cloneDeep( l_bool_selected ), bool_flag_include = object_data_vaccine_design.selection.selection_mode_include_or_exclude == 'Include', int_count_changed = 0;
        for ( let i = 0; i < l_bool_selected_updated.length; i ++ ) {
            if ( bool_flag_include && l_mask[ i ] && ! l_bool_selected_updated[ i ] ) { // include peptides
                l_bool_selected_updated[ i ] = true;
                int_count_changed ++;
            } else if ( ! bool_flag_include && l_mask[ i ] && l_bool_selected[ i ] ) { // exclude peptides
                l_bool_selected_updated[ i ] = false;
                int_count_changed ++;
            }
        }
        object_data_vaccine_design.selection.l_selected_previous = l_bool_selected, object_data_vaccine_design.selection.l_selected_current = l_bool_selected_updated;
        document.getElementById( "button_apply_change_select_peptides" ).disabled = false; // enable apply button
        document.getElementById( "button_undo_last_change_modal_select_peptides" ).disabled = true; // enable apply button
        str_message = String( ArraySum( l_mask ) ) + '/' + String( l_mask.length )  +  ' peptides ' + ( object_data_vaccine_design.selection.selection_mode_above_or_below == 'Above' ? "above" : "below" ) + ' threshold were retrieved.<br>Among these, ' + String( int_count_changed ) + ' peptides will be ' + ( object_data_vaccine_design.selection.selection_mode_include_or_exclude == 'Include' ? "included" : "excluded" ) + ' when applying current selection.';
        console.log( "[Retrieve_Selection_of_Peptides] ", str_message );
        Dismissible_Alert( "#modal_select_peptides_alert_container", "info", str_message ); // display number of peptides generated via an alert message  
    }
    function Update_Selection_of_Peptides( mode ) {
        if ( ! ( "selection" in object_data_vaccine_design ) ) { return; } // exits when a function call is invalid
        if ( ! ( "l_selected_previous" in object_data_vaccine_design.selection ) ) { return; } 
        
        if ( mode == 'apply' ) {
            object_data_vaccine_design.dict_data[ "selected" ] = object_data_vaccine_design.selection.l_selected_current;
        } else if ( mode == 'undo_last_change' ) {
            object_data_vaccine_design.dict_data[ "selected" ] = object_data_vaccine_design.selection.l_selected_previous;
        }
        document.getElementById( "div_display_current_number_of_selected_peptides" ).innerHTML = "Total number of selected peptides: " + String( ArraySum( object_data_vaccine_design.dict_data[ "selected" ] ) ) + '.'; // update description in modal_select_peptides
        document.getElementById( "button_apply_change_select_peptides" ).disabled = mode == 'apply'; // update disabled status of undo last change button
        document.getElementById( "button_undo_last_change_modal_select_peptides" ).disabled = mode == 'undo_last_change';
        Draw_DesignedVaccineTrace( "update_selection" ); // update selection
    }

    function Draw_DesignedVaccineTrace( mode_drawing ) {
        // check validility of funciton call
        if ( object_data_vaccine_design.arr_aligned_peptide.length == 0 ) { console.log( "[Draw_DesignedVaccineTrace] since there is no aligned peptides from the input vaccine candidates or the file has not been loaded, skip drawing a plot" ); return; } // if there are no aligned peptides, stop drawing the plot
        Loading_Screen( true ) // add loading screen
        let index_trace = dict_name_plot_to_trace_index__MolecularMimicryMap[ "vaccine_design" ]; // retrieve index of vaccine_design trace
        // prepare a trace for displaying designed vaccines
        object_data_vaccine_design.show = document.getElementById( "checkbox_toggle_vaccine_design_MolecularMimicryMap" ).checked; // set visibility of vaccine design
        let trace = { };
        trace.visible = object_data_vaccine_design.show;
        // retrieve markers settings according to the selected peptides
        let l_bool_selected = object_data_vaccine_design.dict_data[ "selected" ], color_selected = "#1c03ff", color_not_selected = "#ffaf03";
        object_data_vaccine_design.l_color = [ ];
        for ( let i = 0; i < l_bool_selected.length; i ++ ) { object_data_vaccine_design.l_color.push( l_bool_selected[ i ]? color_selected : color_not_selected ); } // update color based on selection
        trace.marker = { size: 10, opacity: 0.5, color: object_data_vaccine_design.l_color, line: { width: 2 }, symbol: "cross-open" };
        if ( mode_drawing == 'update_selection' ) { // update markers and exits
            Plotly.restyle( plotMolecularMimicryMap, trace, index_trace ); Loading_Screen( false ); return;
        }
        // retrieve y_axis values according to y-axis and y-axis max range setting
        let name_y_axis = document.getElementById( "select_yaxis_plot_vaccine_design" ).value, name_y_axis_previous = object_data_vaccine_design.name_y_axis; // retrieve current y_axis name
        object_data_vaccine_design.name_y_axis = name_y_axis; // update y-axis name
        
        if ( mode_drawing == "update_float_y_axis_range_max" ) {
            let float_y_axis_max = parseFloat( document.getElementById( "input_y_axis_range_max" ).value ); // retrieve and update y-axis max values 
            if ( ! isNaN( float_y_axis_max ) && float_y_axis_max > 0 ) { object_data_vaccine_design.dict_y_axis_max[ name_y_axis ] = float_y_axis_max; } // update y_axis_range_max value // valid y_axis_max should be a positive value
        } else {
            if ( ! ( name_y_axis in object_data_vaccine_design.dict_y_axis_max ) ) { 
                let l = object_data_vaccine_design.dict_data[ name_y_axis ];
                object_data_vaccine_design.dict_y_axis_max[ name_y_axis ] = Math.max( ... l );
                object_data_vaccine_design.selection.dict_threshold[ name_y_axis ] = ( ArraySum( l ) / l.length ) + ArrayStandardDeviation( l ); // retrieve sum + 1 std.
            } // if max value for y_axis range does not exist, use the max value of y_values by default
            let float_y_axis_max = object_data_vaccine_design.dict_y_axis_max[ name_y_axis ], float_y_axis_threshold = object_data_vaccine_design.selection.dict_threshold[ name_y_axis ];
            document.getElementById( "input_y_axis_range_max" ).value = CheckInt( float_y_axis_max ) ? String( float_y_axis_max ) : float_y_axis_max.toFixed( 3 ); // show float_y_axis_max value of the name_y_axis
            document.getElementById( "input_threshold_select_peptides" ).value = CheckInt( float_y_axis_threshold ) ? String( float_y_axis_threshold ) : float_y_axis_threshold.toFixed( 3 ); // show float_y_axis_threshold value of the name_y_axis
        } // set default y_axis_range_max 
        object_data_vaccine_design.plotly.y = ArrayCap( object_data_vaccine_design.dict_data[ name_y_axis ], object_data_vaccine_design.dict_y_axis_max[ name_y_axis ] ); // cap at specific value
        let arr_y = nj.array( object_data_vaccine_design.plotly.y ); 
        trace.y = arr_y.divide( arr_y.max( ) / 1.70 ).subtract( 5.85 ).tolist( ); // retrieve y-axis values
        if ( mode_drawing == "update_name_y_axis" || mode_drawing == "update_float_y_axis_range_max" ) { // update only y and exists
            Plotly.restyle( plotMolecularMimicryMap, { y: [ trace.y ] }, [ index_trace ] ); Loading_Screen( false ); Adjust_Layout_MolecularMimicryMap( "vaccine_design_y_axis_updated" ); return;
        }
        // retrieve custom data and other settings for drawing a new trace
        let l_start = object_data_vaccine_design.dict_data[ "start_alignment" ], l_end = object_data_vaccine_design.dict_data[ "end_alignment" ]; // 0-based coordinates
        trace.x = nj.array( l_start ).add( l_end ).divide( 2 ).tolist( );
        trace.marker = { size: 10, opacity: 0.5, color: ArrayFull( l_start.length, color_selected ), line: { width: 2 }, symbol: "cross-open" }; // selected color: dark green 
        trace.type = 'scattergl';
        trace.mode = 'markers';
        trace.name = "vaccine_design";
        trace.showlegend = false;
        trace.error_x = { type: 'data', array: nj.array( l_end ).subtract( l_start ).divide( 2 ).tolist( ), visible: true, width: 0, thickness: 1 }; // represent alignment by using errorbar
        trace.hovertemplate = ["header: %{customdata[3]}",
                               'seq: <b>%{customdata[4]}</b>',
                               '<b>%{customdata[0]}</b> from <b>%{customdata[1]:.0f}</b> to <b>%{customdata[2]:.0f}</b> (%{customdata[5]:.0f} mismatch)',
                               '',
                               'number of <b>mutated</b> proteins: <b>%{customdata[10]:.0f}</b>',
                               'number of overlapped predicted <b>B-cell cross-reactive epitopes</b>: <b>%{customdata[6]:.0f}</b>',
                               'number of overlapped predicted <b>T-cell cross-reactive MHC epitopes</b>: <b>%{customdata[7]:.0f}</b>',
                               'number of overlapped predicted <b>MHC-I epitopes</b> (af<0.001): <b>%{customdata[16]:.0f}</b>',
                               'number of overlapped predicted <b>MHC-II epitopes</b> (af<0.001): <b>%{customdata[17]:.0f}</b>',
                               'number of <b>positive B-cell assays</b> for overlapped IEDB epitopes: <b>%{customdata[8]:.0f}</b>',
                               'number of <b>positive T-cell assays</b> for overlapped IEDB epitopes: <b>%{customdata[9]:.0f}</b>',
                               'Relative accessible surface area: <b>%{customdata[18]:.1%}</b>',
                               'B cell linear epitope prediction score (BepiPred): <b>%{customdata[14]:.3f}</b>',
                               'MHC-I epitope processing score (MHCflurry): <b>%{customdata[15]:.3f}</b>',
                               '<extra></extra>' ].join( "<br>" );
        let n_residues = object_data_vaccine_metric.accumulated_length;
        let trace_vaccine_design_lower_bound = { x : [ 0, n_residues ], y : [ -4, -4 ], type : "scattergl", mode : 'lines', line : { color: '#000000', width: 1 }, showlegend : false, name: "vaccine_design__lower_bound" }, trace_vaccine_design_upper_bound = { x : [ 0, n_residues ], y : [ -6, -6 ], type : "scattergl", mode : 'lines', line : { color: '#000000', width: 1 }, showlegend : false, name: "vaccine_design__upper_bound" };
        trace.customdata = ArrayTranspose( [object_data_vaccine_design.dict_data[ "protein_name" ], 
                                            object_data_vaccine_design.dict_data[ "start" ], 
                                            object_data_vaccine_design.dict_data[ "end" ], 
                                            object_data_vaccine_design.dict_data[ "header" ], 
                                            object_data_vaccine_design.dict_data[ "seq" ],  
                                            object_data_vaccine_design.dict_data[ "n_mismatches" ], // 5
                                            object_data_vaccine_design.dict_data[ "number_of_overlapped_potential_b_cell_cross_reactive_epitopes" ], 
                                            object_data_vaccine_design.dict_data[ "number_of_overlapped_potential_t_cell_cross_reactive_epitopes" ], 
                                            object_data_vaccine_design.dict_data[ "count_iedb_epitope_with_bcell_assay" ], 
                                            object_data_vaccine_design.dict_data[ "count_iedb_epitope_with_tcell_assay" ], 
                                            object_data_vaccine_design.dict_data[ "count_non_consensus_residue" ], // 10
                                            object_data_vaccine_design.dict_data[ "count_non_consensus_residue__USA" ], 
                                            object_data_vaccine_design.dict_data[ "count_non_consensus_residue__India" ], 
                                            object_data_vaccine_design.dict_data[ "count_non_consensus_residue__Australia" ], 
                                            object_data_vaccine_design.dict_data[ "score_linear_bcell_epitope_prediction__bepipred" ], 
                                            object_data_vaccine_design.dict_data[ "avg_processing_score_mhc_i" ], // 15
                                            object_data_vaccine_design.dict_data[ "count_peptide_binding_common_mhc_i_alleles__537_alleles__min_allele_frequency_0.001" ], 
                                            object_data_vaccine_design.dict_data[ "count_peptide_binding_common_mhc_ii_alleles__1668_alleles__min_allele_frequency_0.001" ],
                                            object_data_vaccine_design.dict_data[ "relative_accessible_surface_area" ] ] ); // add custom data for hoverinfo.
        object_data_vaccine_design.data = [ trace_vaccine_design_lower_bound, trace_vaccine_design_upper_bound, trace ];
        if ( mode_drawing == "new_trace" || ! ( "vaccine_design" in dict_name_plot_to_trace_index__MolecularMimicryMap ) ) { // draw new trace
            console.log( '[Draw_DesignedVaccineTrace] adding new traces ...' );
            object_data_vaccine_design.index_trace_start = plotMolecularMimicryMap.data.length; // record index_start and index_end of traces
            Plotly.addTraces( plotMolecularMimicryMap, lodash.cloneDeep( object_data_vaccine_design.data ) );
            object_data_vaccine_design.index_trace_end = plotMolecularMimicryMap.data.length;
            for( let i = 0; i < plotMolecularMimicryMap.data.length; i ++ ) { dict_name_plot_to_trace_index__MolecularMimicryMap[ plotMolecularMimicryMap.data[ i ].name ] = i; } // update mapping of name of each trace to trace index
        } else if ( mode_drawing == "new_analysis" || mode_drawing == "updated_peptides" ) { // update the existing trace
            console.log( '[Draw_DesignedVaccineTrace] updating existing trace ...' );
            trace.x = [ trace.x ];
            trace.y = [ trace.y ];
            trace.customdata = [ trace.customdata ];
            Plotly.restyle( plotMolecularMimicryMap, trace, index_trace ); // update vaccine_design trace based on updated peptides
        }
        Loading_Screen( false ); Adjust_Layout_MolecularMimicryMap( "vaccine_design_y_axis_updated" ); return;// update y-axis annotation
    }
    function Download_Analysis_Result__Vaccine_Design( ) { // download analysis result of vaccine candidate as a csv file
        if ( object_data_vaccine_design.string_csv.length == 0 ) {
            let df = new DataFrame( object_data_vaccine_design.dict_data );
            object_data_vaccine_design.string_csv = df.toCSV( true );
        }
        let blob = new Blob( [ object_data_vaccine_design.string_csv ], { type: "text/plain;charset=utf-8" } );
        let name_file = object_data_vaccine_design.l_file_fasta[ 0 ].name;
        name_file = name_file.slice( 0, name_file.lastIndexOf( '.' ) ) + '_MolecularMimicryMap_of_SARS-CoV-2_analysis_result.csv'
        saveAs( blob, name_file ); // save file 
    }
    
    var l_parsed_data = [ ], dict_filename_to_parsed_data = { };
    var l_colormap_rainbow_acc_human = [ ], dict_blosum62 = { }, function_colormap_rsa = chroma.scale( [ 'black', 'white' ] ), function_colormap_score_blosum = chroma.scale( [ '#f00','white', '#0f0' ] ), function_colormap_torsion_angle = chroma.scale( [ '#52f9ff', '#972ff7', 'yellow', '#52f9ff' ] ), function_colormap_score_iedb_epitope = chroma.scale( [ '#ff00f2', '#1500ff' ] ); // define functions for colormaps
    var arr_data_blosum62 = [ ], arr_data_acc_virus = [ ], arr_data_acc_human = [ ], arr_data_acc_pdb = [ ], arr_data_algorithms = [ ], arr_data_mhc_allele = [ ], arr_data_alignment_human_pdb = [ ], arr_data_alignment_human_virus = [ ], arr_data_alignment_virus_pdb = [ ], arr_data_structural_property_human = [ ], arr_data_structural_property_virus = [ ], arr_data_BCellCrossReactivity = [ ], arr_data_TCellCrossReactivity = [ ];
    // dictionary-based indices for accessing data efficiently
    var dictionary_acc_human_BCellCrossReactivity = { }, dictionary_acc_human_TCellCrossReactivity = { }, dictionary_acc_human_to_integer_index = { };
    async function LoadRemoteData( l_file ) {
        Loading_Screen( true ) // add loading screen
        let l_promise = l_file.map( function( file ) { 
            return new Promise ( function( resolve, reject ) {
                Papa.parse( file, { download: true, header: true, skipEmptyLines: false, delimiter: '\t', dynamicTyping: true, complete: function( results ) { resolve( results.data.slice( 0, results.data.length - 1 ) ) }, error: reject } ); }); }); // 'skipEmptyLines' is set to false to allow reading empty lines in some input files // due to 'skipEmptyLines: false' option, the last line is empty, and should be discarded
        let results = await Promise.all( l_promise ); // wait until all files have been parsed by Papa.parse
        l_parsed_data = [ ]; // empty a list
        l_parsed_data.push( ... results );
        for ( let i = 0; i < l_file.length; i ++ ) { 
            let url_file = l_file[ i ], name_file = url_file.slice( url_file.lastIndexOf( "/" ) + 1 )
            dict_filename_to_parsed_data[ name_file ] = l_parsed_data[ i ];
        } // put parsed data into a dictionary
        console.log( "[LoadRemoteData] parsing completed:", Object.keys( dict_filename_to_parsed_data ) );
        await ParseData( );
        console.log( "[LoadRemoteData] processing of parsed data completed:", Object.keys( dict_filename_to_parsed_data ) );
        console.log( "[LoadRemoteData] now downloading and drawing peptide vaccine candidates" );
        await LoadOptiVax( );
        Loading_Screen( false );
        ClickCallBack_BCellCrossReactivity( 127 ); // show an example potentially cross-reactive B-cell epitope after loading
    }
    async function LoadOptiVax( ) { // load OptiVax peptide vaccine candidates
        return new Promise( async function( resolve, reject ) {
            object_data_vaccine_design = Object.assign( { }, object_data_vaccine_design_empty ); // initialize the object
            object_data_vaccine_design.l_file_fasta = [ { name: "Optivax.Supplementary_Materials.fa" } ];
            await LoadRemoteFasta( "https://raw.githubusercontent.com/ahs2202/3M/master/current/peptides/Optivax/Optivax.Supplementary_Materials.fa" ); // load a fasta file at a time
            ProcessVaccineCandidate( );
            console.log( "[LoadOptiVax] OptiVac peptide vaccine candidates loaded" );
            resolve( "" );
        });
    }
    async function LoadLocalData( l_file ) {
        Loading_Screen( true ) // add loading screen
        let l_promise = l_file.map( function( file ) { 
            return new Promise ( function( resolve, reject ) {
                Papa.parse( file, { header: true, skipEmptyLines: false, delimiter: '\t', dynamicTyping: true, complete: function( results ) { resolve( results.data.slice( 0, results.data.length - 1 ) ) }, error: reject } ); }); }); // 'skipEmptyLines' is set to false to allow reading empty lines in some input files // due to 'skipEmptyLines: false' option, the last line is empty, and should be discarded
        let results = await Promise.all( l_promise ) // wait until all files have been parsed by Papa.parse
        l_parsed_data = [ ]; // empty a list
        l_parsed_data.push( ... results ); 
        for ( let i = 0; i < l_file.length; i ++ ) { dict_filename_to_parsed_data[ l_file[ i ].name ] = l_parsed_data[ i ]; } // put parsed data into a dictionary
        console.log( "[LoadLocalData] parsing completed:", dict_filename_to_parsed_data );
        await ParseData( );
        Loading_Screen( false );
    }
    async function ParseData( ) { // parse loaded data and prepare for plotting molecular mimicry map plots
        arr_data_blosum62 = dict_filename_to_parsed_data[ "blosum62.tsv" ]; // blosum62 score matrix
        arr_data_acc_virus = dict_filename_to_parsed_data[ "acc_virus.tsv" ];
        arr_data_acc_human = dict_filename_to_parsed_data[ "acc_human.tsv" ];
        arr_data_acc_pdb = dict_filename_to_parsed_data[ "acc_pdb.tsv" ];
        arr_data_algorithms = dict_filename_to_parsed_data[ "algorithms.tsv" ];
        arr_data_mhc_allele = dict_filename_to_parsed_data[ "mhc_allele.tsv" ];
        arr_data_acc_virus_representative = dict_filename_to_parsed_data[ "acc_virus_representative.tsv" ];
        arr_data_alignment_human_pdb = dict_filename_to_parsed_data[ "alignment_human_pdb__compact__for_web_application.tsv" ];
        arr_data_alignment_human_virus = dict_filename_to_parsed_data[ "alignment_human_virus__compact__for_web_application.tsv" ];
        arr_data_alignment_virus_pdb = dict_filename_to_parsed_data[ "alignment_virus_pdb__compact__for_web_application.tsv" ];
        arr_data_structural_property_human = dict_filename_to_parsed_data[ "structural_property_human__compact__for_web_application.tsv" ];
        arr_data_structural_property_virus = dict_filename_to_parsed_data[ "structural_property_virus__compact__for_web_application.tsv" ];
        arr_data_iedb_epitope_virus = dict_filename_to_parsed_data[ "iedb_epitope_virus.tsv" ]; // IEDB records of virus proteins
        arr_data_interpro_virus = dict_filename_to_parsed_data[ "interpro_virus.tsv" ]; // interpro annotation of virus proteins
        // parse data for displaying vaccine metrics
        let l_col = Object.keys( arr_data_acc_virus_representative[ 0 ] ); // retrieve list of columns of 'arr_data_acc_virus_representative'
        for ( let i = 0; i < l_col.length; i ++ ) {
            let col = l_col[ i ], l_data = [ ];
            if ( col.slice( 0, 2 ) == 'l_' ) {
                for ( let j = 0; j < arr_data_acc_virus_representative.length; j ++ ) { l_data.push( ... Unpack_String_Numbers( arr_data_acc_virus_representative[ j ][ col ] ) ); }
                object_data_vaccine_metric.dict_data[ col.slice( 2 ) ] = l_data;
            } else if ( col.includes( "___ascii_encoding_" ) ) { // concatanate structural data
                let name_data = col.split( "___ascii_encoding_" )[ 0 ];
                for ( let j = 0; j < arr_data_acc_virus_representative.length; j ++ ) { 
                    let seq_data = arr_data_acc_virus_representative[ j ][ col ], l_value = [ ];
                    switch ( name_data ) {
                        case "rsa_combined" : 
                            l_value = Unpack_String_rsa_encoded_by_two_char( seq_data );
                            break;
                        case "rsa_datatype_combined" : 
                            l_value = Unpack_String_datatype( seq_data );
                            break;
                        case "ss8_combined" : 
                            l_value = Unpack_String_ss8( seq_data );
                            break;
                    }
                    l_data.push( ... l_value );
                }
                object_data_vaccine_metric.dict_data[ { rsa_combined: "relative_accessible_surface_area", rsa_datatype_combined: "type_of_structural_data", ss8_combined: "secondary_structure_classification__dssp_8_states" }[ name_data ] ] = l_data;
            } else { continue; } // only concatanate data from columns starting with 'l_' or containing '___ascii_encoding_'
            object_data_vaccine_metric.accumulated_length = l_data.length; // retrieve the length of concatanated virus proteins
        }
        object_data_vaccine_metric.seq_consensus_concatenated = unpack( arr_data_acc_virus_representative, 'seq_consensus' ).join( '' ); // retrieve concatanated consensus_sequence of virus proteins
        let l_name_data = Object.keys( object_data_vaccine_metric.dict_data ); // retrieve list of data tracks
        object_data_vaccine_metric.l_name_data = l_name_data;
        let dict_name_data_to_index = { }, dict_name_data_to_color = { }; // map name_data to index and set colors
        for ( let i = 0; i < l_name_data.length; i ++ ) { 
            let name_data = l_name_data[ i ], color = '#A9A9A9'; // set default color  //'DarkGray'
            dict_name_data_to_index[ name_data ] = i;
            if ( name_data.includes( "count_non_consensus_residue" ) ) { color = "#0000FF"; // "Blue";
            } else if ( name_data.includes( "count_peptide_binding_common_mhc_i_alleles" ) ) { color = "#B22222"; // "FireBrick";
            } else if ( name_data.includes( "count_peptide_binding_common_mhc_ii_alleles" ) ) { color = "#228B22"; // "ForestGreen";
            } else {
                switch( name_data ) {
                    case "avg_processing_score_mhc_i": color = "#F08080"; break; // "LightCoral"
                    case "score_linear_bcell_epitope_prediction__bepipred": color = "#90EE90"; break; // "LightGreen"
                    case "count_iedb_epitope_with_tcell_assay": color = "#DC143C"; break; // "Crimson"
                    case "count_iedb_epitope_with_bcell_assay": color = "#7FFF00"; break; // "Chartreuse"
                    case "relative_accessible_surface_area": color = "#949494"; // grey
                }
            }
            dict_name_data_to_color[ name_data ] = color;
        }
        object_data_vaccine_metric.dict_name_data_to_index = dict_name_data_to_index;
        object_data_vaccine_metric.dict_name_data_to_color = dict_name_data_to_color; // set trace color for each name_data
            // add dictionary mapping accumulated coordinates to protein and coordinate in individual protein
        object_data_vaccine_metric.dict_accumulated_coord_to_individual_coord = { }, object_data_vaccine_metric.dict_accumulated_coord_to_acc_rep = { };
        for ( let i = 0; i < arr_data_acc_virus_representative.length; i ++ ) { 
            let protein = arr_data_acc_virus_representative[ i ], accumulated_start = protein.accumulated_start_skipping_orf1a__for_web_application;
            for ( let j = 0; j < protein.length; j ++ ) { // 0-based coordinates
                object_data_vaccine_metric.dict_accumulated_coord_to_individual_coord[ accumulated_start + j ] = j;
                object_data_vaccine_metric.dict_accumulated_coord_to_acc_rep[ accumulated_start + j ] = i;
            }
        }
            // retrieve traces of vaccine metrics
        VaccineMetrics_Update_Visibility( ) // update visibility from current settings
        let visibility_for_each_trace = object_data_vaccine_metric.visibility_for_each_trace, n_residues = object_data_vaccine_metric.accumulated_length; // set visibility of each trace based on the given settings 
        let trace_vaccine_metric_lower_bound = { x : [ 0, n_residues ], y : [ -3, -3 ], type : "scattergl", mode : 'lines', line : { color: '#000000', width: 1 }, showlegend : false, name: "vaccine_metric__lower_bound" }, trace_vaccine_metric_upper_bound = { x : [ 0, n_residues ], y : [ -1, -1 ], type : "scattergl", mode : 'lines', line : { color: '#000000', width: 1 }, showlegend : false, name: "vaccine_metric__upper_bound" };
        object_data_vaccine_metric.data = [ trace_vaccine_metric_lower_bound, trace_vaccine_metric_upper_bound ];  // traces for boundary of vaccine design traces
        let x = nj.arange( n_residues ).tolist( ) // 0-based coordinates
        for ( let i = 0; i < l_name_data.length; i ++ ) {
            let trace = { }, name_data = l_name_data[ i ];
            let l_data = object_data_vaccine_metric.dict_data[ name_data ]; 
            if ( name_data.includes( "count_non_consensus_residue" ) ) { l_data = ArrayCap( l_data, 50 ); } // cap 'count_non_consensus_residue' with a threshold 50 
            let arr_value = nj.array( l_data ); // numjs array of data values
            trace.name = name_data;
            trace.x = x;
            trace.y = arr_value.divide( arr_value.max( ) / 2 ).subtract( 3 ).tolist( ); // vaccine metric traces at ( - 1, -3  )
            trace.customdata = ArrayTranspose( [ ArrayApply( object_data_vaccine_metric.dict_data[ name_data ], String ), nj.array( ArrayMap( x, object_data_vaccine_metric.dict_accumulated_coord_to_individual_coord ) ).add( 1 ).tolist( ), ArrayApply( x, function( x ) { return arr_data_acc_virus_representative[ object_data_vaccine_metric.dict_accumulated_coord_to_acc_rep[ x ] ].name; } ) ] ); // display actual values on hover
            trace.mode = 'lines';
            trace.type = 'scattergl';
            trace.showlegend = false;
            trace.visible = visibility_for_each_trace[ i ]; // set visibility of traces
            trace.line = { color: object_data_vaccine_metric.dict_name_data_to_color[ name_data ], width: 1 } // set color of traces
            trace.hovertemplate = name_data + ":<br><b>%{customdata[0]}</b><br>at %{customdata[1]:.0f}-th residue of <b>%{customdata[2]}</b><br><extra></extra>"; // set hovertemplate
            object_data_vaccine_metric.data.push( trace );
        }
        // retrieve traces of virus protein annotations
        object_annotation_representative_virus_protein.data = [ ];
        object_annotation_representative_virus_protein.show = document.getElementById( "checkbox_toggle_VirusProteinAnnotation_MolecularMimicryMap" ).checked; // set visibility of SARS-CoV-2 proteins
        for ( let i = 0; i < arr_data_acc_virus_representative.length; i ++ ) {
            let protein = arr_data_acc_virus_representative[ i ], pos_y = ( i % 2 - 1 ) / 4 - 0.15;
            object_annotation_representative_virus_protein.data.push( { x: [ protein.accumulated_start_skipping_orf1a__for_web_application, protein.accumulated_start_skipping_orf1a__for_web_application + protein.length - 1 ], y: [ pos_y, pos_y ], name: protein.name + "_Anno_Base", mode: "lines", type: "scatter", opacity: 1, showlegend: false, line: { width: 10, color: "#a3a3a3" }, visible: object_annotation_representative_virus_protein.show } ); } // 1-based coordinate
        // retrieve a trace of concatanated consensus virus protein sequence
        object_data_consensus_sequence_virus.data = [ { type: 'scattergl', mode: "text", x: x, y: ArrayFull( n_residues, - 0.75 ), text: object_data_vaccine_metric.seq_consensus_concatenated.split( "" ), textfont: { size: 15 }, hoverinfo: "x", hovertemplate: "<br><extra></extra>", showlegend: false, name: "concatanated_consensus_protein_sequence_virus" } ] // display only x position of residues // no hover info
        // retrieve traces of virus protein domain annotations
        object_data_interpro_virus.show = document.getElementById( "checkbox_toggle_VirusProteinAnnotation_MolecularMimicryMap" ).checked; // set visibility of SARS-CoV-2 proteins
        object_data_interpro_virus.dict_data = Unpack_array_to_dict_data( arr_data_interpro_virus, Object.keys( arr_data_interpro_virus[ 0 ] ) );
        object_data_interpro_virus.dict_data[ "protein_name" ] = ArrayApply( object_data_interpro_virus.dict_data[ "accession_representative" ], function( acc_rep ) { return arr_data_acc_virus_representative[ acc_rep ].name; } );
        object_data_interpro_virus.data = [ ];
        object_data_interpro_virus.dict_color = { P: "#1f1994", G: "#08750a", S: "#781387", c: "#798514" };
        for ( let i = 0; i < arr_data_interpro_virus.length; i ++ ) {
            let step = 10;
            let domain = arr_data_interpro_virus[ i ], protein = arr_data_acc_virus_representative[ domain.accession_representative ], pos_y = ( domain.accession_representative % 2 - 1 ) / 4 - 0.15, str_len_protein = String( protein.length ), str_domain_start = String( domain.start ), str_domain_end = String( domain.end ), customdata = [ protein.name, str_len_protein, domain.interpro_name, domain.interpro_acc, domain.annotation_acc, str_domain_start, str_domain_end ], len_domain = domain.end_accumulated - domain.start_accumulated, trace = { name: domain.interpro_name + "__InterPro", mode: "lines", type: "scatter", opacity: 0.2, showlegend: false, line: { width: 15, color: object_data_interpro_virus.dict_color[ domain.annotation_acc.slice( 0, 1 ) ] }, visible: object_data_interpro_virus.show, hovertemplate: "InterPro Domain: <b>%{customdata[2]}</b> (%{customdata[3]})<br>Protein: <b>%{customdata[0]}</b> (from %{customdata[5]} to %{customdata[6]})<br>Database accession: %{customdata[4]}<br><extra></extra>", customdata: [ ], x: [ ], y: [ ] };
            for ( let j = 0; j <= len_domain / step + 1; j ++ ) { // for each domain, plot point every 10 residues for displaying information through hover
                trace.customdata.push( customdata );
                trace.y.push( pos_y );
                let x = domain.start_accumulated + j * step;
                trace.x.push( x > domain.end_accumulated ? domain.end_accumulated : x )
            }
            object_data_interpro_virus.data.push( trace );
        }
        // retrieve a trace IEDB epitope records of virus proteins
        object_data_iedb_epitope_virus.show = document.getElementById( "checkbox_toggle_iedb_epitope_virus_MolecularMimicryMap" ).checked; // set visibility of IEDB epitopes of SARS-CoV-2
        let dict_data = Unpack_array_to_dict_data( arr_data_iedb_epitope_virus, Object.keys( arr_data_iedb_epitope_virus[ 0 ] ) )
        let l_start = nj.array( dict_data[ "start_accumulated" ] ).subtract( 1 ).tolist( ), l_end = dict_data[ "end_accumulated" ]; // dataframe contains 1-based coordinates
        dict_data[ "start" ] = nj.array( ArrayMap( l_start, object_data_vaccine_metric.dict_accumulated_coord_to_individual_coord ) ).add( 1 ).tolist( ); // 1-based coordinates
        dict_data[ "end" ] = ArrayMap( l_end, object_data_vaccine_metric.dict_accumulated_coord_to_individual_coord );
        dict_data[ "protein_name" ] = ArrayApply( dict_data[ "accession_representative" ], acc => arr_data_acc_virus_representative[ acc ].name );
        object_data_iedb_epitope_virus.dict_data = dict_data;
        object_data_iedb_epitope_virus.l_error_x = nj.array( l_end ).subtract( l_start ).divide( 2 ).tolist( );
        let arr_y = nj.array( ArrayCap( nj.array( dict_data[ "number_of_positive_B_cell_assay" ] ).add( dict_data[ "number_of_positive_T_cell_assay" ] ).multiply( dict_data[ "percent_identity" ] ).divide( 100 ).tolist( ), 5 ) ); // retrieve combined score for IEDB epitopes (y-axis)
        object_data_iedb_epitope_virus.l_x = nj.array( l_start ).add( l_end ).divide( 2 ).tolist( ), object_data_iedb_epitope_virus.l_y = arr_y.divide( arr_y.max( ) / 0.75 ).subtract( 3.95 ).tolist( );
        object_data_iedb_epitope_virus.customdata = ArrayTranspose( [ dict_data[ "accession_iedb" ], 
                                                                      dict_data[ "number_of_positive_B_cell_assay" ], 
                                                                      dict_data[ "number_of_positive_T_cell_assay" ], 
                                                                      dict_data[ "start" ],
                                                                      dict_data[ "end" ],
                                                                      dict_data[ "protein_name" ], // 5
                                                                      dict_data[ "iedb_epitope_sequence" ],
                                                                      dict_data[ "percent_identity" ], 
                                                                      dict_data[ "mismatch" ],
                                                                      dict_data[ "gapopen" ] ] ); // 9
        object_data_iedb_epitope_virus.hovertemplate = ["IEDB Epitope #%{customdata[0]:.0f}",
                                                        "        seq: %{customdata[6]}",
                                                        "<b>%{customdata[5]}</b> from <b>%{customdata[3]:.0f}</b> to <b>%{customdata[4]:.0f}</b>",
                                                        "(%{customdata[7]:.0f}% identical, %{customdata[8]:.0f} mismatch, %{customdata[9]:.0f} gaps)",
                                                        "",
                                                        "number of positive B-cell assays: <b>%{customdata[1]:.0f}</b>",
                                                        "number of positive T-cell assays: <b>%{customdata[2]:.0f}</b>",
                                                        "<extra></extra>" ].join( "<br>" );
        let l_b_cell_assay_count = dict_data[ "number_of_positive_B_cell_assay" ], l_t_cell_assay_count = dict_data[ "number_of_positive_T_cell_assay" ], l_bool_flag_b_cell_epitope = [ ]; // retrieve mask for IEDB epitopes with b-cell assay count larger than t-cell assay count
        for ( let i = 0; i < l_b_cell_assay_count.length; i ++ ) { l_bool_flag_b_cell_epitope.push( l_b_cell_assay_count[ i ] >= l_t_cell_assay_count[ i ] ); }
        object_data_iedb_epitope_virus.l_bool_flag_b_cell_epitope = l_bool_flag_b_cell_epitope;
        object_data_iedb_epitope_virus.l_bool_flag_t_cell_epitope = ArrayBoolNOT( l_bool_flag_b_cell_epitope );

        let trace_iedb_epitope_b_cell_assay = { visible: object_data_iedb_epitope_virus.show, name: "IEDB_Epitopes__Positive_B_Cell_Assays", x: ArrayBooleanIndexing( object_data_iedb_epitope_virus.l_x, object_data_iedb_epitope_virus.l_bool_flag_b_cell_epitope ), y: ArrayBooleanIndexing( object_data_iedb_epitope_virus.l_y, object_data_iedb_epitope_virus.l_bool_flag_b_cell_epitope ), type: 'scattergl', mode: "markers", error_x: { type: 'data', array: ArrayBooleanIndexing( object_data_iedb_epitope_virus.l_error_x, object_data_iedb_epitope_virus.l_bool_flag_b_cell_epitope ), visible: true, width: 0, thickness: 1 }, customdata: ArrayBooleanIndexing( object_data_iedb_epitope_virus.customdata, object_data_iedb_epitope_virus.l_bool_flag_b_cell_epitope ), hovertemplate: object_data_iedb_epitope_virus.hovertemplate, showlegend: false, marker: { symbol: "star-open", size: 10, opacity: 0.5, line: { width: 2 }, color: "#00ff08" } };
        let trace_iedb_epitope_t_cell_assay = { visible: object_data_iedb_epitope_virus.show, name: "IEDB_Epitopes__Positive_T_Cell_Assays", x: ArrayBooleanIndexing( object_data_iedb_epitope_virus.l_x, object_data_iedb_epitope_virus.l_bool_flag_t_cell_epitope ), y: ArrayBooleanIndexing( object_data_iedb_epitope_virus.l_y, object_data_iedb_epitope_virus.l_bool_flag_t_cell_epitope ), type: 'scattergl', mode: "markers", error_x: { type: 'data', array: ArrayBooleanIndexing( object_data_iedb_epitope_virus.l_error_x, object_data_iedb_epitope_virus.l_bool_flag_t_cell_epitope ), visible: true, width: 0, thickness: 1 }, customdata: ArrayBooleanIndexing( object_data_iedb_epitope_virus.customdata, object_data_iedb_epitope_virus.l_bool_flag_t_cell_epitope ), hovertemplate: object_data_iedb_epitope_virus.hovertemplate, showlegend: false, marker: { symbol: "star-open", size: 10, opacity: 0.5, line: { width: 2 }, color: "#f003fc" } };
        let trace_iedb_epitope_virus_lower_bound = { x : [ 0, n_residues ], y : [ -3.01, -3.01 ], type : "scattergl", mode : 'lines', line : { color: '#000000', width: 1 }, showlegend : false, name: "iedb_epitope_virus__lower_bound" }, trace_iedb_epitope_virus_upper_bound = { x : [ 0, n_residues ], y : [ -4, -4 ], type : "scattergl", mode : 'lines', line : { color: '#000000', width: 1 }, showlegend : false, name: "iedb_epitope_virus__upper_bound" };
        object_data_iedb_epitope_virus.data = [ trace_iedb_epitope_virus_lower_bound, trace_iedb_epitope_virus_upper_bound , trace_iedb_epitope_b_cell_assay, trace_iedb_epitope_t_cell_assay ];

        l_colormap_rainbow_acc_human = ColorMap_Rainbow( arr_data_acc_human.length ); // build a colormap for representing accessions of human proteins
        for ( let i = 0; i < arr_data_blosum62.length; i ++ ) { dict_blosum62[ arr_data_blosum62[ i ].pair_of_amino_acids ] = arr_data_blosum62[ i ].score_blosum62; } // parse 'arr_data_blosum62' and build blosum62 matrix
        dictionary_acc_human_to_integer_index = Index_list_with_dictionary( unpack( arr_data_acc_human, 'value' ) ); // build indices for datatables
        return new Promise( async function( resolve, reject ) { 
            await DrawMolecularMimicryMap( );
            Display_DataTable( );
            console.log( "[ParseData] resolved" );
            Loading_Screen( false );
            resolve( "[ParseData] resolved" );
        });
    }
    
    var object_datatable_acc_human = [ ], df_datatable = null; // objects containing 2D-array for drawing datatable
    function Display_DataTable( ) { // load datatable with loaded datasets
        let name_data = document.getElementById( "select_datatable" ).value, columns = [ ], dataSet = [ ], df = null, l_col = [ ];
        console.log( "Loading datatable", name_data );
        if ( name_data == "acc_human.tsv" ) { // retrieve appropriate dataframe for each setting
            df = new DataFrame( arr_data_acc_human );
            df = df.select( "value", "n_counts", "seq_length", "description", "IEDB___n_unique_epitopes", "AAgAtlas___n_PubMed_ID" );
        } else if ( name_data == "acc_virus_representative.tsv" ) {
            df = new DataFrame( arr_data_acc_virus_representative );
            df = df.select( "name", "accession", "uniprot_acc", "length", "n_non_redundant_proteins" );
        } else if ( name_data == "mhc_allele.tsv" ) {
            df = new DataFrame( arr_data_mhc_allele );
        } else if ( name_data == "interpro_virus.tsv" ) {
            df = new DataFrame( object_data_interpro_virus.dict_data )
            df = df.select( "protein_name", "start", "end", "interpro_acc", "interpro_name", "annotation_acc" );
        } else if ( name_data == "iedb_epitope_virus.tsv" ) {
            df = new DataFrame( object_data_iedb_epitope_virus.dict_data )
            df = df.select( "accession_iedb", "iedb_epitope_sequence", "number_of_positive_B_cell_assay", "number_of_positive_T_cell_assay", "protein_name", "start", "end", "percent_identity", "mismatch", "gapopen" );
        } 
        df_datatable = df;
        dataSet = df_datatable.toArray( ), l_col = df_datatable.listColumns( );
        for ( let i = 0; i < l_col.length; i ++ ) { columns.push( { title: l_col[ i ] } ); }

        $( '#container_datatable_MolecularMimicryMap' ).empty( ); // empty the datatable and redraw the datatable
        $( '#container_datatable_MolecularMimicryMap' ).append( '<table id="datatable_MolecularMimicryMap" class="display" width="100%"></table>' );
        $( '#datatable_MolecularMimicryMap' ).DataTable( { data: dataSet, columns: columns } ); // display the datatable
    }
    var string_csv_datatable = "";
    function Download_DataTable( ) { // download analysis result of vaccine candidate as a csv file
        if ( df_datatable != null ) {
            string_csv_datatable = df_datatable.toCSV( true );
        }
        let blob = new Blob( [ string_csv_datatable ], { type: "text/plain;charset=utf-8" } );
        let name_file = document.getElementById( "select_datatable" ).value // retrieve the name of the current data
        name_file = name_file.slice( 0, name_file.lastIndexOf( '.' ) ) + '_MolecularMimicryMap_of_SARS-CoV-2_datatable.csv' // change the extension of the filename
        saveAs( blob, name_file ); // save file 
    }
    
    var l_a = [ ];
    var l_b = [ ], l_xy = [ ];
    // settings for Plotly plots
    var float_line_type_opacity_MolecularMimicryMap_BCellCrossReactivity = 0.5, float_opacity_MolecularMimicryMap_TCellCrossReactivity = 0.5;
    // plot Plotly plots
    var dict_name_plot_to_trace_index__MolecularMimicryMap = { }; // dictionary mapping name of plot to trace index
    var object_plot_BCellCrossReactivity = { }, object_plot_TCellCrossReactivity = { };
    var arr_data_BCellCrossReactivity = [ ], arr_data_TCellCrossReactivity = [ ]; // lists containing data of currently plotted B/TCellCrossReactivity records
    var trace_point_type_MolecularMimicryMap_BCellCrossReactivity = { mode: 'markers', marker: { line: { } }, showlegend: false }, data_line_type_MolecularMimicryMap_BCellCrossReactivity = [ ], trace_point_type_MolecularMimicryMap_TCellCrossReactivity_human = { mode: 'markers', marker: { line: { } }, showlegend: false }, trace_point_type_MolecularMimicryMap_TCellCrossReactivity_virus = { mode: 'markers', marker: { line: { } }, showlegend: false }, trace_BCellCrossReactivityMetrics = { type: 'parcoords', line: { color: "#aa00ff" }, dimensions: [ ] }, trace_TCellCrossReactivityMetrics = { type: 'parcoords', line: { color: '#aa00ff' }, dimensions: [ ] };
    // graph setting from graph setting panel
    var plotly_type_BCellCrossReactivity = 'scattergl', plotly_type_TCellCrossReactivity = 'scattergl', int_index_representation_TCellCrossReactivity = 1, int_index_MHC_class_TCellCrossReactivity = 3; 
    // variables for interactions
    var clicked_record = { }, clicked_record_parsed = { }, arr_data_clicked = [ ], trace_tableSequence = { };
    // general Plotly settings
    var config = { responsive: true, displaylogo: false } // flexible plot width according to the window size  // do not display plotly logo
    let config_MolecularMimicryMap = Object.assign( { toImageButtonOptions: { hoverClosestCartesian: true, format: 'svg', filename: 'MolecularMimicryMap_of_SARS-CoV-2', height: 750, width: 1100, scale: 1 }, modeBarButtonsToRemove: [ 'autoScale2d', 'toggleSpikelines', 'hoverCompareCartesian', 'hoverClosestCartesian' ] }, config ), layout_MolecularMimicryMap = { margin: { l: 40, r: 15, b: 10, t: 0, pad: 4 }, xaxis: { rangeslider: { borderwidth : 1, range : [ 0, object_data_vaccine_metric.accumulated_length ], thickness : 0.07 }, zeroline: false }, yaxis: { fixedrange: true, zeroline: false, tickmode: "array", tickvals: [ 0, 2, 4, 6, 8, 10 ], ticktext: ArrayApply( [ 0, 2, 4, 6, 8, 10 ], String ) }, hovermode: "closest", hoverlabel: { bgcolor: "#ffffff", bordercolor: "#521a87" }, legend: { itemclick: false, itemdoubleclick: false } }; // title: 'Molecular Mimicry Map of SARS-CoV-2', // disable toggling of traces when clickng legends // do hot show y-tickes below 0
    let layout_PredictionMetrics = { margin: { l: 50, r: 65, b: 50, t: 50, pad: 4 } }, layout_tableSequence = { margin: { l: 50, r: 65, b: 5, t: 5, pad: 4 } };
    // virus protein annotation
    var object_annotation_representative_virus_protein = { show: true, data: [ ] }, n_representative_virus_proteins = 11; // number of representative virus proteins
    // for visualizing protein structures
    var object_pdb_human = { }, object_pdb_virus = { }, object_data_tableSequence = { };
    var option_initialization_molstar = { customData: { url: "https://raw.githubusercontent.com/ahs2202/3M/master/current/custom_cif/dummy.cif", format: 'cif', binary: false }, landscape: true, bgColor: {r:0,g:0,b:0}, hideControls: true }; // default option for Mol* when not displaying molecules
    var l_selectSections_PDB_Virus_Protein = [ ], flag_select_PDB_Virus_Protein = true, flag_focus_PDB_Virus_Protein = false, l_selectSections_PDB_Human_Protein = [ ], flag_select_PDB_Human_Protein = true, flag_focus_PDB_Human_Protein = false; // flags for interaction with Mol* viewer
    // for highlighting specific entries
    // object for saving layout data
    var object_plot_MolecularMimicryMap = { hovermode: "closest", layout: {} };
    // for loading data from remote location
    // "Record Details" table styles settings
    var style_font_table_record_details = "font-family:Arial", int_n_residues_per_window_table_sequence = 20; // 'int_n_residues_per_window_table_sequence' number of residues per sequence in the table_sequence plot
    async function LoadRemoteData_BasedOnSettings( ) {
        object_plot_BCellCrossReactivity.n_records_from_setting = parseInt( document.getElementById( "input_n_alignments_for_plotting_BCellCrossReactivity" ).value );
        object_plot_TCellCrossReactivity.n_records_from_setting = parseInt( document.getElementById( "input_n_alignments_for_plotting_TCellCrossReactivity" ).value );
        object_plot_BCellCrossReactivity.window_size = document.getElementById( "select_windowSize_BCellCrossReactivity" ).value;
        object_plot_BCellCrossReactivity.redundancy_level = document.getElementById( "select_redundancy_level_BCellCrossReactivity" ).value;
        object_plot_TCellCrossReactivity.redundancy_level = document.getElementById( "select_redundancy_level_TCellCrossReactivity" ).value;
        object_plot_BCellCrossReactivity.n_records_max = object_data_remote_file.dict_bcell_crossreactivity_data_to_n_records[ object_plot_BCellCrossReactivity.redundancy_level ][ object_plot_BCellCrossReactivity.window_size ];
        object_plot_TCellCrossReactivity.n_records_max = object_data_remote_file.dict_tcell_crossreactivity_data_to_n_records[ object_plot_TCellCrossReactivity.redundancy_level ];
        object_plot_BCellCrossReactivity.n_records_of_remote_file = 1000; // default is the smallest n_records
        object_plot_TCellCrossReactivity.n_records_of_remote_file = 1000; // default is the smallest n_records
        
        if ( object_plot_BCellCrossReactivity.n_records_from_setting >= object_plot_BCellCrossReactivity.n_records_max ) {
            object_plot_BCellCrossReactivity.n_records_of_remote_file = object_plot_BCellCrossReactivity.n_records_max;
        } else {
            for ( let i = 1; i < object_data_remote_file.l_n_records_for_each_step.length; i ++ ) {
                if ( object_plot_BCellCrossReactivity.n_records_from_setting < object_data_remote_file.l_n_records_for_each_step[ i ] ) { break; }
                object_plot_BCellCrossReactivity.n_records_of_remote_file = object_data_remote_file.l_n_records_for_each_step[ i ];
            }
        }
        if ( object_plot_TCellCrossReactivity.n_records_from_setting >= object_plot_TCellCrossReactivity.n_records_max ) {
            object_plot_TCellCrossReactivity.n_records_of_remote_file = object_plot_TCellCrossReactivity.n_records_max;
        } else {
            for ( let i = 1; i < object_data_remote_file.l_n_records_for_each_step.length; i ++ ) {
                if ( object_plot_TCellCrossReactivity.n_records_from_setting < object_data_remote_file.l_n_records_for_each_step[ i ] ) { break; }
                object_plot_TCellCrossReactivity.n_records_of_remote_file = object_data_remote_file.l_n_records_for_each_step[ i ];
            }
        }
        gtag( 'event', 'loading_remote_data', { t_cell_n_records : object_plot_TCellCrossReactivity.n_records_from_setting, b_cell_n_records : object_plot_BCellCrossReactivity.n_records_from_setting, b_cell_window_size = object_plot_BCellCrossReactivity.window_size, t_cell_redundancy_level = object_plot_BCellCrossReactivity.redundancy_level, t_cell_redundancy_level = object_plot_TCellCrossReactivity.redundancy_level } ); // [Google Analytics] record which remote data is being downloaded to improve statistics
        // retrieve file names appropriate for current setting
        object_plot_BCellCrossReactivity.name_file = "BCellCrossReactivity." + object_plot_BCellCrossReactivity.redundancy_level + ".windowSize_" + object_plot_BCellCrossReactivity.window_size + ".top_" + String( object_plot_BCellCrossReactivity.n_records_of_remote_file ) + ".tsv"
        object_plot_TCellCrossReactivity.name_file = "TCellCrossReactivity." + object_plot_TCellCrossReactivity.redundancy_level + ".top_" + String( object_plot_TCellCrossReactivity.n_records_of_remote_file ) + ".tsv"
        
        let l_file = [ ]; // retrieve a list of files for downloading
        if ( ! ( object_plot_BCellCrossReactivity.name_file in dict_filename_to_parsed_data ) ) { l_file.push( object_data_remote_file.base_url + object_plot_BCellCrossReactivity.name_file ); }
        if ( ! ( object_plot_TCellCrossReactivity.name_file in dict_filename_to_parsed_data ) ) { l_file.push( object_data_remote_file.base_url + object_plot_TCellCrossReactivity.name_file ); }

        if ( l_file.length == 0 ) { console.log( "both file already exists" ); return; } // if both files already exists do not download any data
        
        return new Promise( async function( resolve, reject ) { // return a promis for downloading file
            console.log( "[LoadRemoteData_BasedOnSettings] parsing started:", dict_filename_to_parsed_data );
            let l_promise = l_file.map( function( file ) { 
                return new Promise ( function( resolve, reject ) {
                    Papa.parse( file, { download: true, header: true, skipEmptyLines: false, delimiter: '\t', dynamicTyping: true, complete: function( results ) { resolve( results.data.slice( 0, results.data.length - 1 ) ) }, error: reject } ); }); }); // 'skipEmptyLines' is set to false to allow reading empty lines in some input files // due to 'skipEmptyLines: false' option, the last line is empty, and should be discarded
            let results = await Promise.all( l_promise ) // wait until all the files have been loaded
            l_parsed_data = [ ]; // empty a list
            l_parsed_data.push( ... results );
            for ( let i = 0; i < l_file.length; i ++ ) { 
                let url_file = l_file[ i ], name_file = url_file.slice( url_file.lastIndexOf( "/" ) + 1 )
                dict_filename_to_parsed_data[ name_file ] = l_parsed_data[ i ];
            } 
            console.log( "[LoadRemoteData_BasedOnSettings] parsing completed:", dict_filename_to_parsed_data );
            resolve( "completed" );
        });
    }
    function Open_and_Draw_BCellCrossReactivityPredMetricsPlot( ) {
        str_jquery_container = "#plotly_graph_b_cell_cross_reactivity";
        if ( $( str_jquery_container ).hasClass( "collapse" ) && $( str_jquery_container ).hasClass( "show" ) ) { DrawBCellCrossReactivityPredMetricsPlot( ); // draw Plotly plot synchronously if the container is currently shown
        } else { BootstrapCollapseShownPromise( str_jquery_container ).then( ( ) => { DrawBCellCrossReactivityPredMetricsPlot( ); $('#plotly_graph_b_cell_cross_reactivity').collapse( 'hide' ); } ); } // draw Plotly plot once the container is shown if the container is currently hidden
    }        
    function DrawBCellCrossReactivityPredMetricsPlot( ) {
        // reset selection
        let l_index_traces_selected = [ ], l_index_traces_not_selected = [ ];
        if ( object_plot_BCellCrossReactivity.flag_bool_mode_is_lines ) { // restyle plot according to the type of BcellCrossReactivity data
            for ( let i = object_plot_BCellCrossReactivity.index_trace_start; i < object_plot_BCellCrossReactivity.index_trace_end; i ++ ) { if ( plotMolecularMimicryMap.data[ i ].visible == false ) { l_index_traces_selected.push( i ); } } // if previously not selected and hidden, show the record
            if ( l_index_traces_selected.length > 0 ) { Plotly.restyle( plotMolecularMimicryMap, { visible: true }, l_index_traces_selected ); } // show all records
        } else {
            Plotly.restyle( plotMolecularMimicryMap, { marker: { opacity: object_plot_BCellCrossReactivity.l_opacity, size: trace_point_type_MolecularMimicryMap_BCellCrossReactivity.marker.size, color: trace_point_type_MolecularMimicryMap_BCellCrossReactivity.marker.color, line: { width: 0 } }, error_x: { type: 'data', array: object_plot_BCellCrossReactivity.l_error_x, visible: true, width: 0, thickness: 1 } }, object_plot_BCellCrossReactivity.index_trace_start ) // reset selection of BCellCrossReactivity records on the plot
        }
        // prepare data
        let l_option = document.getElementById( "selectmultiple_BCellCrossReactivityMetrics" ).options, l_col = [ ], l_label = [ ];
        for ( let i = 0; i < l_option.length; i ++ ) {
            let option = l_option[ i ];
            if ( option.selected ) { l_col.push( option.value ); l_label.push( option.text ); } // retrieve column name and label for each selected column
        }
        trace_BCellCrossReactivityMetrics.dimensions = [ ]; // initialize metrics data
        for ( let i = 0; i < l_col.length; i ++ ) {
            let col = l_col[ i ], label = l_label[ i ];
            let l = col in object_plot_BCellCrossReactivity.metrics ? object_plot_BCellCrossReactivity.metrics[ col ] : unpack( arr_data_BCellCrossReactivity, col );
            trace_BCellCrossReactivityMetrics.dimensions.push( { values: l, label: label } );
        }
        Plotly.newPlot( plotBCellCrossReactivityMetrics, [ lodash.cloneDeep( trace_BCellCrossReactivityMetrics ) ], layout_PredictionMetrics, config );
        // Add Plotly interactions // Selection event through a plot containing metrics (parallel coordinate plots) (BCellCrossReactivity prediction data)
        object_plot_BCellCrossReactivity.l_mask = [ ]; // initialize list of masks
        for ( let i = 0; i < trace_BCellCrossReactivityMetrics.dimensions.length; i ++ ) { object_plot_BCellCrossReactivity.l_mask.push( ArrayFull( object_plot_BCellCrossReactivity.n_records, true ) ); } // initialize masks used for retrieving selected entries
        plotBCellCrossReactivityMetrics.on( 'plotly_restyle', function( eventData ) { // update trace_MolecularMimicryMap_BCellCrossReactivity based on selection in trace_BCellCrossReactivityMetrics
            let str_name_key = Object.keys( eventData[ 0 ] )[ 0 ];
            if ( str_name_key.includes( "constraintrange" ) ) { // when entries are selected or deselected (ignore event where fields are rearranged and no selection or deselection occurred)
                let index_field = parseInt( str_name_key.split( "].constraintrange" )[ 0 ].split( "dimensions[" )[ 1 ] ); // extract the index of field from the name of the key 
                let l_selectedRange = eventData[ 0 ][ str_name_key ];
                if ( l_selectedRange == null ) { // if all range of the current field is selected
                    object_plot_BCellCrossReactivity.l_mask[ index_field ] = ArrayFull( object_plot_BCellCrossReactivity.n_records, true ); // reset selection
                } else {
                    let l_mask_for_each_selectedRange = [ ]; // overlap mask for each selected ranges
                    for ( let i = 0; i < l_selectedRange.length; i++ ) { // for each selectedRange
                        let selectedRange = l_selectedRange[ i ].sort( SortFloat );
                        let l_data = trace_BCellCrossReactivityMetrics.dimensions[ index_field ].values;
                        l_mask_for_each_selectedRange.push( ArrayBoolAND( [ ArrayGreaterThan( l_data, selectedRange[ 0 ] ), ArrayLessThan( l_data, selectedRange[ 1 ] ) ] ) );
                    }
                    object_plot_BCellCrossReactivity.l_mask[ index_field ] = ArrayBoolOR( l_mask_for_each_selectedRange ); // update mask with the currently selected range
                }
                object_plot_BCellCrossReactivity.mask_selected = ArrayBoolAND( object_plot_BCellCrossReactivity.l_mask ); // retrieve a mask for the selected records
                object_plot_BCellCrossReactivity.selection = { }; // object for storing data related to selected records
                let mask_not_selected = ArrayBoolNOT( object_plot_BCellCrossReactivity.mask_selected );
                object_plot_BCellCrossReactivity.selection.l_opacity = ArrayBroadCasting( object_plot_BCellCrossReactivity.l_opacity, mask_not_selected, 0 ); // retrieve modified opacity values of records
                object_plot_BCellCrossReactivity.selection.l_error_x = ArrayBroadCasting( object_plot_BCellCrossReactivity.l_error_x, mask_not_selected, 0 ); // retrieve modified error_x values of records
                if ( object_plot_BCellCrossReactivity.flag_bool_mode_is_lines ) { // restyle plot according to the type of BcellCrossReactivity data
                    l_index_traces_selected = [ ], l_index_traces_not_selected = [ ]; // retrieve trace indices that are newly selected or deselected
                    for ( let i = object_plot_BCellCrossReactivity.index_trace_start; i < object_plot_BCellCrossReactivity.index_trace_end; i ++ ) { 
                        if ( object_plot_BCellCrossReactivity.mask_selected[ i ] && plotMolecularMimicryMap.data[ i ].visible == false ) { l_index_traces_selected.push( i ); } // if previously not selected but currently selected 
                        else if ( ! ( object_plot_BCellCrossReactivity.mask_selected[ i ] ) && plotMolecularMimicryMap.data[ i ].visible == true ) { l_index_traces_not_selected.push( i ); } // if previously selected but currently not selected 
                    }
                    if ( l_index_traces_selected.length > 0 ) { Plotly.restyle( plotMolecularMimicryMap, { visible: true }, l_index_traces_selected ); } // show selected records
                    if ( l_index_traces_not_selected.length > 0 ) { Plotly.restyle( plotMolecularMimicryMap, { visible: false }, l_index_traces_not_selected ); } // hide non-selected records
                } else {
                    Plotly.restyle( plotMolecularMimicryMap, { marker: { opacity: object_plot_BCellCrossReactivity.selection.l_opacity, size: trace_point_type_MolecularMimicryMap_BCellCrossReactivity.marker.size, color: trace_point_type_MolecularMimicryMap_BCellCrossReactivity.marker.color, line: { width: 0 } }, error_x: { type: 'data', array: object_plot_BCellCrossReactivity.selection.l_error_x, visible: true, width: 0, thickness: 1 } }, object_plot_BCellCrossReactivity.index_trace_start ) // set opacity of markers not selected in the metric plot 0
                }
            }
        });
    }
    function Open_and_Draw_TCellCrossReactivityPredMetricsPlot( ) {
        str_jquery_container = "#plotly_graph_t_cell_cross_reactivity";
        if ( $( str_jquery_container ).hasClass( "collapse" ) && $( str_jquery_container ).hasClass( "show" ) ) { DrawTCellCrossReactivityPredMetricsPlot( ); // draw Plotly plot synchronously if the container is currently shown
        } else { BootstrapCollapseShownPromise( str_jquery_container ).then( ( ) => { DrawTCellCrossReactivityPredMetricsPlot( ); $('#plotly_graph_b_cell_cross_reactivity').collapse( 'hide' ); } ); } // draw Plotly plot once the container is shown if the container is currently hidden
    }        
    function DrawTCellCrossReactivityPredMetricsPlot( ) {
        // reset selection
        let update_human = { marker: { opacity: float_opacity_MolecularMimicryMap_TCellCrossReactivity, size: trace_point_type_MolecularMimicryMap_TCellCrossReactivity_human.marker.size, color: trace_point_type_MolecularMimicryMap_TCellCrossReactivity_human.marker.color, symbol: trace_point_type_MolecularMimicryMap_TCellCrossReactivity_human.marker.symbol, line: { width: trace_point_type_MolecularMimicryMap_TCellCrossReactivity_human.marker.line.width } } }, update_virus = { marker: { opacity: float_opacity_MolecularMimicryMap_TCellCrossReactivity, size: trace_point_type_MolecularMimicryMap_TCellCrossReactivity_virus.marker.size, color: trace_point_type_MolecularMimicryMap_TCellCrossReactivity_virus.marker.color, symbol: trace_point_type_MolecularMimicryMap_TCellCrossReactivity_virus.marker.symbol, line: { width: trace_point_type_MolecularMimicryMap_TCellCrossReactivity_virus.marker.line.width } }, error_x: { type: 'data', array: object_plot_TCellCrossReactivity.l_error_x, visible: true, width: 0, thickness: 1 } };
        Plotly.restyle( plotMolecularMimicryMap, update_human, object_plot_BCellCrossReactivity.index_trace_end ); // T-cell crossreactivity trace is situated next to B-cell cross-reactivity trace
        Plotly.restyle( plotMolecularMimicryMap, update_virus, object_plot_BCellCrossReactivity.index_trace_end + 1 );
        // prepare data
        let l_option = document.getElementById( "selectmultiple_TCellCrossReactivityMetrics" ).options, l_col = [ ], l_label = [ ];
        for ( let i = 0; i < l_option.length; i ++ ) {
            let option = l_option[ i ];
            if ( option.selected ) { l_col.push( option.value ); l_label.push( option.text ); } // retrieve column name and label for each selected column
        }
        trace_TCellCrossReactivityMetrics.dimensions = [ ]; // initialize metrics data
        for ( let i = 0; i < l_col.length; i ++ ) {
            let col = l_col[ i ], label = l_label[ i ];
            let l = col in object_plot_TCellCrossReactivity.metrics ? object_plot_TCellCrossReactivity.metrics[ col ] : unpack( arr_data_TCellCrossReactivity, col );
            trace_TCellCrossReactivityMetrics.dimensions.push( { values: l, label: label } );
        }
        Plotly.newPlot( plotTCellCrossReactivityMetrics, [ lodash.cloneDeep( trace_TCellCrossReactivityMetrics ) ], layout_PredictionMetrics, config ); 
        // Add Plotly interactions // Selection event through a plot containing metrics (parallel coordinate plots) (TCellCrossReactivity prediction data)
        object_plot_TCellCrossReactivity.l_mask = [ ]; // initialize list of masks
        for ( let i = 0; i < trace_TCellCrossReactivityMetrics.dimensions.length; i ++ ) { object_plot_TCellCrossReactivity.l_mask.push( ArrayFull( object_plot_TCellCrossReactivity.n_records, true ) ); } // initialize masks used for retrieving selected entries
        plotTCellCrossReactivityMetrics.on( 'plotly_restyle', function( eventData ) { // update trace_MolecularMimicryMap_TCellCrossReactivity based on selection in trace_TCellCrossReactivityMetrics
            let str_name_key = Object.keys( eventData[ 0 ] )[ 0 ];
            if ( str_name_key.includes( "constraintrange" ) ) { // when entries are selected or deselected (ignore event where fields are rearranged and no selection or deselection occurred)
                let index_field = parseInt( str_name_key.split( "].constraintrange" )[ 0 ].split( "dimensions[" )[ 1 ] ); // extract the index of field from the name of the key 
                let l_selectedRange = eventData[ 0 ][ str_name_key ];
                if ( l_selectedRange == null ) { // if all range of the current field is selected
                    object_plot_TCellCrossReactivity.l_mask[ index_field ] = ArrayFull( object_plot_TCellCrossReactivity.n_records, true ); // reset selection
                } else {
                    let l_mask_for_each_selectedRange = [ ]; // overlap mask for each selected ranges
                    for ( let i = 0; i < l_selectedRange.length; i++ ) { // for each selectedRange
                        let selectedRange = l_selectedRange[ i ].sort( SortFloat );
                        let l_data = trace_TCellCrossReactivityMetrics.dimensions[ index_field ].values;
                        l_mask_for_each_selectedRange.push( ArrayBoolAND( [ ArrayGreaterThan( l_data, selectedRange[ 0 ] ), ArrayLessThan( l_data, selectedRange[ 1 ] ) ] ) );
                    }
                    object_plot_TCellCrossReactivity.l_mask[ index_field ] = ArrayBoolOR( l_mask_for_each_selectedRange ); // update mask with the currently selected range
                }
                object_plot_TCellCrossReactivity.mask_selected = ArrayBoolAND( object_plot_TCellCrossReactivity.l_mask ); // retrieve a mask for the selected records
                object_plot_TCellCrossReactivity.selection = { l_opacity: [ ] };
                for ( let i = 0; i < object_plot_TCellCrossReactivity.mask_selected.length; i ++ ) { object_plot_TCellCrossReactivity.selection.l_opacity.push( object_plot_TCellCrossReactivity.mask_selected[ i ] ? float_opacity_MolecularMimicryMap_TCellCrossReactivity : 0 ); } // retrieve modified opacity values of records
                object_plot_TCellCrossReactivity.selection.l_error_x = ArrayBroadCasting( object_plot_TCellCrossReactivity.l_error_x, ArrayBoolNOT( object_plot_TCellCrossReactivity.mask_selected ), 0 ); // retrieve modified error_x values of records
                update_human = { marker: { opacity: object_plot_TCellCrossReactivity.selection.l_opacity, size: trace_point_type_MolecularMimicryMap_TCellCrossReactivity_human.marker.size, color: trace_point_type_MolecularMimicryMap_TCellCrossReactivity_human.marker.color, symbol: trace_point_type_MolecularMimicryMap_TCellCrossReactivity_human.marker.symbol, line: { width: trace_point_type_MolecularMimicryMap_TCellCrossReactivity_human.marker.line.width } } }, update_virus = { marker: { opacity: object_plot_TCellCrossReactivity.selection.l_opacity, size: trace_point_type_MolecularMimicryMap_TCellCrossReactivity_virus.marker.size, color: trace_point_type_MolecularMimicryMap_TCellCrossReactivity_virus.marker.color, symbol: trace_point_type_MolecularMimicryMap_TCellCrossReactivity_virus.marker.symbol, line: { width: trace_point_type_MolecularMimicryMap_TCellCrossReactivity_virus.marker.line.width } }, error_x: { type: 'data', array: object_plot_TCellCrossReactivity.selection.l_error_x, visible: true, width: 0, thickness: 1 } };
                Plotly.restyle( plotMolecularMimicryMap, update_human, object_plot_BCellCrossReactivity.index_trace_end ); // T-cell crossreactivity trace is situated next to B-cell cross-reactivity trace
                Plotly.restyle( plotMolecularMimicryMap, update_virus, object_plot_BCellCrossReactivity.index_trace_end + 1 );
            }
        });
    }
    function Record_Details_Table( bool_create_table_div ) { // function to create and remove "record datails" table
        if ( ( ! bool_create_table_div ) && document.getElementById( "table_record_details" ) != null ) { // remove div for "record datails" table
            document.getElementById( "table_record_details" ).remove( ); // remove loading screen once plot is drawn
            document.getElementById( "container_graph_molecular_mimicry_map" ).removeAttribute( "style" );
            window.dispatchEvent( new Event( 'resize' ) ); // trigger resize events to allow Plotly plot to resize its plot
        } else if ( document.getElementById( "table_record_details" ) == null ) { // create div for "record datails" table
            $("#container_d3_table_metrics").append( [
                '<div id="table_record_details">',
                    '<div class="navbar navbar-dark bg-custom-navbar">',
                        '<a class="navbar-brand my-0 h6" id="title_d3_table_metrics">Record Details</a>',
                        '<button type="button" class="close" aria-label="Close container_d3_table_metrics" onclick="Record_Details_Table( false )"><span aria-hidden="true">&times;</span></button>',
                    '</div>',
                    '<div id="d3_table_metrics"></div>',
                    '<div id="footnote_d3_table_metrics" class="text-muted"></div>',
                '</div>' ].join( "" ) ); // display an SVG file during loading 
            document.getElementById( "container_graph_molecular_mimicry_map" ).setAttribute( "style", "display: grid;grid-template-columns: 1fr minmax(150px, 33%);" ); // add css to allow a grid representation of two divisions.
            window.dispatchEvent( new Event( 'resize' ) ); // trigger resize events to allow Plotly plot to resize its plot
        }
    }
    function DrawD3Table_for_Record_Details( arr_data_clicked ) { // draw d3 table for the given 'arr_data_clicked' record
        Record_Details_Table( true ); // make a div. for table
        // draw 'd3_table_metrics'
        d3.select( "#d3_table_metrics" ).select( "div" ).remove( ); // remove previously drawn table

        let table = d3.select( "#d3_table_metrics" ).append( "div" ).attr( "style", "overflow-x:auto;" ).append( "table" ), thead = table.append( "thead" ), tbody = table.append( "tbody" ).attr( "style", "overflow-y:auto;" ); // write a responsive table
        thead.append( "th" ).text( "Data Name" );
        thead.append( "th" ).text( "Value" );
        let tr = tbody.selectAll( "tr" ).data( arr_data_clicked ).enter( ).append( "tr" ).classed( "table_even", function( d, i ) { return i % 2 == 1; } );
        tr.each( function( d ) {
            var self = d3.select(this);
            self.append("td").attr( "class", "table_left" ).html(d["Data Name"]);
            if ( d.URL != null ) { // if there is available URL link, add the link to the cell
                self.append("td").append("a").attr( "class", "table_left" ).attr("href", d.URL).attr( "target", "_blank" ).attr( "rel", "noopener noreferrer" ).text(d.Value).attr( "style", d.style ); // open the link in a new tab  // security measure to prevent phishing 
            } else { self.append("td").append("a").attr( "class", "table_left" ).text(d.Value).attr( "style", d.style ); }
        });
    }
    async function DrawMolecularMimicryMap ( ) {
        return new Promise ( async function( resolve, reject ) {
        Loading_Screen( true );
        let l = [], n_digits = 2;
        await LoadRemoteData_BasedOnSettings( ); // download necessary data based on settings
        console.log( "[DrawMolecularMimicryMap] Drawing graphs using following files:", object_plot_BCellCrossReactivity.name_file, object_plot_TCellCrossReactivity.name_file )
        console.log( "[DrawMolecularMimicryMap] setting hovermode to ", object_plot_MolecularMimicryMap.hovermode )
        layout_MolecularMimicryMap.hovermode = object_plot_MolecularMimicryMap.hovermode; // update hovermode
        object_plot_MolecularMimicryMap.showlegend = false // flag for showing name of certain traces (a legend of the graph)
        let flag_visibility_MolecularMimicryMap = $('#radio__MolecularMimicryMap_visibility label.active input').attr( "value" ) // retrieve current selection
        // draw B cell cross reactivity prediction data
        plotly_type_BCellCrossReactivity = document.getElementById( "select_graphic_format_BCellCrossReactivity" ).value == 0? "scattergl" : "scatter"; // retrieve plot setting from the setting panel
        
        plotMolecularMimicryMap.style.height = String( Math.max( 200, Math.min( 1000, document.getElementById( "input_plot_height_MolecularMimicryMap" ).value ) ) ) + 'px' // set height of the MolecularMimicryMap plot // max height is 1000 // min height is 200
        object_plot_BCellCrossReactivity.flag_bool_mode_is_lines = document.getElementById( "select_representation_of_an_alignment_BCellCrossReactivity" ).value == 1? true : false; 
        
        arr_data_BCellCrossReactivity = dict_filename_to_parsed_data[ object_plot_BCellCrossReactivity.name_file ];
        object_plot_BCellCrossReactivity.n_records = Math.min( arr_data_BCellCrossReactivity.length, object_plot_BCellCrossReactivity.n_records_from_setting ); // retrieve the number of BCellCrossReactivity records to plot
        arr_data_BCellCrossReactivity = arr_data_BCellCrossReactivity.slice( 0, object_plot_BCellCrossReactivity.n_records ); // retrieve "object_plot_BCellCrossReactivity.n_records" number of records
        object_plot_BCellCrossReactivity.dict_data = Unpack_array_to_dict_data( arr_data_BCellCrossReactivity, Object.keys( arr_data_BCellCrossReactivity[ 0 ] ) ) // unpack data to dict_data format
        object_plot_BCellCrossReactivity.dict_data[ "name_protein_virus" ] = ArrayApply( object_plot_BCellCrossReactivity.dict_data[ "representative_accession" ], function( acc_rep ) { return arr_data_acc_virus_representative[ acc_rep ].name; } ); // retrieve protein and structure names 
        object_plot_BCellCrossReactivity.dict_data[ "name_protein_human" ] = ArrayApply( object_plot_BCellCrossReactivity.dict_data[ "query_accession" ], function( acc ) { return arr_data_acc_human[ acc ].name; } );
        object_plot_BCellCrossReactivity.dict_data[ "virus_accession" ] = ArrayApply( object_plot_BCellCrossReactivity.dict_data[ "target_accession" ], function( acc ) { return arr_data_acc_virus[ acc ].value; } );
        object_plot_BCellCrossReactivity.dict_data[ "human_accession" ] = ArrayApply( object_plot_BCellCrossReactivity.dict_data[ "query_accession" ], function( acc ) { return arr_data_acc_human[ acc ].value; } );
        object_plot_BCellCrossReactivity.dict_data[ "name_structure_human" ] = ArrayApply( object_plot_BCellCrossReactivity.dict_data[ "structure_id_query" ], function( acc ) { if( acc == - 1 ) { return "not available" } else { return arr_data_acc_pdb[ acc ].value; } } );
        object_plot_BCellCrossReactivity.dict_data[ "name_structure_virus" ] = ArrayApply( object_plot_BCellCrossReactivity.dict_data[ "structure_id_target" ], function( acc ) { if( acc == - 1 ) { return "not available" } else { return arr_data_acc_pdb[ acc ].value; } } );
        object_plot_BCellCrossReactivity.dict_data[ "string_correl_coeffi_acc" ] = ArrayApply( object_plot_BCellCrossReactivity.dict_data[ "correl_coeffi_acc" ], function( num ) { if( num == null ) { return "not available" } else { return String( num.toFixed( n_digits ) ); } } );
        object_plot_BCellCrossReactivity.dict_data[ "string_correl_coeffi_phi" ] = ArrayApply( object_plot_BCellCrossReactivity.dict_data[ "correl_coeffi_phi" ], function( num ) { if( num == null ) { return "not available" } else { return String( num.toFixed( n_digits ) ); } } );
        object_plot_BCellCrossReactivity.dict_data[ "string_correl_coeffi_psi" ] = ArrayApply( object_plot_BCellCrossReactivity.dict_data[ "correl_coeffi_psi" ], function( num ) { if( num == null ) { return "not available" } else { return String( num.toFixed( n_digits ) ); } } );
        object_plot_BCellCrossReactivity.dict_data[ "string_correl_p_value_acc" ] = ArrayApply( object_plot_BCellCrossReactivity.dict_data[ "correl_p_value_acc" ], function( num ) { if( num == null ) { return "not available" } else { return num.toExponential( n_digits ); } } );
        object_plot_BCellCrossReactivity.dict_data[ "string_correl_p_value_phi" ] = ArrayApply( object_plot_BCellCrossReactivity.dict_data[ "correl_p_value_phi" ], function( num ) { if( num == null ) { return "not available" } else { return num.toExponential( n_digits ); } } );
        object_plot_BCellCrossReactivity.dict_data[ "string_correl_p_value_psi" ] = ArrayApply( object_plot_BCellCrossReactivity.dict_data[ "correl_p_value_psi" ], function( num ) { if( num == null ) { return "not available" } else { return num.toExponential( n_digits ); } } );
        console.log( "[DrawMolecularMimicryMap] number of BCellCrossReactivity prediction records for plotting:", object_plot_BCellCrossReactivity.n_records )
        
        let arr_start = nj.array( unpack( arr_data_BCellCrossReactivity, 'target_representative_accumulated_start__for_web_application' ) ), arr_end = nj.array( unpack( arr_data_BCellCrossReactivity, 'target_representative_accumulated_end__for_web_application' ) );
        let l_avg_score = unpack( arr_data_BCellCrossReactivity, 'avg_score_blosum_weighted' ), l_score = unpack( arr_data_BCellCrossReactivity, 'score_blosum_weighted' );
        let l_colors = [ ], l_acc_human = unpack( arr_data_BCellCrossReactivity, 'query_accession' ); // retrieve colors for each alignment
        dictionary_acc_human_BCellCrossReactivity = Index_list_with_dictionary( l_acc_human ); // build indices of BCellCrossReactivity data with acc_human
        for ( let i = 0; i < l_acc_human.length; i ++ ) { l_colors.push( l_colormap_rainbow_acc_human[ l_acc_human[ i ] ] ); }
        
        object_plot_BCellCrossReactivity.l_opacity = unpack( arr_data_BCellCrossReactivity, 'correl_coeffi_acc' ); // retrieve opacity
        object_plot_BCellCrossReactivity.l_error_x = arr_end.subtract( arr_start ).divide( 2 ).tolist( ); // retrieve error_x data (representing alignment length)
        object_plot_BCellCrossReactivity.selection = { l_error_x: object_plot_BCellCrossReactivity.l_error_x, l_opacity: object_plot_BCellCrossReactivity.l_opacity }; // for highlighting specific records
        data_line_type_MolecularMimicryMap_BCellCrossReactivity = [ ]; // empty data for line-type MolecularMimicryMap_BCellCrossReactivity plot
        
        object_plot_BCellCrossReactivity.hovertemplate = ["[ B-cell cross reactivity prediction ]",
                                                          "Virus: <b>%{customdata[0]}</b> from <b>%{customdata[1]:.0f}</b> to <b>%{customdata[2]:.0f}</b> (<b>%{customdata[3]}</b> from <b>%{customdata[4]:.0f}</b> to <b>%{customdata[5]:.0f}</b>)",
                                                          "        structure: <b>%{customdata[9]}</b>",
                                                          "Human: <b>%{customdata[6]}</b> from <b>%{customdata[7]:.0f}</b> to <b>%{customdata[8]:.0f}</b>",
                                                          "        structure: <b>%{customdata[10]}</b>",
                                                          "",
                                                          "Structure Similarity:",
                                                          "        secondary structure: <b>%{customdata[11]:.2f}</b>",
                                                          "        surface accessibility correlation (p-value): <b>%{customdata[12]}</b> (%{customdata[15]})",
                                                          "        torsion angle correlation (phi) (p-value): <b>%{customdata[13]}</b> (%{customdata[16]})",
                                                          "        torsion angle correlation (psi) (p-value): <b>%{customdata[14]}</b> (%{customdata[17]})",
                                                          "        global alignment identity (significance, e-value): <b>%{customdata[25]:.2f}</b> (<b>%{customdata[24]:.1e}</b>)",
                                                          "",
                                                          "Epitope Similarity:",
                                                          "        linear similarity (sum of BLOSUM62 scores): <b>%{customdata[19]:.1f}</b>",
                                                          "        discontinuous similarity (only co-accessible residues): <b>%{customdata[20]:.1f}</b>",
                                                          "        discontinuous similarity normalized by window length (%{customdata[22]:.0f} a.a.): <b>%{customdata[18]:.2f}</b>",
                                                          "        number of co-accessible residues: <b>%{customdata[21]:.1f}</b>",
                                                          "(this epitope represent <i>%{customdata[23]:.0f} epitopes</i> before redundancy reduction)",
                                                          "<br><extra></extra>" ].join( "<br>" );
        
        object_plot_BCellCrossReactivity.customdata = ArrayTranspose( [ object_plot_BCellCrossReactivity.dict_data[ "name_protein_virus" ], // 0
                                                                        object_plot_BCellCrossReactivity.dict_data[ "target_representative_start" ], 
                                                                        object_plot_BCellCrossReactivity.dict_data[ "target_representative_end" ], 
                                                                        
                                                                        object_plot_BCellCrossReactivity.dict_data[ "virus_accession" ], // 3
                                                                        object_plot_BCellCrossReactivity.dict_data[ "target_start" ], 
                                                                        object_plot_BCellCrossReactivity.dict_data[ "target_end" ], 
                                                                        
                                                                        object_plot_BCellCrossReactivity.dict_data[ "name_protein_human" ], // 6
                                                                        object_plot_BCellCrossReactivity.dict_data[ "query_start" ], 
                                                                        object_plot_BCellCrossReactivity.dict_data[ "query_end" ], 
                                                                       
                                                                        object_plot_BCellCrossReactivity.dict_data[ "name_structure_virus" ], // 9
                                                                        object_plot_BCellCrossReactivity.dict_data[ "name_structure_human" ], 
                                                                       
                                                                        object_plot_BCellCrossReactivity.dict_data[ "score_similarity_ss8" ], // 11
                                                                        object_plot_BCellCrossReactivity.dict_data[ "string_correl_coeffi_acc" ], 
                                                                        object_plot_BCellCrossReactivity.dict_data[ "string_correl_coeffi_phi" ], 
                                                                        object_plot_BCellCrossReactivity.dict_data[ "string_correl_coeffi_psi" ], 
                                                                        object_plot_BCellCrossReactivity.dict_data[ "string_correl_p_value_acc" ], // 15
                                                                        object_plot_BCellCrossReactivity.dict_data[ "string_correl_p_value_phi" ], 
                                                                        object_plot_BCellCrossReactivity.dict_data[ "string_correl_p_value_psi" ], 
                                                                        
                                                                        object_plot_BCellCrossReactivity.dict_data[ "avg_score_blosum_weighted" ], 
                                                                        object_plot_BCellCrossReactivity.dict_data[ "score_blosum" ], 
                                                                        object_plot_BCellCrossReactivity.dict_data[ "score_blosum_weighted" ], // 20
                                                                        object_plot_BCellCrossReactivity.dict_data[ "sum_of_weights" ], 
                                                                        object_plot_BCellCrossReactivity.dict_data[ "window_size" ], 
                                                                        object_plot_BCellCrossReactivity.dict_data[ "duplicate_counts" ], 
                                                                        
                                                                        object_plot_BCellCrossReactivity.dict_data[ "e_value" ], 
                                                                        object_plot_BCellCrossReactivity.dict_data[ "identity" ] ] ); // 25 // add custom data for hoverinfo.
        
        object_plot_BCellCrossReactivity.show = document.getElementById( "checkbox_toggle_BCellCrossReactivityPrediction_MolecularMimicryMap" ).checked; // retrieve visibility
        console.log( "BCellCrossReactivity visibility:", object_plot_BCellCrossReactivity.show );
        object_plot_BCellCrossReactivity.index_trace_start = 0; // record index_start of traces
        if ( object_plot_BCellCrossReactivity.flag_bool_mode_is_lines ) { 
            for ( let i = 0; i < object_plot_BCellCrossReactivity.n_records; i ++ ) {
                let trace = {  };
                trace.x = [ arr_start.selection.data[ i ], arr_end.selection.data[ i ] ]
                trace.y = [ l_avg_score[ i ], l_avg_score[ i ] ]
                trace.type = plotly_type_BCellCrossReactivity
                trace.mode = 'lines'
                trace.name = "BCR_" + String( i ) // assign trace name for the current record
                trace.line = { width: l_score[ i ] }
                trace.opacity = float_line_type_opacity_MolecularMimicryMap_BCellCrossReactivity // fixed opacity for the line-type plot for efficient updating
                trace.line.color = l_colors[ i ];
                trace.showlegend = false;
                trace.visible = object_plot_BCellCrossReactivity.show;
                trace.customdata = [ object_plot_BCellCrossReactivity.customdata[ i ], object_plot_BCellCrossReactivity.customdata[ i ] ];
                trace.hovertemplate = object_plot_BCellCrossReactivity.hovertemplate;
                data_line_type_MolecularMimicryMap_BCellCrossReactivity.push( trace )
            }
            Plotly.newPlot( plotMolecularMimicryMap, lodash.cloneDeep( data_line_type_MolecularMimicryMap_BCellCrossReactivity ), lodash.cloneDeep( layout_MolecularMimicryMap ), config_MolecularMimicryMap ); 
        } else {
            trace_point_type_MolecularMimicryMap_BCellCrossReactivity.x = arr_start.add( arr_end ).divide( 2 ).tolist( ); // calculate the coordinate of the middle of each alignment
            trace_point_type_MolecularMimicryMap_BCellCrossReactivity.y = l_avg_score;
            trace_point_type_MolecularMimicryMap_BCellCrossReactivity.marker.size = l_score;
            trace_point_type_MolecularMimicryMap_BCellCrossReactivity.marker.opacity = object_plot_BCellCrossReactivity.l_opacity;
            trace_point_type_MolecularMimicryMap_BCellCrossReactivity.marker.color = l_colors;
            trace_point_type_MolecularMimicryMap_BCellCrossReactivity.marker.line.width = 0
            trace_point_type_MolecularMimicryMap_BCellCrossReactivity.type = plotly_type_BCellCrossReactivity;
            trace_point_type_MolecularMimicryMap_BCellCrossReactivity.showlegend = false;
            trace_point_type_MolecularMimicryMap_BCellCrossReactivity.name = 'B Cell Cross-Reactivity Prediction'
            trace_point_type_MolecularMimicryMap_BCellCrossReactivity.visible = object_plot_BCellCrossReactivity.show;
            trace_point_type_MolecularMimicryMap_BCellCrossReactivity.error_x = { type: 'data', array: object_plot_BCellCrossReactivity.l_error_x, visible: true, width: 0, thickness: 1 }; // represent alignment by using errorbar
            trace_point_type_MolecularMimicryMap_BCellCrossReactivity.customdata = object_plot_BCellCrossReactivity.customdata;
            trace_point_type_MolecularMimicryMap_BCellCrossReactivity.hovertemplate = object_plot_BCellCrossReactivity.hovertemplate;
            Plotly.newPlot( plotMolecularMimicryMap, [ lodash.cloneDeep( trace_point_type_MolecularMimicryMap_BCellCrossReactivity ) ], lodash.cloneDeep( layout_MolecularMimicryMap ), config_MolecularMimicryMap );
        }
        object_plot_BCellCrossReactivity.index_trace_end = plotMolecularMimicryMap.data.length; // record index_end of traces
        
        object_plot_BCellCrossReactivity.metrics = { }; // initialize metrics
        object_plot_BCellCrossReactivity.metrics[ '-log10( e-value )' ] = nj.array( unpack( arr_data_BCellCrossReactivity, 'e_value' ) ).log( ).divide( 2.302585 ).multiply( -1 ).tolist( );
        object_plot_BCellCrossReactivity.mask_selected = ArrayFull( object_plot_BCellCrossReactivity.n_records, true ); // initialize mask for selection 
        Open_and_Draw_BCellCrossReactivityPredMetricsPlot( ); // Draw_BCellCrossReactivityPredMetricsPlot

        // draw T cell cross reactivity prediction data
//         select_redundancy_level_TCellCrossReactivity
        int_index_representation_TCellCrossReactivity = document.getElementById( "select_representation_of_an_alignment_TCellCrossReactivity" ).value; // retrieve plot setting from the setting panel
        plotly_type_TCellCrossReactivity = document.getElementById( "select_graphic_format_TCellCrossReactivity" ).value == 0? "scattergl" : "scatter"; 
        
        arr_data_TCellCrossReactivity = dict_filename_to_parsed_data[ object_plot_TCellCrossReactivity.name_file ];
        object_plot_TCellCrossReactivity.n_records = Math.min( arr_data_TCellCrossReactivity.length, object_plot_TCellCrossReactivity.n_records_from_setting ); // retrieve the number of BCellCrossReactivity records to plot
        arr_data_TCellCrossReactivity = arr_data_TCellCrossReactivity.slice( 0, object_plot_TCellCrossReactivity.n_records ); // retrieve "object_plot_TCellCrossReactivity.n_records" number of records from 'arr_data_TCellCrossReactivity'
        object_plot_TCellCrossReactivity.dict_data = Unpack_array_to_dict_data( arr_data_TCellCrossReactivity, Object.keys( arr_data_TCellCrossReactivity[ 0 ] ) ) // unpack data to dict_data format
        object_plot_TCellCrossReactivity.dict_data[ "name_protein_virus" ] = ArrayApply( object_plot_TCellCrossReactivity.dict_data[ "representative_accession" ], function( acc_rep ) { return arr_data_acc_virus_representative[ acc_rep ].name; } ); // retrieve protein and mhc_allele related data for hover info. 
        object_plot_TCellCrossReactivity.dict_data[ "name_protein_human" ] = ArrayApply( object_plot_TCellCrossReactivity.dict_data[ "query_accession" ], function( acc ) { return arr_data_acc_human[ acc ].name; } );
        object_plot_TCellCrossReactivity.dict_data[ "virus_accession" ] = ArrayApply( object_plot_TCellCrossReactivity.dict_data[ "target_accession" ], function( acc ) { return arr_data_acc_virus[ acc ].value; } );
        object_plot_TCellCrossReactivity.dict_data[ "human_accession" ] = ArrayApply( object_plot_TCellCrossReactivity.dict_data[ "query_accession" ], function( acc ) { return arr_data_acc_human[ acc ].value; } );
        object_plot_TCellCrossReactivity.dict_data[ "name_mhc_allele" ] = ArrayApply( object_plot_TCellCrossReactivity.dict_data[ "mhc_allele" ], function( acc ) { return arr_data_mhc_allele[ acc ].value; } );
        object_plot_TCellCrossReactivity.dict_data[ "name_disease" ] = ArrayApply( object_plot_TCellCrossReactivity.dict_data[ "mhc_allele" ], function( acc ) { return arr_data_mhc_allele[ acc ].disease_name; } );
        object_plot_TCellCrossReactivity.dict_data[ "pubmed_id" ] = ArrayApply( object_plot_TCellCrossReactivity.dict_data[ "mhc_allele" ], function( acc ) { return arr_data_mhc_allele[ acc ].pubmed_id; } );
        console.log( "[DrawMolecularMimicryMap] number of TCellCrossReactivity prediction records for plotting:", object_plot_TCellCrossReactivity.n_records )
        
        object_plot_TCellCrossReactivity.show = document.getElementById( "checkbox_toggle_TCellCrossReactivityPrediction_MolecularMimicryMap" ).checked; // retrieve visibility
        console.log( "[DrawMolecularMimicryMap] TCellCrossReactivity visibility:", object_plot_TCellCrossReactivity.show );
        arr_start = nj.array( unpack( arr_data_TCellCrossReactivity, 'target_representative_accumulated_start__for_web_application' ) );
        arr_end = nj.array( unpack( arr_data_TCellCrossReactivity, 'target_representative_accumulated_end__for_web_application' ) );
        let arr_score = nj.array( unpack( arr_data_TCellCrossReactivity, 'score_blosum' ) ), arr_window_size = nj.array( unpack( arr_data_TCellCrossReactivity, 'window_size' ) );
        l_avg_score = arr_score.divide( arr_window_size ).tolist( ); // retrieve sum of blosum62 scores per residue
        l_colors = [ ];
        l_acc_human = unpack( arr_data_TCellCrossReactivity, 'query_accession' ); // retrieve colors for each alignment
        dictionary_acc_human_TCellCrossReactivity = Index_list_with_dictionary( l_acc_human ); // build indices of TCellCrossReactivity data with acc_human
        for ( let i = 0; i < l_acc_human.length; i ++ ) { l_colors.push( l_colormap_rainbow_acc_human[ l_acc_human[ i ] ] ); }
        let l_x = arr_start.add( arr_end ).divide( 2 ).tolist( ); // calculate the coordinate of the middle of each alignment;

        let arr_score_geometric_mean_query = nj.array( unpack( arr_data_TCellCrossReactivity, 'score_geometric_mean_query' ) ), arr_score_geometric_mean_target = nj.array( unpack( arr_data_TCellCrossReactivity, 'score_geometric_mean_target' ) );  
        object_plot_TCellCrossReactivity.l_error_x = arr_end.subtract( arr_start ).divide( 2 ).tolist( ); // retrieve error_x data (representing alignment length)
        object_plot_TCellCrossReactivity.l_opacity = ArrayFull( object_plot_TCellCrossReactivity.n_records, float_opacity_MolecularMimicryMap_TCellCrossReactivity );
        object_plot_TCellCrossReactivity.selection = { l_error_x: object_plot_TCellCrossReactivity.l_error_x, l_opacity: object_plot_TCellCrossReactivity.l_opacity }; // for highlighting specific records
        
        arr_score_geometric_mean_query_log10 = arr_score_geometric_mean_query.log( ).divide( 2.302585 ) // calculate log10 of predicted binding values (IC50)
        arr_score_geometric_mean_target_log10 = arr_score_geometric_mean_target.log( ).divide( 2.302585 ) // calculate log10 of predicted binding values (IC50)
        trace_point_type_MolecularMimicryMap_TCellCrossReactivity_human.x = l_x;
        trace_point_type_MolecularMimicryMap_TCellCrossReactivity_virus.x = l_x;
        trace_point_type_MolecularMimicryMap_TCellCrossReactivity_human.y = l_avg_score;
        trace_point_type_MolecularMimicryMap_TCellCrossReactivity_virus.y = l_avg_score;
        trace_point_type_MolecularMimicryMap_TCellCrossReactivity_human.marker.symbol = [ "y-down-open", "star-triangle-down-dot", "bowtie" ][ int_index_representation_TCellCrossReactivity ]; // retrieve representation based on the given "int_index_representation_TCellCrossReactivity"
        trace_point_type_MolecularMimicryMap_TCellCrossReactivity_virus.marker.symbol = [ "y-up-open", "star-triangle-up-dot", "hourglass" ][ int_index_representation_TCellCrossReactivity ];
        let arr_scale = nj.ones( object_plot_TCellCrossReactivity.n_records ).multiply( 20 );
        trace_point_type_MolecularMimicryMap_TCellCrossReactivity_human.marker.size = ArrayCap( arr_scale.divide( arr_score_geometric_mean_query_log10 ).tolist( ), 30 );
        trace_point_type_MolecularMimicryMap_TCellCrossReactivity_virus.marker.size = ArrayCap( arr_scale.divide( arr_score_geometric_mean_target_log10 ).tolist( ), 30 );
        
        trace_point_type_MolecularMimicryMap_TCellCrossReactivity_human.marker.line.width = int_index_representation_TCellCrossReactivity == 0 ? 2 : 0; // if symbol is "y-down-open", set line width to 3
        trace_point_type_MolecularMimicryMap_TCellCrossReactivity_virus.marker.line.width = int_index_representation_TCellCrossReactivity == 0 ? 2 : 0; // if symbol is "y-down-open", set line width to 3
        trace_point_type_MolecularMimicryMap_TCellCrossReactivity_human.marker.color = l_colors;
        trace_point_type_MolecularMimicryMap_TCellCrossReactivity_virus.marker.color = l_colors;
        trace_point_type_MolecularMimicryMap_TCellCrossReactivity_human.marker.opacity = object_plot_TCellCrossReactivity.l_opacity;
        trace_point_type_MolecularMimicryMap_TCellCrossReactivity_virus.marker.opacity = object_plot_TCellCrossReactivity.l_opacity;
        trace_point_type_MolecularMimicryMap_TCellCrossReactivity_human.type = plotly_type_TCellCrossReactivity;
        trace_point_type_MolecularMimicryMap_TCellCrossReactivity_virus.type = plotly_type_TCellCrossReactivity;
        trace_point_type_MolecularMimicryMap_TCellCrossReactivity_human.name = "T Cell Cross-Reactivity Prediction (Human)";
        trace_point_type_MolecularMimicryMap_TCellCrossReactivity_virus.name = "T Cell Cross-Reactivity Prediction (Virus)";
        trace_point_type_MolecularMimicryMap_TCellCrossReactivity_human.visible = object_plot_TCellCrossReactivity.show;
        trace_point_type_MolecularMimicryMap_TCellCrossReactivity_virus.visible = object_plot_TCellCrossReactivity.show;
        trace_point_type_MolecularMimicryMap_TCellCrossReactivity_human.error_x = { type: 'data', array: ArrayFull( object_plot_TCellCrossReactivity.n_records, 0 ), visible: true, width: 0, thickness: 1 }
        trace_point_type_MolecularMimicryMap_TCellCrossReactivity_virus.error_x = { type: 'data', array: object_plot_TCellCrossReactivity.l_error_x, visible: true, width: 0, thickness: 1 }; // represent alignment by using errorbar of the trace containing data of virus
        
        
        object_plot_TCellCrossReactivity.hovertemplate = ["[ T-cell cross reactivity prediction ]",
                                                          "MHC allele (class): <b>%{customdata[15]}</b> (<b>%{customdata[18]}</b>)",
                                                          "        associated diseases: <b>%{customdata[16]}</b>",
                                                          "        PubMed ID: %{customdata[17]}",
                                                          "",
                                                          "Virus: <b>%{customdata[0]}</b> from <b>%{customdata[1]:.0f}</b> to <b>%{customdata[2]:.0f}</b> (<b>%{customdata[3]}</b> from <b>%{customdata[4]:.0f}</b> to <b>%{customdata[5]:.0f}</b>)",
                                                          "        sequence: <b>%{customdata[9]}</b>",
                                                          "        predicted binding affinity (IC50): <b>%{customdata[11]} nM</b>",
//                                                           "        list of used algorithms: %{customdata[13]}",
                                                          "",
                                                          "Human: <b>%{customdata[6]}</b> from <b>%{customdata[7]:.0f}</b> to <b>%{customdata[8]:.0f}</b>",
                                                          "        sequence: <b>%{customdata[10]}</b>",
                                                          "        predicted binding affinity (IC50): <b>%{customdata[12]} nM</b>",
//                                                           "        list of used algorithms: %{customdata[14]}",
                                                          "",
                                                          "Epitope Similarity:",
                                                          "        linear similarity (sum of BLOSUM62 scores): <b>%{customdata[19]:.1f}</b>",
                                                          "        linear similarity normalized by window length (%{customdata[22]:.0f} a.a.): <b>%{customdata[20]:.2f}</b>",
//                                                           "    Global alignment significance (e-value): <b>%{customdata[23]:.2f}</b>",
                                                          "(this epitope represent <i>%{customdata[21]:.0f} epitopes</i> before redundancy reduction)",
                                                          "<br><extra></extra>" ].join( "<br>" );
        
        object_plot_TCellCrossReactivity.customdata = ArrayTranspose( [ object_plot_TCellCrossReactivity.dict_data[ "name_protein_virus" ], // 0
                                                                        object_plot_TCellCrossReactivity.dict_data[ "target_representative_start" ], 
                                                                        object_plot_TCellCrossReactivity.dict_data[ "target_representative_end" ], 
                                                                        
                                                                        object_plot_TCellCrossReactivity.dict_data[ "virus_accession" ], // 3
                                                                        object_plot_TCellCrossReactivity.dict_data[ "target_start" ], 
                                                                        object_plot_TCellCrossReactivity.dict_data[ "target_end" ], 
                                                                        
                                                                        object_plot_TCellCrossReactivity.dict_data[ "name_protein_human" ], // 6
                                                                        object_plot_TCellCrossReactivity.dict_data[ "query_start" ], 
                                                                        object_plot_TCellCrossReactivity.dict_data[ "query_end" ], 
                                                                        
                                                                        object_plot_TCellCrossReactivity.dict_data[ "target_subsequence" ], // 9 
                                                                        object_plot_TCellCrossReactivity.dict_data[ "query_subsequence" ], 
                                                                        object_plot_TCellCrossReactivity.dict_data[ "score_geometric_mean_target" ], 
                                                                        object_plot_TCellCrossReactivity.dict_data[ "score_geometric_mean_query" ], 
                                                                        object_plot_TCellCrossReactivity.dict_data[ "algorithms_target" ], 
                                                                        object_plot_TCellCrossReactivity.dict_data[ "algorithms_query" ], 
                                                                       
                                                                        object_plot_TCellCrossReactivity.dict_data[ "name_mhc_allele" ], // 15
                                                                        object_plot_TCellCrossReactivity.dict_data[ "name_disease" ],
                                                                        object_plot_TCellCrossReactivity.dict_data[ "pubmed_id" ],
                                                                        object_plot_TCellCrossReactivity.dict_data[ "mhc_class" ],
                                                                       
                                                                        object_plot_TCellCrossReactivity.dict_data[ "score_blosum" ], // 19
                                                                        l_avg_score,
                                                                        object_plot_TCellCrossReactivity.dict_data[ "duplicate_counts" ],
                                                                        object_plot_TCellCrossReactivity.dict_data[ "window_size" ], 
                                                                        object_plot_TCellCrossReactivity.dict_data[ "e_value" ] ] ); // 23 // add custom data for hoverinfo.
        
        trace_point_type_MolecularMimicryMap_TCellCrossReactivity_human.hoverinfo = 'skip'; // skip hoverinfo for the other trace
        trace_point_type_MolecularMimicryMap_TCellCrossReactivity_virus.hovertemplate = object_plot_TCellCrossReactivity.hovertemplate;
        trace_point_type_MolecularMimicryMap_TCellCrossReactivity_virus.customdata = object_plot_TCellCrossReactivity.customdata;
        object_plot_TCellCrossReactivity.index_trace_start = plotMolecularMimicryMap.data.length; // record index_start and index_end of traces
        Plotly.addTraces( plotMolecularMimicryMap, [ lodash.cloneDeep( trace_point_type_MolecularMimicryMap_TCellCrossReactivity_human ), lodash.cloneDeep( trace_point_type_MolecularMimicryMap_TCellCrossReactivity_virus ) ] );
        object_plot_TCellCrossReactivity.index_trace_end = plotMolecularMimicryMap.data.length;
        
        object_plot_TCellCrossReactivity.metrics = { }; // initialize metrics
        object_plot_TCellCrossReactivity.metrics[ '-log10( e-value )' ] = nj.array( unpack( arr_data_TCellCrossReactivity, 'e_value' ) ).log( ).divide( 2.302585 ).multiply( -1 ).tolist( );
        object_plot_TCellCrossReactivity.metrics[ "log10( score_geometric_mean_query )" ] = arr_score_geometric_mean_query_log10.tolist( );
        object_plot_TCellCrossReactivity.metrics[ "log10( score_geometric_mean_target )" ] = arr_score_geometric_mean_target_log10.tolist( );
        object_plot_TCellCrossReactivity.mask_selected = ArrayFull( object_plot_TCellCrossReactivity.n_records, true ); // initialize mask for selection
        Open_and_Draw_TCellCrossReactivityPredMetricsPlot( ); // Draw_TCellCrossReactivityPredMetricsPlot
        
        // Add annotations of SARS-CoV-2 proteins
        console.log( '[DrawMolecularMimicryMap] plotting virus protein annotation traces...' )
            // add annotation of proteins
        object_annotation_representative_virus_protein.index_trace_start = plotMolecularMimicryMap.data.length; // record index_start and index_end of traces
        Plotly.addTraces( plotMolecularMimicryMap, lodash.cloneDeep( object_annotation_representative_virus_protein.data ) );
        object_annotation_representative_virus_protein.index_trace_end = plotMolecularMimicryMap.data.length;
            // add annotation of domains
        object_data_interpro_virus.index_trace_start = plotMolecularMimicryMap.data.length; // record index_start and index_end of traces
        Plotly.addTraces( plotMolecularMimicryMap, lodash.cloneDeep( object_data_interpro_virus.data ) );
        object_data_interpro_virus.index_trace_end = plotMolecularMimicryMap.data.length;
            // add annotation of consensus protein sequence
        object_data_consensus_sequence_virus.index_trace_start = plotMolecularMimicryMap.data.length; // record index_start and index_end of traces
        Plotly.addTraces( plotMolecularMimicryMap, lodash.cloneDeep( object_data_consensus_sequence_virus.data ) );
        object_data_consensus_sequence_virus.index_trace_end = plotMolecularMimicryMap.data.length;
        Toggle_VirusProteinAnnotation_MolecularMimicryMap( ); // update the visibility of virus protein annotation traces
        Set_Visibility_of_Consensus_Protein_Sequence_Virus( ); // set visibility of protein sequences
        
        // Add metrics for vaccine design
        console.log( '[DrawMolecularMimicryMap] plotting vaccine metric traces...' )
        VaccineMetrics_Update_Visibility( ); // update visibility of vaccine metric traces
        l = object_data_vaccine_metric.visibility_for_each_trace;
        for ( let i = 0; i < l.length; i ++ ) { object_data_vaccine_metric.data[ i + 2 ].visible = l[ i ]; } // first two traces are lower and upper boundary of vaccine metric traces
        object_data_vaccine_metric.index_trace_start = plotMolecularMimicryMap.data.length; // record index_start and index_end of traces
        Plotly.addTraces( plotMolecularMimicryMap, lodash.cloneDeep( object_data_vaccine_metric.data ) );
        object_data_vaccine_metric.index_trace_end = plotMolecularMimicryMap.data.length;
        
        // Add IEDB epitopes with positive assays
        console.log( '[DrawMolecularMimicryMap] plotting "IEDB epitopes of SARS-CoV-2 virus" traces...' )
        object_data_iedb_epitope_virus.index_trace_start = plotMolecularMimicryMap.data.length; // record index_start and index_end of traces
        Plotly.addTraces( plotMolecularMimicryMap, lodash.cloneDeep( object_data_iedb_epitope_virus.data ) );
        object_data_iedb_epitope_virus.index_trace_end = plotMolecularMimicryMap.data.length;
        
        // retrieve mapping of name of each trace to trace index
        dict_name_plot_to_trace_index__MolecularMimicryMap = { }; // initialize the mapping
        for( let i = 0; i < plotMolecularMimicryMap.data.length; i ++ ) { dict_name_plot_to_trace_index__MolecularMimicryMap[ plotMolecularMimicryMap.data[ i ].name ] = i; }
        Draw_DesignedVaccineTrace( "new_trace" ); // draw DesignedVaccineTrace if the file has been loaded after trace index has been updated
        
        Loading_Screen( false ); // remove loading screen once plot is drawn
        console.log( '[DrawMolecularMimicryMap] adding interaction callbacks...' )
        // Add Plotly interactions to MolecularMimicryMap main plot
        // draw tables and show molecular structure upon click
        plotMolecularMimicryMap.on( 'plotly_click', function( data ) {
            l_b.push( data )
            let clicked_point = data.points[ 0 ]; // only use the first point in the returned list of points to show a table containing alignment metrics and details
            let index = null, flag_data_type = null, name_trace = plotMolecularMimicryMap.data[ clicked_point.curveNumber ].name;
            console.log( name_trace );
            index = name_trace.slice( 0, 4 ) == "BCR_" ? clicked_point.curveNumber : clicked_point.pointIndex;
            if ( name_trace == "B Cell Cross-Reactivity Prediction" ) {
                flag_data_type = "B-Cell";
            } else if ( name_trace.slice( 0, 4 ) == "BCR_" ) {
                flag_data_type = "B-Cell";
            } else if ( name_trace.includes( "T Cell Cross-Reactivity Prediction" ) ) {
                flag_data_type = "T-Cell";
            } else if ( name_trace.includes( "IEDB_Epitopes" ) ) {
                flag_data_type = "IEDB";
            } else if ( name_trace.includes( "__InterPro" ) ) {
                flag_data_type = "InterPro";
            } else if ( name_trace == "vaccine_design" ) {
                flag_data_type = "vaccine_design";
            }
            gtag( 'event', 'main_graph_click_callback', { 'clicked_data_type' : flag_data_type } ); // [Google Analytics] record data_type of the clicked record to further improve the visualization of the data_type
            if ( flag_data_type == "B-Cell" ) { // when clicked data belongs to BCellCrossReactivity data         
                ClickCallBack_BCellCrossReactivity( index )
            } else if ( flag_data_type == "T-Cell" ) {
                Toggle_Exclusive_Tabs( "hide_all" ); // hide all supplementary tabs
                clicked_record = arr_data_TCellCrossReactivity[ index ];
                console.log( "[plotMolecularMimicryMap] clicked record belongs to TCellCrossReactivity data:", clicked_record );
                arr_data_clicked = [ ]; // empty the array containing data of the clincked record
                let representative_virus_protein = arr_data_acc_virus_representative[ clicked_record.representative_accession ];
                arr_data_clicked.push( { "Data Name": "[virus] representative protein", Value: representative_virus_protein.name + " (" + representative_virus_protein.accession + ") from " + clicked_record.target_representative_start + " to " + clicked_record.target_representative_end, URL: "https://www.ncbi.nlm.nih.gov/protein/" + representative_virus_protein.accession } );
                arr_data_clicked.push( { "Data Name": "[human] protein name", Value: arr_data_acc_human[ clicked_record.query_accession ].name, URL: "https://www.google.com/search?q=" + arr_data_acc_human[ clicked_record.query_accession ].description.split( "OS=" )[ 0 ] } ); // add human protein description with a link to a google search
                arr_data_clicked.push( { "Data Name": "[virus] protein accession", Value: arr_data_acc_virus[ clicked_record.target_accession ].value + " from " + clicked_record.target_start + " to " + clicked_record.target_end, URL: "https://www.ncbi.nlm.nih.gov/protein/" + arr_data_acc_virus[ clicked_record.target_accession ].value } );
                arr_data_clicked.push( { "Data Name": "[human] protein accession", Value: arr_data_acc_human[ clicked_record.query_accession ].value + " from " + clicked_record.query_start + " to " + clicked_record.query_end, URL: "https://www.uniprot.org/uniprot/" + arr_data_acc_human[ clicked_record.query_accession ].value } );
                arr_data_clicked.push( { "Data Name": "[virus] peptide", Value: clicked_record.target_subsequence, URL: null, style: "font-family:Consolas" } );
                arr_data_clicked.push( { "Data Name": "[human] peptide", Value: clicked_record.query_subsequence, URL: null, style: "font-family:Consolas" } );
                arr_data_clicked.push( { "Data Name": "[virus] predicted binding affinity*", Value: String( clicked_record.score_geometric_mean_target ) + " nM", URL: null, style: "font-family:Arial" } );
                arr_data_clicked.push( { "Data Name": "[human] predicted binding affinity*", Value: String( clicked_record.score_geometric_mean_query ) + " nM", URL: null, style: "font-family:Arial" } );
                arr_data_clicked.push( { "Data Name": "[virus] prediction algorithms", Value: arr_data_algorithms[ clicked_record.algorithms_target ].value, URL: null, style: "font-family:Arial" } );
                arr_data_clicked.push( { "Data Name": "[human] prediction algorithms", Value: arr_data_algorithms[ clicked_record.algorithms_query ].value, URL: null, style: "font-family:Arial" } );
                arr_data_clicked.push( { "Data Name": "sum of BLOSUM62 scores", Value: clicked_record.score_blosum, URL: null, style: "font-family:Arial" } );
                arr_data_clicked.push( { "Data Name": "MHC class", Value: clicked_record.mhc_class, URL: null, style: "font-family:Arial" } );
                arr_data_clicked.push( { "Data Name": "MHC allele", Value: arr_data_mhc_allele[ clicked_record.mhc_allele ].value, URL: null, style: "font-family:Arial" } );
                arr_data_clicked.push( { "Data Name": "E-value (significance) of full-length alignment", Value: clicked_record.e_value, URL: null, style: "font-family:Arial" } );
                arr_data_clicked.push( { "Data Name": "alignment method", Value: clicked_record.source_is_blastp? "BLASTP" : "HMMER", URL: null, style: "font-family:Arial" } );
                arr_data_clicked.push( { "Data Name": "number of redundant alignments", Value: clicked_record.duplicate_counts, URL: null, style: "font-family:Arial" } );
                
                DrawD3Table_for_Record_Details( arr_data_clicked );
                document.getElementById( "title_d3_table_metrics" ).innerHTML = "T-Cell Cross-Reactivity Prediction data"; // update table title for 'd3_table_metrics' table
                document.getElementById( "footnote_d3_table_metrics" ).innerHTML = "A geometric average of predicted IC50 values. IC50 is the concentration that inhibits 50% binding of the fluorescein-labeled reference peptide."; // update table footnote for 'd3_table_metrics' table

                // draw Plotly table visualizing BLOSUM62 scores
                object_data_tableSequence.flag_data_type = "T-Cell";
                let len_alignment = clicked_record.query_subsequence.length, query_aligned_sequence = clicked_record.query_subsequence, target_aligned_sequence = clicked_record.target_subsequence, l_score_blosum = [ ];
                for ( let i = 0; i < query_aligned_sequence.length; i ++ ) { l_score_blosum.push( Math.round( dict_blosum62[ query_aligned_sequence[ i ] + target_aligned_sequence[ i ] ] ) ); } // round the blosum score so that step become 1
                let l_color_score_blosum = Color_for_score_blosum( l_score_blosum );

                let colors = [ ], values = [ ], header = [ ], l_col = [ 'virus_seq', 'score_blosum', 'human_seq' ];
                values.push( ... [ target_aligned_sequence.split( "" ), l_score_blosum, query_aligned_sequence.split( "" ) ] );
                colors.push( ... [ ArrayFull( len_alignment, "#ffffff" ), l_color_score_blosum, ArrayFull( len_alignment, "#ffffff" ) ] );

                for ( let i = 0; i < l_col.length; i ++ ) { header.push( [ "<b>" + l_col[ i ] + "</b>" ] ); } // build header from 'l_col'
                object_data_tableSequence.data = [{
                    type: 'table',
                    header: { values: header, align: "center", height: 30, line: {width: 1, color: '#506784'}, fill: {color: '#f0f0f0'}, font: {family: "Arial", size: 12, color: "black"} },
                    cells: {values: values, align: "center", height: 20, line: {color: colors, width: 1}, fill: {color: colors }, font: {family: "Arial", size: 12, color: ["#3d3d3d"] }}
                }]
                document.getElementById( "plotly_table_sequence" ).style.height = String( Math.min( 20 * int_n_residues_per_window_table_sequence + 30 + 10, parseInt( l_score_blosum.length * 20 + 30 + 10 ) ) ) + "px" // set height of table according to the length of alignment # max height is 640
//                 let layout_tableSequence_TCellCrossReactivity = Object.assign( { width: ( Math.min( , tableSequence.getBoundingClientRect( ).width ) ) }, layout_tableSequence )
                if ( "removeAllListeners" in tableSequence ) { tableSequence.removeAllListeners( "click" ); tableSequence.removeEventListener( 'click', Highlight_PDB_Residue__Click_Callback__Aligned_Sequence_Table ) } // remove previous listeners if a listener exists
                str_jquery_container = "#container_plotly_table_sequence";
                if ( $( str_jquery_container ).hasClass( "collapse" ) && $( str_jquery_container ).hasClass( "show" ) ) { Responsive_Column_Width_Aligned_Sequence_Table_TCellCrossReactivity( ); // draw Plotly plot synchronously if the container is currently shown
                } else { BootstrapCollapseShownPromise( str_jquery_container ).then( ( ) => { Responsive_Column_Width_Aligned_Sequence_Table_TCellCrossReactivity( ); } ); } // draw Plotly plot once the container is shown if the container is currently hidden
                document.getElementById( "description_clicked_position__table_sequence" ).innerHTML = ""; // empty the description
                
                // Render default molecular structures using the Mol* JS application
                str_jquery_container = "#container_PDB";
                let pos_protein = 0, pos_pdb = 0;
                // show dummy if T-cell cross-reactivity prediction record was been clicked. 
                if ( $( str_jquery_container ).hasClass( "collapse" ) && $( str_jquery_container ).hasClass( "show" ) ) { pdbHumanProtein.visual.update( option_initialization_molstar );; // render coordinates synchronously if the container is currently shown
                } else { BootstrapCollapseShownPromise( str_jquery_container ).then( ( ) => { pdbHumanProtein.visual.update( option_initialization_molstar ); } ); } // render coordinates once the container is shown if the container is currently hidden
                if ( $( str_jquery_container ).hasClass( "collapse" ) && $( str_jquery_container ).hasClass( "show" ) ) { pdbVirusProtein.visual.update( option_initialization_molstar );; // render coordinates synchronously if the container is currently shown
                } else { BootstrapCollapseShownPromise( str_jquery_container ).then( ( ) => { pdbVirusProtein.visual.update( option_initialization_molstar ); } ); } // render coordinates once the container is shown if the container is currently hidden
            } else if ( flag_data_type == "IEDB" ) {
                let customdata = clicked_point.customdata; // retrieve custom data of clicked point
                console.log( "[plotMolecularMimicryMap] clicked record is IEDB epitope:", clicked_point );

                arr_data_clicked = [ ]; // empty the array containing data of the clincked record
                let url_iedb = "https://www.iedb.org/epitope/" + customdata[ 0 ];
                arr_data_clicked.push( { "Data Name": "representative virus protein", Value: customdata[ 5 ] + " from " + customdata[ 3 ] + " to " + customdata[ 4 ], URL: null, style: "font-family:Arial" } );
                arr_data_clicked.push( { "Data Name": "IEDB epitope accession", Value: customdata[ 0 ], URL: url_iedb, style: "font-family:Arial" } );
                arr_data_clicked.push( { "Data Name": "number of positive B-cell assays", Value: customdata[ 1 ], URL: url_iedb, style: "font-family:Arial" } );
                arr_data_clicked.push( { "Data Name": "number of positive T-cell assays", Value: customdata[ 2 ], URL: url_iedb, style: "font-family:Arial" } );
                arr_data_clicked.push( { "Data Name": "percent_identity", Value: customdata[ 7 ], URL: null, style: "font-family:Arial" } );
                arr_data_clicked.push( { "Data Name": "mismatch", Value: customdata[ 8 ], URL: null, style: "font-family:Arial" } );
                arr_data_clicked.push( { "Data Name": "gapopen", Value: customdata[ 9 ], URL: null, style: "font-family:Arial" } );

                DrawD3Table_for_Record_Details( arr_data_clicked );
                document.getElementById( "title_d3_table_metrics" ).innerHTML = "Immune Epitope Database (IEDB) Epitope"; // update table title for 'd3_table_metrics' table
                document.getElementById( "footnote_d3_table_metrics" ).innerHTML = ""; // update table footnote for 'd3_table_metrics' table
            } else if ( flag_data_type == "InterPro" ) {
                let customdata = clicked_point.customdata; // retrieve custom data of clicked InterPro annotation
                console.log( "[plotMolecularMimicryMap] clicked record is InterPro protein annotation:", clicked_point );

                arr_data_clicked = [ ]; // empty the array containing data of the clincked record
                let url_interpro = "http://www.ebi.ac.uk/interpro/entry/InterPro/" + customdata[ 3 ] + '/';
                arr_data_clicked.push( { "Data Name": "representative virus protein", Value: customdata[ 0 ] + " from " + customdata[ 5 ] + " to " + customdata[ 6 ], URL: null, style: "font-family:Arial" } );
                arr_data_clicked.push( { "Data Name": "InterPro accession", Value: customdata[ 3 ], URL: url_interpro, style: "font-family:Arial" } );
                arr_data_clicked.push( { "Data Name": "InterPro name", Value: customdata[ 2 ], URL: url_interpro, style: "font-family:Arial" } );
                arr_data_clicked.push( { "Data Name": "Database accession", Value: customdata[ 5 ], URL: url_interpro, style: "font-family:Arial" } );
                
                DrawD3Table_for_Record_Details( arr_data_clicked );
                document.getElementById( "title_d3_table_metrics" ).innerHTML = "InterPro Protein Domain Annotation"; // update table title for 'd3_table_metrics' table
                document.getElementById( "footnote_d3_table_metrics" ).innerHTML = ""; // update table footnote for 'd3_table_metrics' table
            } else if ( flag_data_type == "vaccine_design" ) { // selection of vaccine candidate through clicking // update selected status of clicked record
                object_data_vaccine_design.interaction_mode = Retrieve_Selection_Mode_Using_Keydown_Status_VaccineDesign( ); // retrieve selection mode
                if( object_data_vaccine_design.interaction_mode == "Show_Info" ) { object_data_vaccine_design.interaction_mode = $('#radio__Vaccine_Design__Select_Mode label.active input').attr( "value" ); } // selection mode from keydown_status has a priority over selection mode from the radio button.
                if ( object_data_vaccine_design.interaction_mode == "Show_Info" ) {
                    let customdata = clicked_point.customdata; // retrieve custom data of clicked point
                    console.log( "[plotMolecularMimicryMap] clicked record is a (peptide) vaccine candidate:", clicked_point );

                    arr_data_clicked = [{ "Data Name": "header", Value: customdata[ 3 ], URL: null, style: "font-family:Arial" },
                                        { "Data Name": "sequence", Value: customdata[ 4 ], URL: null, style: "font-family:Arial" },
                                        { "Data Name": "aligned positions on SARS-CoV-2 proteome", Value: customdata[0] + ' from ' + customdata[1] + ' to ' + customdata[2] + ' (' + customdata[5] + ' mismatch)', URL: null, style: "font-family:Arial" },
                                        { "Data Name": "number of <b>mutated</b> proteins", Value: customdata[10], URL: null, style: "font-family:Arial" },
                                        { "Data Name": "number of overlapped predicted <b>B-cell cross-reactive epitopes</b>", Value: customdata[ 6 ], URL: null, style: "font-family:Arial" },
                                        { "Data Name": "number of overlapped predicted <b>T-cell cross-reactive MHC epitopes</b>", Value: customdata[ 7 ], URL: null, style: "font-family:Arial" },
                                        { "Data Name": "number of overlapped predicted <b>MHC-I epitopes</b> (af<0.001)", Value: customdata[ 16 ], URL: null, style: "font-family:Arial" },
                                        { "Data Name": "number of overlapped predicted <b>MHC-II epitopes</b> (af<0.001)", Value: customdata[ 17 ], URL: null, style: "font-family:Arial" },
                                        { "Data Name": "number of <b>positive B-cell assays</b> for overlapped IEDB epitopes", Value: customdata[ 8 ], URL: null, style: "font-family:Arial" },
                                        { "Data Name": "number of <b>positive T-cell assays</b> for overlapped IEDB epitopes", Value: customdata[ 9 ], URL: null, style: "font-family:Arial" },
                                        { "Data Name": "Relative accessible surface area", Value: d3.format( ".1%" )( customdata[ 18 ] ), URL: null, style: "font-family:Arial" },
                                        { "Data Name": "B cell linear epitope prediction score (BepiPred)", Value: customdata[ 14 ], URL: null, style: "font-family:Arial" },
                                        { "Data Name": "MHC-I epitope processing score (MHCflurry)", Value: customdata[ 15 ], URL: null, style: "font-family:Arial" },
                                       ]; // build d3 array
                    DrawD3Table_for_Record_Details( arr_data_clicked );
                    document.getElementById( "title_d3_table_metrics" ).innerHTML = "Potential Vaccine Candidate"; // update table title for 'd3_table_metrics' table
                    document.getElementById( "footnote_d3_table_metrics" ).innerHTML = ""; // update table footnote for 'd3_table_metrics' table
                } else {
                    let bool_selected = object_data_vaccine_design.interaction_mode == "Include";
                    if ( object_data_vaccine_design.dict_data[ "selected" ][ index ] != bool_selected ) { // update graph if current status is different from previous status. 
                        object_data_vaccine_design.dict_data[ "selected" ][ index ] = bool_selected;
                        Draw_DesignedVaccineTrace( "update_selection" ); // update selection
                    }
                }
            } 
        });
        plotMolecularMimicryMap.on( 'plotly_selected', function( data ) { // selection of vaccine candidate through selection
            console.log( data );
            if ( data == undefined ) { return; }
            object_data_vaccine_design.interaction_mode = Retrieve_Selection_Mode_Using_Keydown_Status_VaccineDesign( ); // retrieve selection mode
            if( object_data_vaccine_design.interaction_mode == "Show_Info" ) { object_data_vaccine_design.interaction_mode = $('#radio__Vaccine_Design__Select_Mode label.active input').attr( "value" ); } // selection mode from keydown_status has a priority over selection mode from the radio button.
            if ( object_data_vaccine_design.interaction_mode == "Show_Info" ) { return; } // if selection_mode == "Show_Info", do not update selection
            let l_point = [ ], index_vaccine_design = dict_name_plot_to_trace_index__MolecularMimicryMap[ "vaccine_design" ], bool_selected = object_data_vaccine_design.interaction_mode == "Include";
            data.points.forEach( function( pt ) { if ( pt.curveNumber == index_vaccine_design ) { l_point.push( pt ); } } ); // retrieve selected points of the vaccine_design trace
            for ( let i = 0; i < l_point.length; i ++ ) { object_data_vaccine_design.dict_data[ "selected" ][ l_point[ i ].pointIndex ] = bool_selected; } // update selected status of selected records
            Draw_DesignedVaccineTrace( "update_selection" ) // update colors
        });
        plotMolecularMimicryMap.on( 'plotly_relayout', EventHandler_plotly_relayout_MolecularMimicryMap ); // detect zooming and resizing
        plotMolecularMimicryMap.on( 'plotly_restyle', EventHandler_plotly_restyle_MolecularMimicryMap ); 
        plotMolecularMimicryMap.on( 'plotly_autosize', function( data ) { 
            console.log( "plotMolecularMimicryMap, plotly_autosize event triggered:", data );
//             Set_Visibility_of_Consensus_Protein_Sequence_Virus( );
        });// detect resizing of plot
        Loading_Screen( false ); // remove loading screen once plot is drawn
        console.log( "[DrawMolecularMimicryMap] resolved" );
        await Adjust_Layout_MolecularMimicryMap( );
        resolve( "[DrawMolecularMimicryMap] resolved" );
    });
    }
    async function ClickCallBack_BCellCrossReactivity( index ) { // a click callback function for a B-cell cross reactivity prediction result
        Toggle_Exclusive_Tabs( "hide_all" ); // hide all supplementary tabs
        clicked_record = arr_data_BCellCrossReactivity[ index ];
        console.log( "[plotMolecularMimicryMap] clicked record belongs to BCellCrossReactivity data:", clicked_record );

        arr_data_clicked = [ ]; // empty the array containing data of the clincked record
        let representative_virus_protein = arr_data_acc_virus_representative[ clicked_record.representative_accession ];
        arr_data_clicked.push( { "Data Name": "[virus] representative protein", Value: representative_virus_protein.name + " (" + representative_virus_protein.accession + ") from " + clicked_record.target_representative_start + " to " + clicked_record.target_representative_end, URL: "https://www.ncbi.nlm.nih.gov/protein/" + representative_virus_protein.accession } );
        arr_data_clicked.push( { "Data Name": "[human] protein name", Value: arr_data_acc_human[ clicked_record.query_accession ].name, URL: "https://www.google.com/search?q=" + arr_data_acc_human[ clicked_record.query_accession ].description.split( "OS=" )[ 0 ] } ); // add human protein description with a link to a google search
        arr_data_clicked.push( { "Data Name": "[virus] protein accession", Value: arr_data_acc_virus[ clicked_record.target_accession ].value + " from " + clicked_record.target_start + " to " + clicked_record.target_end, URL: "https://www.ncbi.nlm.nih.gov/protein/" + arr_data_acc_virus[ clicked_record.target_accession ].value } );
        arr_data_clicked.push( { "Data Name": "[human] protein accession", Value: arr_data_acc_human[ clicked_record.query_accession ].value + " from " + clicked_record.query_start + " to " + clicked_record.query_end, URL: "https://www.uniprot.org/uniprot/" + arr_data_acc_human[ clicked_record.query_accession ].value } );
        let flag_structure_exist_for_human_sequence = clicked_record.structure_id_query != -1, flag_structure_exist_for_virus_sequence = clicked_record.structure_id_target != -1; // retrieve flag for structure property data availability for human and virus sequence
        if ( flag_structure_exist_for_virus_sequence ) { 
            arr_data_clicked.push( { "Data Name": "[virus] PDB structure of protein", Value: arr_data_acc_pdb[ clicked_record.structure_id_target ].value + " (" + arr_data_acc_virus[ clicked_record.target_accession ].value + " from " + clicked_record.target_structure_start + " to " + clicked_record.target_structure_end + ")", URL: "https://www.rcsb.org/structure/" + arr_data_acc_pdb[ clicked_record.structure_id_target ].id_pdb.toUpperCase( ), style: "font-family:Arial" } );
        } else {
            arr_data_clicked.push( { "Data Name": "[virus] PDB structure of protein", Value: "unavailable", URL: null, style: "font-family:Arial" } );
        }
        if ( flag_structure_exist_for_human_sequence ) { 
            arr_data_clicked.push( { "Data Name": "[human] PDB structure", Value: arr_data_acc_pdb[ clicked_record.structure_id_query ].value + " (" + arr_data_acc_human[ clicked_record.query_accession ].value + " from " + clicked_record.query_structure_start + " to " + clicked_record.query_structure_end + ")", URL: "https://www.rcsb.org/structure/" + arr_data_acc_pdb[ clicked_record.structure_id_query ].id_pdb.toUpperCase( ), style: "font-family:Arial" } );
        } else {
            arr_data_clicked.push( { "Data Name": "[human] PDB structure", Value: "unavailable", URL: null, style: "font-family:Arial" } );
        }
        arr_data_clicked.push( { "Data Name": "E-value (significance) of full-length alignment", Value: clicked_record.e_value, URL: null, style: "font-family:Arial" } );
        arr_data_clicked.push( { "Data Name": "identity (similarity) of full-length alignment", Value: clicked_record.identity, URL: null, style: "font-family:Arial" } );
        arr_data_clicked.push( { "Data Name": "number of redundant alignments", Value: clicked_record.duplicate_counts, URL: null, style: "font-family:Arial" } );
        arr_data_clicked.push( { "Data Name": "correl. coeffi. of accessibility (p-value)", Value: clicked_record.correl_coeffi_acc + " (" + String( clicked_record.correl_p_value_acc ) + ")", URL: null, style: "font-family:Arial" } );
        arr_data_clicked.push( { "Data Name": "correl. coeffi. of torsion angle (phi) (p-value)", Value: clicked_record.correl_coeffi_phi + " (" + String( clicked_record.correl_p_value_phi ) + ")", URL: null, style: "font-family:Arial" } );
        arr_data_clicked.push( { "Data Name": "correl. coeffi. of torsion angle (psi) (p-value)", Value: clicked_record.correl_coeffi_psi + " (" + String( clicked_record.correl_p_value_psi ) + ")", URL: null, style: "font-family:Arial" } );
        arr_data_clicked.push( { "Data Name": "score_blosum", Value: clicked_record.score_blosum, URL: null, style: "font-family:Arial" } );
        arr_data_clicked.push( { "Data Name": "score_blosum_weighted", Value: clicked_record.score_blosum_weighted, URL: null, style: "font-family:Arial" } );
        arr_data_clicked.push( { "Data Name": "score_similarity_ss8", Value: clicked_record.score_similarity_ss8, URL: null, style: "font-family:Arial" } );
        arr_data_clicked.push( { "Data Name": "prop_pdb_evidence_query", Value: clicked_record.prop_pdb_evidence_query, URL: null, style: "font-family:Arial" } );
        arr_data_clicked.push( { "Data Name": "prop_pdb_evidence_target", Value: clicked_record.prop_pdb_evidence_target, URL: null, style: "font-family:Arial" } );
        arr_data_clicked.push( { "Data Name": "sum_of_weights", Value: clicked_record.sum_of_weights, URL: null, style: "font-family:Arial" } );

        DrawD3Table_for_Record_Details( arr_data_clicked );
        document.getElementById( "title_d3_table_metrics" ).innerHTML = "B-Cell Cross-Reactivity Prediction data"; // update table title for 'd3_table_metrics' table
        document.getElementById( "footnote_d3_table_metrics" ).innerHTML = ""; // update table footnote for 'd3_table_metrics' table

        // draw interactive table displaying structural properties of aligned regions
        let alignment_BCellCrossReactivity = arr_data_alignment_human_virus[ clicked_record.id_alignment ], structure_property_human_protein = arr_data_structural_property_human[ clicked_record.query_accession ], structure_property_virus_protein = arr_data_structural_property_virus[ clicked_record.target_accession ];
        let alignment_start = clicked_record.alignment_start - 1, alignment_end = clicked_record.alignment_end, query_start = clicked_record.query_start - 1, query_end = clicked_record.query_end, target_start = clicked_record.target_start - 1, target_end = clicked_record.target_end; // 1-based coordinates to 0-based coordinates // initial start and end positions
        let len_discarded_sequence_alignment = RetrieveDiscardedLength( alignment_BCellCrossReactivity.discarded_regions, alignment_start ), len_discarded_sequence_human = RetrieveDiscardedLength( structure_property_human_protein.discarded_regions, query_start ), len_discarded_sequence_virus = RetrieveDiscardedLength( structure_property_virus_protein.discarded_regions, target_start );
        alignment_start -= len_discarded_sequence_alignment; alignment_end -= len_discarded_sequence_alignment; query_start -= len_discarded_sequence_human; query_end -= len_discarded_sequence_human; target_start -= len_discarded_sequence_virus; target_end -= len_discarded_sequence_virus; // retrieve coordinates excluding discarded regions
        let query_aligned_sequence = alignment_BCellCrossReactivity.query_alignment__compact__for_web_application.slice( alignment_start, alignment_end ), target_aligned_sequence = alignment_BCellCrossReactivity.target_alignment__compact__for_web_application.slice( alignment_start, alignment_end );
        let len_alignment = query_aligned_sequence.length;
        let structure_property_human_sequence = { }, structure_property_virus_sequence = { }; // retrieve and parse structural property of aligned sequences
        structure_property_human_sequence.rsa = Unpack_String_rsa( structure_property_human_protein[ "rsa_combined___ascii_encoding_1_character_from_33_to_126__from_0_to_1__for_web_application__compact__for_web_application" ].slice( query_start, query_end ) )
        structure_property_human_sequence.ss8 = Unpack_String_ss8( structure_property_human_protein[ "ss8_combined___ascii_encoding_1_character_from_33_to_41__states_G_H_I_E_B_T_S_C__compact__for_web_application" ].slice( query_start, query_end ) )
        structure_property_human_sequence.datatype = Unpack_String_datatype( structure_property_human_protein[ "rsa_datatype_combined___ascii_encoding_1_character_from_33_to_36__states_Pred_Model_PDB__compact__for_web_application" ].slice( query_start, query_end ) )
        if ( flag_structure_exist_for_human_sequence ) { 
            structure_property_human_sequence.phi = Unpack_String_torsion_angle( structure_property_human_protein[ "phi___ascii_encoding_1_character_from_33_to_126__from_-180_to_180__for_web_application__compact__for_web_application" ].slice( query_start, query_end ) );
            structure_property_human_sequence.psi = Unpack_String_torsion_angle( structure_property_human_protein[ "psi___ascii_encoding_1_character_from_33_to_126__from_-180_to_180__for_web_application__compact__for_web_application" ].slice( query_start, query_end ) );
            structure_property_human_sequence.structure_id = Unpack_String_structure_id( structure_property_human_protein[ "structure_id__compact__for_web_application" ] ).slice( query_start, query_end );
        }
        structure_property_virus_sequence.rsa = Unpack_String_rsa( structure_property_virus_protein[ "rsa_combined___ascii_encoding_1_character_from_33_to_126__from_0_to_1__for_web_application__compact__for_web_application" ].slice( target_start, target_end ) )
        structure_property_virus_sequence.ss8 = Unpack_String_ss8( structure_property_virus_protein[ "ss8_combined___ascii_encoding_1_character_from_33_to_41__states_G_H_I_E_B_T_S_C__compact__for_web_application" ].slice( target_start, target_end ) )
        structure_property_virus_sequence.datatype = Unpack_String_datatype( structure_property_virus_protein[ "rsa_datatype_combined___ascii_encoding_1_character_from_33_to_36__states_Pred_Model_PDB__compact__for_web_application" ].slice( target_start, target_end ) )
        if ( flag_structure_exist_for_virus_sequence ) { 
            structure_property_virus_sequence.phi = Unpack_String_torsion_angle( structure_property_virus_protein[ "phi_combined___ascii_encoding_1_character_from_33_to_126__from_-180_to_180__for_web_application__compact__for_web_application" ].slice( target_start, target_end ) );
            structure_property_virus_sequence.psi = Unpack_String_torsion_angle( structure_property_virus_protein[ "psi_combined___ascii_encoding_1_character_from_33_to_126__from_-180_to_180__for_web_application__compact__for_web_application" ].slice( target_start, target_end ) );
            structure_property_virus_sequence.structure_id = Unpack_String_structure_id( structure_property_virus_protein[ "structure_id__compact__for_web_application" ] ).slice( target_start, target_end );
        }
        // represent structural property with color 
        structure_property_human_sequence.color_rsa = Color_for_rsa( structure_property_human_sequence.rsa )
        structure_property_human_sequence.color_ss8 = Color_for_ss8( structure_property_human_sequence.ss8 )
        structure_property_human_sequence.color_datatype = Color_for_datatype( structure_property_human_sequence.datatype )
        if ( flag_structure_exist_for_human_sequence ) { 
            structure_property_human_sequence.color_phi = Color_for_torsion_angle( structure_property_human_sequence.phi )
            structure_property_human_sequence.color_psi = Color_for_torsion_angle( structure_property_human_sequence.psi )
            structure_property_human_sequence.color_structure_id = Color_for_structure_id( structure_property_human_sequence.structure_id )
        }

        structure_property_virus_sequence.color_rsa = Color_for_rsa( structure_property_virus_sequence.rsa )
        structure_property_virus_sequence.color_ss8 = Color_for_ss8( structure_property_virus_sequence.ss8 )
        structure_property_virus_sequence.color_datatype = Color_for_datatype( structure_property_virus_sequence.datatype )
        if ( flag_structure_exist_for_virus_sequence ) { 
            structure_property_virus_sequence.color_phi = Color_for_torsion_angle( structure_property_virus_sequence.phi )
            structure_property_virus_sequence.color_psi = Color_for_torsion_angle( structure_property_virus_sequence.psi )
            structure_property_virus_sequence.color_structure_id = Color_for_structure_id( structure_property_virus_sequence.structure_id )
        }

        // align retrieved structure property using the alignment
        structure_property_human_sequence = Align_Structural_Property( structure_property_human_sequence, query_aligned_sequence );
        structure_property_virus_sequence = Align_Structural_Property( structure_property_virus_sequence, target_aligned_sequence );
        structure_property_human_sequence.seq = query_aligned_sequence.split( "" ); // add aligned sequence to the data
        structure_property_virus_sequence.seq = target_aligned_sequence.split( "" );
        let l_score_blosum = [ ], l_score_blosum_human = [ ], l_score_blosum_virus = [ ], pos_virus = clicked_record.target_start - 1, pos_human = clicked_record.query_start - 1;
        object_pdb_human.dict_index_alignment_to_pos_human = { }, object_pdb_virus.dict_index_alignment_to_pos_virus = { };
        for ( let i = 0; i < query_aligned_sequence.length; i ++ ) { 
            let score_blosum62 = Math.round( dict_blosum62[ query_aligned_sequence[ i ] + target_aligned_sequence[ i ] ] ), residue_human = query_aligned_sequence[ i ], residue_virus = target_aligned_sequence[ i ]; // round the blosum score so that step become 1
            l_score_blosum.push( score_blosum62 );
            // retrieve blosum score for human and virus sequence
            if ( residue_human == '-' ) {
                pos_virus += 1;
                l_score_blosum_virus.push( score_blosum62 );
                object_pdb_virus.dict_index_alignment_to_pos_virus[ i ] = pos_virus;
            } else if ( residue_virus == '-' ) {
                pos_human += 1;
                l_score_blosum_human.push( score_blosum62 );
                object_pdb_human.dict_index_alignment_to_pos_human[ i ] = pos_human;
            } else {
                pos_human += 1; pos_virus += 1;
                l_score_blosum_human.push( score_blosum62 );
                l_score_blosum_virus.push( score_blosum62 );
                object_pdb_virus.dict_index_alignment_to_pos_virus[ i ] = pos_virus;
                object_pdb_human.dict_index_alignment_to_pos_human[ i ] = pos_human;
            }
        }
        let l_color_score_blosum = Color_for_score_blosum( l_score_blosum ), l_color_score_blosum_human = Color_for_score_blosum( l_score_blosum_human ), l_color_score_blosum_virus = Color_for_score_blosum( l_score_blosum_virus ); // retrieve colors for blosum scores

        console.log( "structural property human sequence:", structure_property_human_sequence );
        console.log( "structural property virus sequence:", structure_property_virus_sequence );
        // draw Plotly table for aligned sequences
        object_data_tableSequence.flag_data_type = "B-Cell";
        let colors = [ ], values = [ ], header = [ ], l_col = [ ];
        if ( flag_structure_exist_for_virus_sequence ) { 
            l_col.push( ... [ 'virus_structure_id', 'virus_psi', 'virus_phi' ] );
            values.push( ... [ structure_property_virus_sequence.structure_id, structure_property_virus_sequence.psi, structure_property_virus_sequence.phi ] );
            colors.push( ... [ structure_property_virus_sequence.color_structure_id, structure_property_virus_sequence.color_psi, structure_property_virus_sequence.color_phi ] );
        }
        l_col.push( ... [ 'virus_datatype', 'virus_ss8', 'virus_rsa', 'virus_seq' ] );
        values.push( ... [ structure_property_virus_sequence.datatype, structure_property_virus_sequence.ss8, structure_property_virus_sequence.rsa, structure_property_virus_sequence.seq ] );
        colors.push( ... [ structure_property_virus_sequence.color_datatype, structure_property_virus_sequence.color_ss8, structure_property_virus_sequence.color_rsa, ArrayFull( len_alignment, "#ffffff" ) ] );
        l_col.push( 'score_blosum62' );
        values.push( l_score_blosum );
        colors.push( l_color_score_blosum );
        l_col.push( ... [ 'human_seq', 'human_rsa', 'human_ss8', 'human_datatype' ] );
        values.push( ... [ structure_property_human_sequence.seq, structure_property_human_sequence.rsa, structure_property_human_sequence.ss8, structure_property_human_sequence.datatype ] );
        colors.push( ... [ ArrayFull( len_alignment, "#ffffff" ), structure_property_human_sequence.color_rsa, structure_property_human_sequence.color_ss8, structure_property_human_sequence.color_datatype ] );
        if ( flag_structure_exist_for_human_sequence ) { 
            l_col.push( ... [ 'human_phi', 'human_psi', 'human_structure_id' ] );
            values.push( ... [ structure_property_human_sequence.phi, structure_property_human_sequence.psi, structure_property_human_sequence.structure_id ] );
            colors.push( ... [ structure_property_human_sequence.color_phi, structure_property_human_sequence.color_psi, structure_property_human_sequence.color_structure_id ] );
        }
        for ( let i = 0; i < l_col.length; i ++ ) { header.push( [ "<b>" + l_col[ i ] + "</b>" ] ); } // build header from 'l_col'
        let data = [{
            type: 'table', 
            header: { values: header, align: "center", height: 30, line: {width: 1, color: '#506784'}, fill: {color: '#f0f0f0'}, font: {family: "Arial", size: 12, color: "black"} },
            cells: {values: values, align: "center", height: 20, line: {color: colors, width: 1}, fill: {color: colors }, font: {family: "Arial", size: 12, color: ["#3d3d3d"] }}
        }]

        document.getElementById( "plotly_table_sequence" ).style.height = String( Math.min( 20 * int_n_residues_per_window_table_sequence + 30 + 10, parseInt( l_score_blosum.length * 20 + 30 + 10 ) ) ) + "px" // set height of table according to the length of alignment # max height is 640
        object_data_tableSequence.len_alignment = l_score_blosum.length; // retrieve the length of the alignment
        str_jquery_container = "#container_plotly_table_sequence";
        if ( $( str_jquery_container ).hasClass( "collapse" ) && $( str_jquery_container ).hasClass( "show" ) ) { Plotly.newPlot( tableSequence, data, lodash.cloneDeep( layout_tableSequence ), config_MolecularMimicryMap ); Add_Click_Callback_Aligned_Sequence_Table( ); // draw Plotly plot synchronously if the container is currently shown
        } else { BootstrapCollapseShownPromise( str_jquery_container ).then( ( ) => { Plotly.newPlot( tableSequence, data, lodash.cloneDeep( layout_tableSequence ), config_MolecularMimicryMap ); Add_Click_Callback_Aligned_Sequence_Table( ); } ); } // draw Plotly plot once the container is shown if the container is currently hidden

        // Render molecular structures using the Mol* JS application
        str_jquery_container = "#container_PDB";
        let pos_protein = 0, pos_pdb = 0;
        if ( flag_structure_exist_for_human_sequence ) { 
            object_pdb_human = Object.assign( object_pdb_human, arr_data_acc_pdb[ clicked_record.structure_id_query ] );
            object_pdb_human.id_chain = String( object_pdb_human.id_chain ) // 'auth_asym_id' should be a string
            object_pdb_human.start_pdb = clicked_record.structure_id_query_start;
            object_pdb_human.end_pdb = clicked_record.structure_id_query_end;
            object_pdb_human.alignment = { data: arr_data_alignment_human_pdb[ clicked_record.id_alignment_structure_query ], start: clicked_record.alignment_structure_query_start - 1, end: clicked_record.alignment_structure_query_end } // retrieve alignment data // 0-based coordinates
            object_pdb_human.alignment.data.len_discarded_sequence = RetrieveDiscardedLength( object_pdb_human.alignment.data.discarded_regions, object_pdb_human.alignment.start );
            object_pdb_human.alignment.start -= object_pdb_human.alignment.data.len_discarded_sequence;
            object_pdb_human.alignment.end -= object_pdb_human.alignment.data.len_discarded_sequence;
            object_pdb_human.aligned_sequence_pdb = object_pdb_human.alignment.data.target_alignment__compact__for_web_application.slice( object_pdb_human.alignment.start, object_pdb_human.alignment.end );
            object_pdb_human.aligned_sequence_protein = object_pdb_human.alignment.data.query_alignment__compact__for_web_application.slice( object_pdb_human.alignment.start, object_pdb_human.alignment.end );
            object_pdb_human.start_protein = clicked_record.query_structure_start;
            object_pdb_human.end_protein = clicked_record.query_structure_end;
            object_pdb_human.l_color_score_blosum_protein = l_color_score_blosum_human.slice( clicked_record.query_start - clicked_record.query_structure_start, l_color_score_blosum_human.length - ( clicked_record.query_end - clicked_record.query_structure_end ) );

            object_pdb_human.dict_pos_human_to_pos_pdb_human = { }, object_pdb_human.dict_index_alignment_to_pos_pdb_human = { };
            pos_protein = - 1, pos_pdb = object_pdb_human.start_pdb - 1, object_pdb_human.l_color_score_blosum_pdb = [ ];
            for ( let i = 0; i < object_pdb_human.aligned_sequence_pdb.length; i ++ ) {
                if ( object_pdb_human.aligned_sequence_pdb[ i ] == '-' ) { 
                    pos_protein += 1;
                    object_pdb_human.dict_pos_human_to_pos_pdb_human[ pos_protein + object_pdb_human.start_protein ] = pos_pdb;
                }
                else if ( object_pdb_human.aligned_sequence_protein[ i ] == '-' ) { 
                    pos_pdb += 1;
                    object_pdb_human.l_color_score_blosum_pdb.push( null );
                } // if there is a gap in the protein (so the residue in pdb does not exist in the protein sequence, push null value representing an invalid color)
                else { 
                    pos_protein += 1; pos_pdb += 1;
                    object_pdb_human.l_color_score_blosum_pdb.push( object_pdb_human.l_color_score_blosum_protein[ pos_protein ] );
                    object_pdb_human.dict_pos_human_to_pos_pdb_human[ pos_protein + object_pdb_human.start_protein ] = pos_pdb;
                }
            }
            for ( let i = 0; i < object_data_tableSequence.len_alignment; i ++ ) {
                object_pdb_human.dict_index_alignment_to_pos_pdb_human[ i ] = object_pdb_human.dict_pos_human_to_pos_pdb_human[ object_pdb_human.dict_index_alignment_to_pos_human[ i ] ];
            }
            object_pdb_human.option_update = { landscape: true, bgColor: {r:255,g:255,b:255}, hideControls: true, hideStructure: [ 'water', 'carbs' ] };
            if ( object_pdb_human.value.includes( "_source_" ) ) { object_pdb_human.option_update.customData = { url: "https://raw.githubusercontent.com/ahs2202/3M/master/current/custom_cif/" + object_pdb_human.value + ".cif", format: 'cif', binary: false }; } // if structure is structural model, retrieve data from github
            else { // use coordinate server to retrieve coordinates of a specific chain if the structure belongs to RCSB PDB db
                object_pdb_human.option_update.customData = { url: "https://www.ebi.ac.uk/pdbe/coordinates/" + object_pdb_human.id_pdb + "/chains?entityId=" + object_pdb_human.id_entity + "&authAsymId=" + object_pdb_human.id_chain + "&encoding=bcif", binary: true, format: 'cif' }; 
                if ( object_pdb_human.id_model != null ) { object_pdb_human.option_update.customData.url += "&modelId=" + object_pdb_human.id_model; } // use id_model to retrieve specific coordinates if it is available
            } 
            object_pdb_human.selection_showing_side_chain = [ ], object_pdb_human.selection = [ ];
            for ( let i = 0; i < object_pdb_human.l_color_score_blosum_pdb.length; i ++ ) {
                let color = object_pdb_human.l_color_score_blosum_pdb[ i ], pos = object_pdb_human.start_pdb + i;
                if ( color === null ) { continue; }
                object_pdb_human.selection_showing_side_chain.push( { auth_asym_id: object_pdb_human.id_chain, start_residue_number: pos, end_residue_number: pos, sideChain: true, color: color } );
                object_pdb_human.selection.push( { auth_asym_id: object_pdb_human.id_chain, start_residue_number: pos, end_residue_number: pos, color: color } );
            }
            object_pdb_human.bool_flag_selected = false, object_pdb_human.bool_flag_focused = false; // set viewer setting
            if ( $( str_jquery_container ).hasClass( "collapse" ) && $( str_jquery_container ).hasClass( "show" ) ) { pdbHumanProtein.visual.update( object_pdb_human.option_update ); MolStarRenderCompletePromise( pdbHumanProtein ).then( Select_View_of_PDB_Human_Protein ); // render coordinates synchronously if the container is currently shown // then select the subsequence once loading is completed
            } else { BootstrapCollapseShownPromise( str_jquery_container ).then( ( ) => { pdbHumanProtein.visual.update( object_pdb_human.option_update ); MolStarRenderCompletePromise( pdbHumanProtein ).then( Select_View_of_PDB_Human_Protein ); } ); } // render coordinates once the container is shown if the container is currently hidden // then select the subsequence once loading is completed
        } else {  // show dummy if coordinates are not available
            if ( $( str_jquery_container ).hasClass( "collapse" ) && $( str_jquery_container ).hasClass( "show" ) ) { pdbHumanProtein.visual.update( option_initialization_molstar );; // render coordinates synchronously if the container is currently shown
            } else { BootstrapCollapseShownPromise( str_jquery_container ).then( ( ) => { pdbHumanProtein.visual.update( option_initialization_molstar ); } ); } // render coordinates once the container is shown if the container is currently hidden
        }
        if ( flag_structure_exist_for_virus_sequence ) { 
            object_pdb_virus = Object.assign( object_pdb_virus, arr_data_acc_pdb[ clicked_record.structure_id_target ] );
            object_pdb_virus.id_chain = String( object_pdb_virus.id_chain ) // 'auth_asym_id' should be a string
            object_pdb_virus.start_pdb = clicked_record.structure_id_target_start;
            object_pdb_virus.end_pdb = clicked_record.structure_id_target_end;
            object_pdb_virus.alignment = { data: arr_data_alignment_virus_pdb[ clicked_record.id_alignment_structure_target ], start: clicked_record.alignment_structure_target_start - 1, end: clicked_record.alignment_structure_target_end } // retrieve alignment data // 0-based coordinates
            object_pdb_virus.alignment.data.len_discarded_sequence = RetrieveDiscardedLength( object_pdb_virus.alignment.data.discarded_regions, object_pdb_virus.alignment.start );
            object_pdb_virus.alignment.start -= object_pdb_virus.alignment.data.len_discarded_sequence;
            object_pdb_virus.alignment.end -= object_pdb_virus.alignment.data.len_discarded_sequence;
            object_pdb_virus.aligned_sequence_pdb = object_pdb_virus.alignment.data.target_alignment__compact__for_web_application.slice( object_pdb_virus.alignment.start, object_pdb_virus.alignment.end );
            object_pdb_virus.aligned_sequence_protein = object_pdb_virus.alignment.data.target_alignment__compact__for_web_application.slice( object_pdb_virus.alignment.start, object_pdb_virus.alignment.end );
            object_pdb_virus.start_protein = clicked_record.target_structure_start;
            object_pdb_virus.end_protein = clicked_record.target_structure_end;
            object_pdb_virus.l_color_score_blosum_protein = l_color_score_blosum_virus.slice( clicked_record.target_start - clicked_record.target_structure_start, l_color_score_blosum_virus.length - ( clicked_record.target_end - clicked_record.target_structure_end ) );

            object_pdb_virus.dict_pos_virus_to_pos_pdb_virus = { }, object_pdb_virus.dict_index_alignment_to_pos_pdb_virus = { };
            pos_protein = - 1, pos_pdb = object_pdb_virus.start_pdb - 1, object_pdb_virus.l_color_score_blosum_pdb = [ ];
            for ( let i = 0; i < object_pdb_virus.aligned_sequence_pdb.length; i ++ ) {
                if ( object_pdb_virus.aligned_sequence_pdb[ i ] == '-' ) { 
                    pos_protein += 1;
                    object_pdb_virus.dict_pos_virus_to_pos_pdb_virus[ pos_protein + object_pdb_virus.start_protein ] = pos_pdb;
                }
                else if ( object_pdb_virus.aligned_sequence_protein[ i ] == '-' ) { 
                    pos_pdb += 1;
                    object_pdb_virus.l_color_score_blosum_pdb.push( null );
                } // if there is a gap in the protein (so the residue in pdb does not exist in the protein sequence, push null value representing an invalid color)
                else { 
                    pos_protein += 1; pos_pdb += 1;
                    object_pdb_virus.l_color_score_blosum_pdb.push( object_pdb_virus.l_color_score_blosum_protein[ pos_protein ] );
                    object_pdb_virus.dict_pos_virus_to_pos_pdb_virus[ pos_protein + object_pdb_virus.start_protein ] = pos_pdb;
                }
            }
            for ( let i = 0; i < object_data_tableSequence.len_alignment; i ++ ) {
                object_pdb_virus.dict_index_alignment_to_pos_pdb_virus[ i ] = object_pdb_virus.dict_pos_virus_to_pos_pdb_virus[ object_pdb_virus.dict_index_alignment_to_pos_virus[ i ] ];
            }
            object_pdb_virus.option_update = { landscape: true, bgColor: {r:255,g:255,b:255}, hideControls: true, hideStructure: [ 'water', 'carbs' ] };
            if ( object_pdb_virus.value.includes( "_source_" ) ) { object_pdb_virus.option_update.customData = { url: "https://raw.githubusercontent.com/ahs2202/3M/master/current/custom_cif/" + object_pdb_virus.value + ".cif", format: 'cif', binary: false }; } // if structure is structural model, retrieve data from github
            else { // use coordinate server to retrieve coordinates of a specific chain if the structure belongs to RCSB PDB db
                object_pdb_virus.option_update.customData = { url: "https://www.ebi.ac.uk/pdbe/coordinates/" + object_pdb_virus.id_pdb + "/chains?entityId=" + object_pdb_virus.id_entity + "&authAsymId=" + object_pdb_virus.id_chain + "&encoding=bcif", binary: true, format: 'cif' }; 
                if ( object_pdb_virus.id_model != null ) { object_pdb_virus.option_update.customData.url += "&modelId=" + object_pdb_virus.id_model; } // use id_model to retrieve specific coordinates if it is available
            } 
            object_pdb_virus.selection_showing_side_chain = [ ], object_pdb_virus.selection = [ ];
            for ( let i = 0; i < object_pdb_virus.l_color_score_blosum_pdb.length; i ++ ) {
                let color = object_pdb_virus.l_color_score_blosum_pdb[ i ], pos = object_pdb_virus.start_pdb + i;
                if ( color === null ) { continue; }
                object_pdb_virus.selection_showing_side_chain.push( { auth_asym_id: object_pdb_virus.id_chain, start_residue_number: pos, end_residue_number: pos, sideChain: true, color: color } );
                object_pdb_virus.selection.push( { auth_asym_id: object_pdb_virus.id_chain, start_residue_number: pos, end_residue_number: pos, color: color } );
            }
            object_pdb_virus.bool_flag_selected = false, object_pdb_virus.bool_flag_focused = false; // set viewer setting
            if ( $( str_jquery_container ).hasClass( "collapse" ) && $( str_jquery_container ).hasClass( "show" ) ) { pdbVirusProtein.visual.update( object_pdb_virus.option_update ); MolStarRenderCompletePromise( pdbVirusProtein ).then( Select_View_of_PDB_Virus_Protein ); // render coordinates synchronously if the container is currently shown // then select the subsequence once loading is completed
            } else { BootstrapCollapseShownPromise( str_jquery_container ).then( ( ) => { pdbVirusProtein.visual.update( object_pdb_virus.option_update ); MolStarRenderCompletePromise( pdbVirusProtein ).then( Select_View_of_PDB_Virus_Protein ); } ); } // render coordinates once the container is shown if the container is currently hidden // then select the subsequence once loading is completed
        } else {  // show dummy if coordinates are not available
            if ( $( str_jquery_container ).hasClass( "collapse" ) && $( str_jquery_container ).hasClass( "show" ) ) { pdbVirusProtein.visual.update( option_initialization_molstar );; // render coordinates synchronously if the container is currently shown
            } else { BootstrapCollapseShownPromise( str_jquery_container ).then( ( ) => { pdbVirusProtein.visual.update( option_initialization_molstar ); } ); } // render coordinates once the container is shown if the container is currently hidden
        }
        document.getElementById( "description_clicked_position__table_sequence" ).innerHTML = "";
    }
    
    var color_pdb_highlight = {r:255,g:255,b:0};
    function Highlight_PDB_Residue__Click_Callback__Aligned_Sequence_Table( event ) {
        let height_cell_value = 20, height_cell_header = 30, n_extra_pixels = 4; // it seems a couple of extra pixels added to the top of the slider. To account this, the silder height will be expanded by 2 * this_value
        let str_description = "";
        let object_slider_boundary = object_data_tableSequence.object_slider.getBoundingClientRect( );
        let object_table_boundary = tableSequence.getBoundingClientRect( );
        object_data_tableSequence.object_slider_boundary = object_slider_boundary;
        object_data_tableSequence.object_table_boundary = object_table_boundary;
        object_data_tableSequence.mouse_event = event;
        object_data_tableSequence.table_body_range = { top: object_table_boundary.top + height_cell_header + layout_tableSequence.margin.t, bottom: object_table_boundary.bottom - layout_tableSequence.margin.b };
        object_data_tableSequence.table_body_range.height = object_data_tableSequence.table_body_range.bottom - object_data_tableSequence.table_body_range.top;
        object_data_tableSequence.table_body_range.n_rows_per_window = object_data_tableSequence.table_body_range.height / height_cell_value;
        if ( Math.round( object_data_tableSequence.table_body_range.n_rows_per_window ) < object_data_tableSequence.len_alignment ) { // if slider is present, calculate hidden height above the currently shown window.
            object_data_tableSequence.silder_range = { top: object_data_tableSequence.table_body_range.top + n_extra_pixels, bottom: object_data_tableSequence.table_body_range.bottom - object_slider_boundary.height - n_extra_pixels }; 
            object_data_tableSequence.silder_relative_position = ( object_slider_boundary.top - object_data_tableSequence.silder_range.top ) / ( object_data_tableSequence.silder_range.bottom - object_data_tableSequence.silder_range.top ); 
            object_data_tableSequence.hidden_height = ( object_data_tableSequence.len_alignment - object_data_tableSequence.table_body_range.n_rows_per_window ) * height_cell_value * object_data_tableSequence.silder_relative_position;
        } else {
            object_data_tableSequence.hidden_height = 0;
        }
        object_data_tableSequence.clicked_pos_alignment = parseInt( ( object_data_tableSequence.mouse_event.clientY - object_data_tableSequence.table_body_range.top + object_data_tableSequence.hidden_height ) / height_cell_value );
        str_description += "position in the alignment: " + String( object_data_tableSequence.clicked_pos_alignment );
        // retrieve position of human and virus protein structure of the clicked residue in the alignment table
        object_data_tableSequence.clicked_pos_pdb_human = parseInt( object_pdb_human.dict_index_alignment_to_pos_pdb_human[ object_data_tableSequence.clicked_pos_alignment ] ); 
        object_data_tableSequence.clicked_pos_pdb_virus = parseInt( object_pdb_virus.dict_index_alignment_to_pos_pdb_virus[ object_data_tableSequence.clicked_pos_alignment ] );
        object_data_tableSequence.clicked_pos_human = parseInt( object_pdb_human.dict_index_alignment_to_pos_human[ object_data_tableSequence.clicked_pos_alignment ] ); 
        object_data_tableSequence.clicked_pos_virus = parseInt( object_pdb_virus.dict_index_alignment_to_pos_virus[ object_data_tableSequence.clicked_pos_alignment ] );

        if( ! isNaN( object_data_tableSequence.clicked_pos_pdb_human ) ) {
            pdbHumanProtein.visual.highlight( { data: [ { auth_asym_id: object_pdb_human.id_chain, start_residue_number: object_data_tableSequence.clicked_pos_pdb_human, end_residue_number: object_data_tableSequence.clicked_pos_pdb_human } ], color: color_pdb_highlight } )
            str_description += ", position on the human protein (structure): " + String( object_data_tableSequence.clicked_pos_human ) + " (" + String( object_data_tableSequence.clicked_pos_pdb_human ) + ")";
        }
        if( ! isNaN( object_data_tableSequence.clicked_pos_pdb_virus ) ) {
            pdbVirusProtein.visual.highlight( { data: [ { auth_asym_id: object_pdb_virus.id_chain, start_residue_number: object_data_tableSequence.clicked_pos_pdb_virus, end_residue_number: object_data_tableSequence.clicked_pos_pdb_virus } ], color: color_pdb_highlight } )
            str_description += ", position on the virus protein (structure): " + String( object_data_tableSequence.clicked_pos_virus ) + " (" + String( object_data_tableSequence.clicked_pos_pdb_virus ) + ")";
        }
        document.getElementById( "description_clicked_position__table_sequence" ).innerHTML = str_description; // update description
        console.log( "[Add_Click_Callback_Aligned_Sequence_Table] position in alignment is : ", object_data_tableSequence.clicked_pos_alignment );
    }
    function Add_Click_Callback_Aligned_Sequence_Table( ) {
        if ( "removeAllListeners" in tableSequence ) { tableSequence.removeAllListeners( "click" ); } // remove previous listeners if a listener exists
        object_data_tableSequence.object_slider = $( "#plotly_table_sequence g.table g.scrollbar-slider" )[ 0 ]; // retrieve slider
        tableSequence.addEventListener( "click", Highlight_PDB_Residue__Click_Callback__Aligned_Sequence_Table ); // add callbacks
    }
    function Responsive_Column_Width_Aligned_Sequence_Table_TCellCrossReactivity( event ) { // a callback function to adjust Aligned_Sequence_Table for TCellCrossReactivity record when web page width was changed
        if ( object_data_tableSequence.flag_data_type != "T-Cell" ) { return; } // only resize table when tableSequence object is for T-Cell CrossReactivity record
        let width_col_seq = 100, width_max_col_score = 300; // width of columns containing a.a. sequence in pixels
        let width_window = tableSequence.getBoundingClientRect( ).width;
        arr_width_col = nj.array( [ width_col_seq, Math.min( width_window - 2 * width_col_seq, width_max_col_score ), width_col_seq ] );
        let margin_horizontal = ( width_window - arr_width_col.sum( ) ) / 2;
        object_data_tableSequence.data[ 0 ].columnwidth = arr_width_col.divide( arr_width_col.sum( ) ).tolist( );
        Plotly.newPlot( tableSequence, object_data_tableSequence.data, { margin: { l: Math.max( margin_horizontal - 7.5, 0 ), r: Math.max( margin_horizontal + 7.5, 15 ), t: layout_tableSequence.margin.t, b: layout_tableSequence.margin.b } }, config_MolecularMimicryMap );
    }
    // trigger functions when window size changes
    $(window).resize( function( ) {
        Responsive_Column_Width_Aligned_Sequence_Table_TCellCrossReactivity( );
    });
    function Retrieve_Selection_Mode_Using_Keydown_Status_VaccineDesign( ) { // retrieve selection mode using keydown status
        let key_include = 'a', key_exclude = 'r';
        let bool_flag_include = key_include in object_data_keydown.dict_status && object_data_keydown.dict_status[ key_include ] != 'keyup';
        let bool_flag_exclude = key_exclude in object_data_keydown.dict_status && object_data_keydown.dict_status[ key_exclude ] != 'keyup';
        if ( bool_flag_include && ! bool_flag_exclude ) { return "Include"; }
        else if ( ! bool_flag_include && bool_flag_exclude ) { return "Exclude"; }
        else { return "Show_Info"; }
    }
    
    function Set_Visibility_of_Consensus_Protein_Sequence_Virus( ) { // set visibility of consensus protein sequence based on number of residues displayed on the window
        object_data_consensus_sequence_virus.window_width = plotMolecularMimicryMap.offsetWidth; // retrieve the width of the "molecular mimicry map" plot in number of pixels 
        let x_range = plotMolecularMimicryMap.layout.xaxis.range;
        object_data_consensus_sequence_virus.n_residues_displayed = x_range[ 1 ] - x_range[ 0 ]; // retrieve number of plotted residues
        object_data_consensus_sequence_virus.show = object_data_consensus_sequence_virus.n_residues_displayed / object_data_consensus_sequence_virus.window_width <= ( 160 / 1270 ) // if more than 160residues/1270pixels are displayed, hide the protein sequence trace
        let index_trace = object_data_consensus_sequence_virus.index_trace_start; // only trace for 'object_data_consensus_sequence_virus' is consensus sequence trace
        if ( plotMolecularMimicryMap.data[ index_trace ].visible != object_data_consensus_sequence_virus.show ) { // if current visibility is different with previous visibility, update the visibility
            Plotly.restyle( plotMolecularMimicryMap, { visible: object_data_consensus_sequence_virus.show }, index_trace );
        }
    }
    // Modification of plots using buttons and functions
    function Toggle_Hovermode_MolecularMimicryMap( ) { // toggle hovermode
        console.log( object_plot_MolecularMimicryMap.hovermode );
        object_plot_MolecularMimicryMap.hovermode = object_plot_MolecularMimicryMap.hovermode == false ? "closest" : false; // toggle hovermode
        if ( ! ( "data" in plotMolecularMimicryMap ) ) { return; } // if a plot has not been drawn, do not modify layout
        let hovermode_previous = plotMolecularMimicryMap.data[ 0 ].hovermode, hovermode_current = object_plot_MolecularMimicryMap.hovermode;
        console.log( "hovermode is being set to ", hovermode_current, "..." );
        if ( ( hovermode_previous == undefined && hovermode_current == false ) || ( hovermode_previous != hovermode_current ) ) { Plotly.relayout( plotMolecularMimicryMap, { hovermode: hovermode_current } ); }
        console.log( "done." );
    }
    function Toggle_VirusProteinAnnotation_MolecularMimicryMap( ) { // toggle SARS-CoV-2 VirusProteinAnnotation
        object_annotation_representative_virus_protein.show = document.getElementById( "checkbox_toggle_VirusProteinAnnotation_MolecularMimicryMap" ).checked; // toggle 
        if ( object_annotation_representative_virus_protein.data.length > 0 ) { Plotly.restyle( plotMolecularMimicryMap, { visible: object_annotation_representative_virus_protein.show }, nj.arange( object_annotation_representative_virus_protein.index_trace_start, object_data_consensus_sequence_virus.index_trace_end ).tolist( ) ); } // set visibility based on the toggled flag for the visibiligy of the track
        Set_Visibility_of_Consensus_Protein_Sequence_Virus( ); // set visibility of consensus protein sequence
    }
    function Toggle_IEDB_Epitope_Virus_MolecularMimicryMap( ) {
        object_data_iedb_epitope_virus.show = document.getElementById( "checkbox_toggle_iedb_epitope_virus_MolecularMimicryMap" ).checked; // set visibility of IEDB epitopes of SARS-CoV-2
        if ( object_data_iedb_epitope_virus.data.length > 0 ) { Plotly.restyle( plotMolecularMimicryMap, { visible: object_data_iedb_epitope_virus.show }, nj.arange( object_data_iedb_epitope_virus.index_trace_start, object_data_iedb_epitope_virus.index_trace_end ).tolist( ) ); } // set visibility based on the toggled flag for the visibiligy of the track
    }
    function Toggle_VaccineDesign_MolecularMimicryMap( ) {
        object_data_vaccine_design.show = document.getElementById( "checkbox_toggle_vaccine_design_MolecularMimicryMap" ).checked; // set visibility of the vaccine design trace
        if ( object_data_vaccine_design.data.length > 0 ) { Plotly.restyle( plotMolecularMimicryMap, { visible: object_data_vaccine_design.show }, nj.arange( object_data_vaccine_design.index_trace_start, object_data_vaccine_design.index_trace_end ).tolist( ) ); } // set visibility based on the toggled flag for the visibiligy of the track
    }
    function Toggle_Legend_MolecularMimicryMap( ) { // toggle the legend of the molecular mimicry map graph
        let l_name_trace = [ "B Cell Cross-Reactivity Prediction",
                             "IEDB_Epitopes__Positive_B_Cell_Assays",
                             "IEDB_Epitopes__Positive_T_Cell_Assays",
                             "T Cell Cross-Reactivity Prediction (Human)",
                             "T Cell Cross-Reactivity Prediction (Virus)",
                             "vaccine_design" ];
        l_name_trace.push( ... object_data_vaccine_metric.l_name_data )
        let l_index_trace = [ ]; // list of indices for toggling legend labels
        for ( let i = 0; i < l_name_trace.length; i ++ ) {
            let name_trace = l_name_trace[ i ];
            if ( name_trace in dict_name_plot_to_trace_index__MolecularMimicryMap ) {
                l_index_trace.push( dict_name_plot_to_trace_index__MolecularMimicryMap[ name_trace ] );
            }
        }
        if ( l_index_trace.length == 0 ) { console.log( "[Toggle_Legend_MolecularMimicryMap] no traces drawn. exiting." ); return; }
        object_plot_MolecularMimicryMap.showlegend = ! plotMolecularMimicryMap.data[ 0 ].showlegend; // retrieve toggled 'showlegend' status
        Plotly.restyle( plotMolecularMimicryMap, { showlegend : object_plot_MolecularMimicryMap.showlegend }, l_index_trace ); // toggle legend labels
        console.log( "[Toggle_Legend_MolecularMimicryMap] legend labels " + ( object_plot_MolecularMimicryMap.showlegend? "shown" : "hidden" ) );
    }
    
    function Toggle_BCellCrossReactivityPrediction_MolecularMimicryMap( ) { // toggle BCellCrossReactivityPrediction data
        object_plot_BCellCrossReactivity.show = document.getElementById( "checkbox_toggle_BCellCrossReactivityPrediction_MolecularMimicryMap" ).checked;
        let l_index_trace_BCellCrossReactivity = [ ];
        for ( let index_trace = object_plot_BCellCrossReactivity.index_trace_start; index_trace < object_plot_BCellCrossReactivity.index_trace_end; index_trace ++ ) { l_index_trace_BCellCrossReactivity.push( index_trace ); } // retrieve indices of traces for the BCellCrossReactivity data
        if ( object_plot_BCellCrossReactivity.l_error_x.length > 0 ) { Plotly.restyle( plotMolecularMimicryMap, { visible: object_plot_BCellCrossReactivity.show }, l_index_trace_BCellCrossReactivity ); } // set visibility 
    }
    function Toggle_TCellCrossReactivityPrediction_MolecularMimicryMap( ) { // toggle BCellCrossReactivityPrediction data
        object_plot_TCellCrossReactivity.show = document.getElementById( "checkbox_toggle_TCellCrossReactivityPrediction_MolecularMimicryMap" ).checked;
        let l_index_trace_TCellCrossReactivity = [ dict_name_plot_to_trace_index__MolecularMimicryMap[ "T Cell Cross-Reactivity Prediction (Human)" ], dict_name_plot_to_trace_index__MolecularMimicryMap[ "T Cell Cross-Reactivity Prediction (Virus)" ] ];
        if ( object_plot_TCellCrossReactivity.l_error_x.length > 0 ) { Plotly.restyle( plotMolecularMimicryMap, { visible: object_plot_TCellCrossReactivity.show }, l_index_trace_TCellCrossReactivity ); } // set visibility 
    }
    
    var str_value_to_highlight = "A1Z1Q3";
    // setting for highlight
    var float_line_width_when_highlighting = 2, float_line_width_when_not_highlighting = 0, color_when_highlighting = 'black';
    function Highlight_MolecularMimicryMap( ) { // Highlight specific records in MolecularMimicryMap data 
        let input = document.getElementById( "input_highlight_value" ).value;
        if ( input.length > 0 ) { // if input is value
            str_value_to_highlight = input;
            // currently only supports acc_human
            if ( str_value_to_highlight in dictionary_acc_human_to_integer_index ) {
//                 console.log( dictionary_acc_human_BCellCrossReactivity[ dictionary_acc_human_to_integer_index[ str_value_to_highlight ][ 0 ] ] );
                let int_acc_human = dictionary_acc_human_to_integer_index[ str_value_to_highlight ][ 0 ], l_opacity = [ ], l_opacity_modified = [ ], l_error_x = [ ], l_error_x_modified = [ ];
                if ( int_acc_human in dictionary_acc_human_BCellCrossReactivity ) { // highlight BCellCrossReactivity
                    let l_indices_to_highlight_BCellCrossReactivity = dictionary_acc_human_BCellCrossReactivity[ int_acc_human ];
                    l_opacity = object_plot_BCellCrossReactivity.selection.l_opacity, l_opacity_modified = ArrayFull( object_plot_BCellCrossReactivity.n_records, 0 ), l_error_x = object_plot_BCellCrossReactivity.selection.l_error_x, l_error_x_modified = ArrayFull( object_plot_BCellCrossReactivity.n_records, 0 ); // initialize array of opacities and l_error_x 
                    for ( let i = 0; i < l_indices_to_highlight_BCellCrossReactivity.length; i ++ ) { l_opacity_modified[ l_indices_to_highlight_BCellCrossReactivity[ i ] ] = l_opacity[ l_indices_to_highlight_BCellCrossReactivity[ i ] ]; l_error_x_modified[ l_indices_to_highlight_BCellCrossReactivity[ i ] ] = l_error_x[ l_indices_to_highlight_BCellCrossReactivity[ i ] ]; } // modify linewidth to highlight records
                    if ( object_plot_BCellCrossReactivity.flag_bool_mode_is_lines ) { // temp
                        let l_index_traces_selected = [ ], l_index_traces_not_selected = [ ];
    //                     for ( let i = 0; i < object_plot_BCellCrossReactivity.n_records; i ++ ) { if ( mask_selected[ i ] ) { l_index_traces_selected.push( i ); } else { l_index_traces_not_selected.push( i ); } }
    //                     Plotly.restyle( plotMolecularMimicryMap, { opacity: 0 }, l_index_traces_not_selected ); // hide non-selected records
    //                     Plotly.restyle( plotMolecularMimicryMap, { opacity: float_line_type_opacity_MolecularMimicryMap_BCellCrossReactivity }, l_index_traces_selected ); // show selected records
                    } else {
                        Plotly.restyle( plotMolecularMimicryMap, { marker: { opacity: l_opacity_modified, size: trace_point_type_MolecularMimicryMap_BCellCrossReactivity.marker.size, color: trace_point_type_MolecularMimicryMap_BCellCrossReactivity.marker.color, line: { width: 0 } }, error_x: { type: "data", array: l_error_x_modified, visible: true, width: 0, thickness: 1 } }, object_plot_BCellCrossReactivity.index_trace_start ) // set opacity of markers not selected in the metric plot to 0
                    }
                }
                if ( int_acc_human in dictionary_acc_human_TCellCrossReactivity ) { // highlight TCellCrossReactivity
                    let l_indices_to_highlight_TCellCrossReactivity = dictionary_acc_human_TCellCrossReactivity[ int_acc_human ];
                    l_opacity = object_plot_TCellCrossReactivity.selection.l_opacity, l_opacity_modified = ArrayFull( object_plot_TCellCrossReactivity.n_records, 0 ), l_error_x = object_plot_TCellCrossReactivity.selection.l_error_x, l_error_x_modified = ArrayFull( object_plot_TCellCrossReactivity.n_records, 0 ); // initialize array of opacities and l_error_x 
                    for ( let i = 0; i < l_indices_to_highlight_TCellCrossReactivity.length; i ++ ) { l_opacity_modified[ l_indices_to_highlight_TCellCrossReactivity[ i ] ] = l_opacity[ l_indices_to_highlight_TCellCrossReactivity[ i ] ]; l_error_x_modified[ l_indices_to_highlight_TCellCrossReactivity[ i ] ] = l_error_x[ l_indices_to_highlight_TCellCrossReactivity[ i ] ]; } // modify linewidth to highlight records
                    Plotly.restyle( plotMolecularMimicryMap, { marker: { opacity: l_opacity_modified, size: trace_point_type_MolecularMimicryMap_TCellCrossReactivity_human.marker.size, color: trace_point_type_MolecularMimicryMap_TCellCrossReactivity_human.marker.color, symbol: trace_point_type_MolecularMimicryMap_TCellCrossReactivity_human.marker.symbol, line: { width: trace_point_type_MolecularMimicryMap_TCellCrossReactivity_human.marker.line.width } } }, object_plot_TCellCrossReactivity.index_trace_start );
                    Plotly.restyle( plotMolecularMimicryMap, { marker: { opacity: l_opacity_modified, size: trace_point_type_MolecularMimicryMap_TCellCrossReactivity_virus.marker.size, color: trace_point_type_MolecularMimicryMap_TCellCrossReactivity_virus.marker.color, symbol: trace_point_type_MolecularMimicryMap_TCellCrossReactivity_virus.marker.symbol, line: { width: trace_point_type_MolecularMimicryMap_TCellCrossReactivity_virus.marker.line.width } }, error_x: { type: "data", array: l_error_x_modified, visible: true, width: 0, thickness: 1 } }, object_plot_TCellCrossReactivity.index_trace_start + 1 );
                }
            }
        }
    }

    function Clear_Highlight_MolecularMimicryMap( ) { // remove highlights from the plot
        Plotly.restyle( plotMolecularMimicryMap, { marker: { opacity: object_plot_BCellCrossReactivity.selection.l_opacity, size: trace_point_type_MolecularMimicryMap_BCellCrossReactivity.marker.size, color: trace_point_type_MolecularMimicryMap_BCellCrossReactivity.marker.color, line: { width: trace_point_type_MolecularMimicryMap_BCellCrossReactivity.marker.line.width } }, error_x: { type: "data", array: object_plot_BCellCrossReactivity.selection.l_error_x, visible: true, width: 0, thickness: 1 } }, object_plot_BCellCrossReactivity.index_trace_start );
        Plotly.restyle( plotMolecularMimicryMap, { marker: { opacity: object_plot_TCellCrossReactivity.selection.l_opacity, size: trace_point_type_MolecularMimicryMap_TCellCrossReactivity_human.marker.size, color: trace_point_type_MolecularMimicryMap_TCellCrossReactivity_human.marker.color, symbol: trace_point_type_MolecularMimicryMap_TCellCrossReactivity_human.marker.symbol, line: { width: trace_point_type_MolecularMimicryMap_TCellCrossReactivity_human.marker.line.width } } }, object_plot_TCellCrossReactivity.index_trace_start );
        Plotly.restyle( plotMolecularMimicryMap, { marker: { opacity: object_plot_TCellCrossReactivity.selection.l_opacity, size: trace_point_type_MolecularMimicryMap_TCellCrossReactivity_virus.marker.size, color: trace_point_type_MolecularMimicryMap_TCellCrossReactivity_virus.marker.color, symbol: trace_point_type_MolecularMimicryMap_TCellCrossReactivity_virus.marker.symbol, line: { width: trace_point_type_MolecularMimicryMap_TCellCrossReactivity_virus.marker.line.width } }, error_x: { type: "data", array: object_plot_TCellCrossReactivity.selection.l_error_x, visible: true, width: 0, thickness: 1 } }, object_plot_TCellCrossReactivity.index_trace_start + 1 );
    }
    
    function VaccineMetrics_Update_Visibility( ) { // update visibility_for_each_trace and general visibility for current setting
        object_data_vaccine_metric.show = document.getElementById( "checkbox_toggle_vaccine_metrics_MolecularMimicryMap" ).checked; // set general visibility of all vaccine metric traces
        let l_name_data = object_data_vaccine_metric.l_name_data, visibility_for_each_trace = ArrayFull( l_name_data.length, false ), dict_name_data_to_index = object_data_vaccine_metric.dict_name_data_to_index; // set visibility of each trace based on the given settings 
        visibility_for_each_trace[ dict_name_data_to_index[ "count_iedb_epitope_with_tcell_assay" ] ] = document.getElementById( "checkbox_toggle_vaccine_metric_iedb_t_cell_assay" ).checked;
        visibility_for_each_trace[ dict_name_data_to_index[ "count_iedb_epitope_with_bcell_assay" ] ] = document.getElementById( "checkbox_toggle_vaccine_metric_iedb_b_cell_assay" ).checked;
        visibility_for_each_trace[ dict_name_data_to_index[ "avg_processing_score_mhc_i" ] ] = document.getElementById( "checkbox_toggle_vaccine_metric_mhc_i_processing_score" ).checked;
        visibility_for_each_trace[ dict_name_data_to_index[ "score_linear_bcell_epitope_prediction__bepipred" ] ] = document.getElementById( "checkbox_toggle_vaccine_metric_bepipred" ).checked;
        visibility_for_each_trace[ dict_name_data_to_index[ "relative_accessible_surface_area" ] ] = document.getElementById( "checkbox_toggle_vaccine_metric_relative_accessible_surface_area" ).checked;
        if ( document.getElementById( "checkbox_toggle_vaccine_metric_count_non_consensus_residue" ).checked ) { visibility_for_each_trace[ dict_name_data_to_index[ document.getElementById( "select_vaccine_metric_count_non_consensus_residue" ).value ] ] = true; }
        if ( document.getElementById( "checkbox_toggle_vaccine_metric_mhc_i_binding_prediction" ).checked ) { visibility_for_each_trace[ dict_name_data_to_index[ document.getElementById( "select_vaccine_metric__mhc_i_binding_peptide_count" ).value ] ] = true; }
        if ( document.getElementById( "checkbox_toggle_vaccine_metric_mhc_ii_binding_prediction" ).checked ) { visibility_for_each_trace[ dict_name_data_to_index[ document.getElementById( "select_vaccine_metric__mhc_ii_binding_peptide_count" ).value ] ] = true; }
        object_data_vaccine_metric.visibility_for_each_trace = visibility_for_each_trace;
    }
    function VaccineMetrics_Apply_Visibility( ) { // apply updated visibility for each trace
        VaccineMetrics_Update_Visibility( ) // update visiblity for current settings
        let l_name_data = lodash.cloneDeep( object_data_vaccine_metric.l_name_data );
        l_name_data.push( ... [ 'vaccine_metric__lower_bound', 'vaccine_metric__upper_bound' ] );
        let l_visibility = object_data_vaccine_metric.show ? object_data_vaccine_metric.visibility_for_each_trace.concat( [ true, true ] ) : ArrayFull( l_name_data.length, false ), l_index_trace = [ ];
        for ( let i = 0; i < l_name_data.length; i ++ ) { l_index_trace.push( dict_name_plot_to_trace_index__MolecularMimicryMap[ l_name_data[ i ] ] ); } // retrieve index_trace of VaccineMetrics traces.
        for ( let i = 0; i < l_index_trace.length; i ++ ) {
            let index_trace = l_index_trace[ i ], visibility = l_visibility[ i ];
            if ( plotMolecularMimicryMap.data[ index_trace ].visible != visibility ) { Plotly.restyle( plotMolecularMimicryMap, { visible: visibility }, index_trace ); } // update visibility of individual traces when current visibility is different from updated visibility
        }
    }
    
    // named event handlers
    function EventHandler_plotly_relayout_MolecularMimicryMap( data ) {
        console.log( "plotMolecularMimicryMap, plotly_relayout event triggered:", data );
        Set_Visibility_of_Consensus_Protein_Sequence_Virus( );
        Adjust_Layout_MolecularMimicryMap( );
    }
    function EventHandler_plotly_restyle_MolecularMimicryMap( data ) {
        console.log( "plotMolecularMimicryMap, plotly_restyle event triggered:", data );
        Adjust_Layout_MolecularMimicryMap( );
    }
    async function Adjust_Layout_MolecularMimicryMap( mode ) { // adjust layout of molecular mimicry graph based on plot height and y-axis range
        return new Promise ( async function( resolve, reject ) {
            let l_y_range = plotMolecularMimicryMap.layout.yaxis.range, y_floor = l_y_range[ 0 ], y_ceiling = l_y_range[ 1 ], y_axis_size = y_ceiling - y_floor, l_anno = [ ], bool_flag_y_axis_changed = ( object_plot_MolecularMimicryMap.layout.y_floor != y_floor ) || ( object_plot_MolecularMimicryMap.layout.y_ceiling != y_ceiling );
            let l_x_range = plotMolecularMimicryMap.layout.xaxis.range, x_left = parseInt( Math.max( 0, l_x_range[ 0 ] ) ), x_right = parseInt( Math.min( l_x_range[ 1 ], object_data_vaccine_metric.accumulated_length - 1 ) ), x_axis_size = x_right - x_left, bool_flag_x_axis_changed = ( object_plot_MolecularMimicryMap.layout.x_left != x_left ) || ( object_plot_MolecularMimicryMap.layout.x_right != x_right );
            if ( true && ( object_plot_BCellCrossReactivity.show || object_plot_TCellCrossReactivity.show ) ) { // if Cross-Reactivity prediction data are being shown and y-axis range has been changed or y-axis-label has not been drawn, adjust y-axis label
                console.log( "[Adjust_Layout_MolecularMimicryMap] change in y-axis detected. Adjusting annotations in the layout" );
                object_plot_MolecularMimicryMap.layout.y_floor = y_floor; // update y axis range
                object_plot_MolecularMimicryMap.layout.y_ceiling = y_ceiling;    
                l_anno.push( {
                        font: { size: 15 },
                        xanchor: "left",
                        yanchor: "middle",
                        xref: "paper", x: 0,
                        yref: 'paper', y: ( 1 + ( - y_floor ) / y_axis_size ) / 2,
                        textangle: - 90,
                        xshift: - 45,
                        text: "(discontinuous) similarity per residue",
                        showarrow: false
                      } ); // update y-axis labal annotation
                
            }
            if ( true ) {
                console.log( "[Adjust_Layout_MolecularMimicryMap] change in x-axis detected. Adjusting annotations in the layout" );
                object_plot_MolecularMimicryMap.layout.x_left = x_left; // update x axis range
                object_plot_MolecularMimicryMap.layout.x_right = x_right;    
                let anno_protein_virus_left = arr_data_acc_virus_representative[ object_data_vaccine_metric.dict_accumulated_coord_to_acc_rep[ x_left ] ], anno_protein_virus_right = arr_data_acc_virus_representative[ object_data_vaccine_metric.dict_accumulated_coord_to_acc_rep[ x_right ] ], str_anno = "";
                let pos_protein_virus_left = object_data_vaccine_metric.dict_accumulated_coord_to_individual_coord[ x_left ] + 1, pos_protein_virus_right = object_data_vaccine_metric.dict_accumulated_coord_to_individual_coord[ x_right ] + 1;
                str_anno = ( anno_protein_virus_left.name == anno_protein_virus_right.name ) ? anno_protein_virus_left.name + " " + pos_protein_virus_left + "-" + pos_protein_virus_right + "/" + anno_protein_virus_left.length : anno_protein_virus_left.name + " " + pos_protein_virus_left + "/" + anno_protein_virus_left.length + " ... " + anno_protein_virus_right.name + " " + pos_protein_virus_right + "/" + anno_protein_virus_right.length;
                l_anno.push( {
                        font: { size: 15 },
                        xanchor: "left",
                        yanchor: "top",
                        xref: "paper", x: 0,
                        yref: 'paper', y: 1,
                        textangle: 0,
                        xshift: 0,
                        text: str_anno,
                        showarrow: false
                      } ); // update y-axis labal annotation
            }
            if ( ( "vaccine_design" in dict_name_plot_to_trace_index__MolecularMimicryMap ) && object_data_vaccine_design.show ) { // while vaccine_design trace is on display
                let index_trace_vaccine_design = dict_name_plot_to_trace_index__MolecularMimicryMap[ "vaccine_design" ], name_y_value = object_data_vaccine_design.name_y_axis;
                if ( true || mode == "vaccine_design_y_axis_updated" || name_y_value != object_data_vaccine_design.plotly.name_y_value || bool_flag_y_axis_changed ) {
                    console.log( "[Adjust_Layout_MolecularMimicryMap] change of y-axis name of vaccine_design trace or change of y-axis range was detected while vaccine_design trace is on display. Adjusting annotations in the layout" );
                    object_data_vaccine_design.plotly.name_y_value = name_y_value; // update name_y_value
                    if ( ! ( "dict_max_value" in object_data_vaccine_design.plotly ) ) { object_data_vaccine_design.plotly.dict_max_value = { }; }
                    if ( ! ( name_y_value in object_data_vaccine_design.plotly.dict_max_value ) || mode == "vaccine_design_y_axis_updated" ) { // retrieve the max_value of the values of 'name_y_value' data if the data does not exist of y_axis values have been updated.
                        object_data_vaccine_design.plotly.dict_max_value[ name_y_value ] = Math.max( ... object_data_vaccine_design.plotly.y );
                    }
                    let y_value_max = object_data_vaccine_design.plotly.dict_max_value[ name_y_value ];
                    l_anno.push( ... [{
                        font: { size: 12 },
                        xref: 'paper', yref: 'paper',
                        x: 0,
                        xanchor: 'left',
                        y: ( - 4 - y_floor ) / y_axis_size,
                        yanchor: 'top',
                        text: 'Max = ' + ( CheckInt( y_value_max ) ? String( y_value_max ) : y_value_max.toFixed( 3 ) ),
                        xshift: - 30,
                        showarrow: false
                      }, {
                        font: { size: 12 },
                        xref: 'paper', yref: 'paper',
                        x: 0,
                        xanchor: 'left',
                        y: ( - 6 - y_floor ) / y_axis_size,
                        yanchor: 'bottom',
                        text: 'Min = ' + String( 0 ),
                        xshift: - 30,
                        showarrow: false
                      }] );
                }
            }
//             if ( l_anno.length == 0 ) { return; } // if no relavant change was detected, do not update layout
            plotMolecularMimicryMap.removeAllListeners( "plotly_relayout" ); // remove event listeners to avoid infinite event propagation
            plotMolecularMimicryMap.removeAllListeners( "plotly_restyle" ); 
            await Plotly.relayout( plotMolecularMimicryMap, { annotations: l_anno });
            plotMolecularMimicryMap.on( "plotly_relayout", EventHandler_plotly_relayout_MolecularMimicryMap );
            plotMolecularMimicryMap.on( "plotly_restyle", EventHandler_plotly_restyle_MolecularMimicryMap );
            console.log( "[Adjust_Layout_MolecularMimicryMap] annotations adjusted." ); // add listeners back
            resolve( "[Adjust_Layout_MolecularMimicryMap] annotations adjusted." );
        }); 
    }

    // Mol* JS molecule renderer
    //Create plugin instance
    var pdbHumanProtein = new PDBeMolstarPlugin( );
    var pdbVirusProtein = new PDBeMolstarPlugin( );

    //Get element from HTML/Template to place the viewer 
    var pdbHumanProteinContainer = document.getElementById( 'PDB_Viewer_Human_Protein' );
    var pdbVirusProteinContainer = document.getElementById( 'PDB_Viewer_Virus_Protein' );
    //Call render method to display the 3D view
    str_jquery_container = "#container_PDB";
    if ( $( str_jquery_container ).hasClass( "collapse" ) && $( str_jquery_container ).hasClass( "show" ) ) { 
        pdbHumanProtein.render( pdbHumanProteinContainer, option_initialization_molstar ); pdbVirusProtein.render( pdbVirusProteinContainer, option_initialization_molstar ); // draw Plotly plot synchronously if the container is currently shown
        pdbHumanProtein.visual.setColor( { highlight: color_pdb_highlight } ); pdbVirusProtein.visual.setColor( { highlight: color_pdb_highlight } ); // set highlight colors
    } else { BootstrapCollapseShownPromise( str_jquery_container ).then( ( ) => { // draw Plotly plot once the container is shown if the container is currently hidden
        pdbHumanProtein.render( pdbHumanProteinContainer, option_initialization_molstar ); 
        pdbVirusProtein.render( pdbVirusProteinContainer, option_initialization_molstar );
        Promise.all( [ MolStarRenderCompletePromise( pdbHumanProtein ), MolStarRenderCompletePromise( pdbVirusProtein ) ] ).then( ( ) => { $( "#container_PDB" ).collapse( 'show' ); pdbHumanProtein.visual.setColor( { highlight: color_pdb_highlight } ); pdbVirusProtein.visual.setColor( { highlight: color_pdb_highlight } ); } ); // // hide Mol* viewers once initialization on both viewer instances are completed
    } ); }  
    var l_exclusive_tab = [ "#plotly_graph_b_cell_cross_reactivity", "#plotly_graph_t_cell_cross_reactivity", "#container_datatable_panel_MolecularMimicryMap" ];
    function Toggle_Exclusive_Tabs( tab_target ) { 
        if ( tab_target == "hide_all" ) { for ( let tab of l_exclusive_tab ) { $( tab ).collapse( 'hide' ); } return; } // hide all tabs if tab_target == "hide_all"
        let l_bool_flag_need_change = [ ];
        for ( let tab of l_exclusive_tab ) {
            l_bool_flag_need_change.push( tab == tab_target ? ! ( $( tab ).hasClass( "show" ) ) : $( tab ).hasClass( "show" ) );
        }
        if ( ArraySum( l_bool_flag_need_change ) > 0 ) { // if tab_target is not opened, open the tab
            for ( let tab of l_exclusive_tab ) {
                if( tab == tab_target ) { BootstrapCollapseShownPromise( tab ).then( ( ) => { window.dispatchEvent( new Event( 'resize' ) ); } ); } // trigger resize events to allow Plotly plot to resize its plot
                else { $( tab ).collapse( 'hide' ); }
            }
        } else { $( tab_target ).collapse( 'hide' ); } // if tab_target is already opened, close the tab
         
    }
    function Toggle_div( id_div ) {
        var div = document.getElementById( id_div );
        if ( div.style.display == "none" ) { div.style.display = "block"; } 
        else { div.style.display = "none"; }
    }
    var flag_tooltip_active_Toggle_Tooltips = true;
    function Toggle_Tooltips(  ) {
        console.log( "[Toggle_Tooltips] Tooltips toggled to ", flag_tooltip_active_Toggle_Tooltips )
        flag_tooltip_active_Toggle_Tooltips = ! flag_tooltip_active_Toggle_Tooltips; // toggle the flag
        if ( flag_tooltip_active_Toggle_Tooltips ) { $('[data-tooltip="tooltip"]').tooltip( 'enable' ); }
        else { $('[data-tooltip="tooltip"]').tooltip( 'disable' ); }
    }
    
    var color_non_selected = "#fcfcfc"; // color of residues that are not selected
    function Select_View_of_PDB_Virus_Protein( ) {
        switch ( document.getElementById( "select_PDB_virus_protein_structure" ).value ) {
            case "Clear" : 
                pdbVirusProtein.visual.clearSelection( );
                break;
            case "BLOSUM62 Score" : 
                pdbVirusProtein.visual.select( { data: object_pdb_virus.selection, nonSelectedColor: { r:255, g:255, b:255 } } );
                break;
            case "BLOSUM62 Score with Side Chains" : 
                pdbVirusProtein.visual.select( { data: object_pdb_virus.selection_showing_side_chain, nonSelectedColor: { r:255, g:255, b:255 } } );
                break;
            default : break;
        }
    }
    function Select_View_of_PDB_Human_Protein( ) {
        switch ( document.getElementById( "select_PDB_human_protein_structure" ).value ) {
            case "Clear" : 
                pdbHumanProtein.visual.clearSelection( );
                break;
            case "BLOSUM62 Score" : 
                pdbHumanProtein.visual.select( { data: object_pdb_human.selection, nonSelectedColor: { r:255, g:255, b:255 } } );
                break;
            case "BLOSUM62 Score with Side Chains" : 
                pdbHumanProtein.visual.select( { data: object_pdb_human.selection_showing_side_chain, nonSelectedColor: { r:255, g:255, b:255 } } );
                break;
            default : break;
        }
    }
    
    // Get the button_scroll_to_the_top:
    button_scroll_to_the_top = document.getElementById( "button_scroll_to_the_top" );
    // When the user scrolls down 20px from the top of the document, show the button
    window.onscroll = function( ) { scrollFunction( ) };
    function scrollFunction( ) {
      if ( document.body.scrollTop > 20 || document.documentElement.scrollTop > 20 ) { button_scroll_to_the_top.style.display = "block"; }
      else { button_scroll_to_the_top.style.display = "none"; }
    }
    // When the user clicks on the button, scroll to the top of the document
    function Scroll_to_the_Top() {
      document.body.scrollTop = 0; // For Safari
      document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
    }

</script>
</body>
</html>
